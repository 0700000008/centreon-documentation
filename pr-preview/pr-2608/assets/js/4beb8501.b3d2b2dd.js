"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[65425],{603905:(e,r,a)=>{a.d(r,{Zo:()=>m,kt:()=>g});var t=a(667294);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?o(Object(a),!0).forEach((function(r){n(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function l(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=t.createContext({}),s=function(e){var r=t.useContext(p),a=r;return e&&(a="function"==typeof e?e(r):i(i({},r),e)),a},m=function(e){var r=s(e.components);return t.createElement(p.Provider,{value:r},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},u=t.forwardRef((function(e,r){var a=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=s(a),u=n,g=c["".concat(p,".").concat(u)]||c[u]||d[u]||o;return a?t.createElement(g,i(i({ref:r},m),{},{components:a})):t.createElement(g,i({ref:r},m))}));function g(e,r){var a=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var p in r)hasOwnProperty.call(r,p)&&(l[p]=r[p]);l.originalType=e,l[c]="string"==typeof e?e:n,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},709588:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>m,contentTitle:()=>p,default:()=>g,frontMatter:()=>l,metadata:()=>s,toc:()=>c});a(667294);var t=a(603905);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})),e}function i(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}const l={id:"upgrade-mariadb",title:"Upgrading MariaDB"},p=void 0,s={unversionedId:"upgrade/upgrade-mariadb",id:"version-21.10/upgrade/upgrade-mariadb",title:"Upgrading MariaDB",description:"You may have several MariaDB databases in your architecture. The central server has a database, each remote server has a database,",source:"@site/versioned_docs/version-21.10/upgrade/upgrade-mariadb.md",sourceDirName:"upgrade",slug:"/upgrade/upgrade-mariadb",permalink:"/centreon-documentation/pr-preview/pr-2608/docs/21.10/upgrade/upgrade-mariadb",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-21.10/upgrade/upgrade-mariadb.md",tags:[],version:"21.10",lastUpdatedAt:1694614453,formattedLastUpdatedAt:"Sep 13, 2023",frontMatter:{id:"upgrade-mariadb",title:"Upgrading MariaDB"},sidebar:"version-21.10/docs",previous:{title:"Upgrade from Centreon-Failover to Centreon-HA",permalink:"/centreon-documentation/pr-preview/pr-2608/docs/21.10/upgrade/centreon-ha/upgrade-from-centreon-failover"},next:{title:"Introduction",permalink:"/centreon-documentation/pr-preview/pr-2608/docs/21.10/migrate/introduction"}},m={},c=[{value:"Upgrading process",id:"upgrading-process",level:2},{value:"Version of Maria DB for each version of Centreon",id:"version-of-maria-db-for-each-version-of-centreon",level:2},{value:"Knowing your version of MariaDB",id:"knowing-your-version-of-mariadb",level:2},{value:"Upgrading between major MariaDB versions",id:"upgrading-between-major-mariadb-versions",level:2},{value:"Upgrading from 10.1 to 10.5",id:"upgrading-from-101-to-105",level:3},{value:"Upgrading between minor versions of MariaDB",id:"upgrading-between-minor-versions-of-mariadb",level:2}],d={toc:c},u="wrapper";function g(e){var{components:r}=e,a=i(e,["components"]);return(0,t.kt)(u,o(function(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{},t=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),t.forEach((function(r){n(e,r,a[r])}))}return e}({},d,a),{components:r,mdxType:"MDXLayout"}),(0,t.kt)("p",null,"You may have several MariaDB databases in your architecture. The central server has a database, each remote server has a database,\nand the MBI and MAP modules each have a dedicated database. Within your architecture, all databases must have the same verison of MariaDB."),(0,t.kt)("h2",{id:"upgrading-process"},"Upgrading process"),(0,t.kt)("p",null,"When you upgrade from one major version of Centreon to another, you must:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Upgrade Centreon (packages, web installation, deploying the configuration)."),(0,t.kt)("li",{parentName:"ol"},"Upgrade MariaDB.")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Refer to the official MariaDB documentation to know more about this process:\n",(0,t.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"},"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"))),(0,t.kt)("h2",{id:"version-of-maria-db-for-each-version-of-centreon"},"Version of Maria DB for each version of Centreon"),(0,t.kt)("table",null,(0,t.kt)("thead",{parentName:"table"},(0,t.kt)("tr",{parentName:"thead"},(0,t.kt)("th",{parentName:"tr",align:null},"Centreon"),(0,t.kt)("th",{parentName:"tr",align:null},"MariaDB"))),(0,t.kt)("tbody",{parentName:"table"},(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"21.10"),(0,t.kt)("td",{parentName:"tr",align:null},"10.5")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"21.04"),(0,t.kt)("td",{parentName:"tr",align:null},"10.5")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"20.10"),(0,t.kt)("td",{parentName:"tr",align:null},"10.3.x")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"20.04"),(0,t.kt)("td",{parentName:"tr",align:null},"10.3.x")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"19.10"),(0,t.kt)("td",{parentName:"tr",align:null},"10.1.x")))),(0,t.kt)("h2",{id:"knowing-your-version-of-mariadb"},"Knowing your version of MariaDB"),(0,t.kt)("p",null,"To know which version of MariaDB is installed on your machine, enter the following command:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"rpm -qa |grep MariaDB\n")),(0,t.kt)("p",null,"The results should look like this:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"MariaDB-client-10.5.8-1.el7.centos.x86_64\nMariaDB-server-10.5.8-1.el7.centos.x86_64\nMariaDB-common-10.5.8-1.el7.centos.x86_64\nMariaDB-shared-10.5.8-1.el7.centos.x86_64\nMariaDB-compat-10.5.8-1.el7.centos.x86_64\n")),(0,t.kt)("h2",{id:"upgrading-between-major-mariadb-versions"},"Upgrading between major MariaDB versions"),(0,t.kt)("p",null,"You have to uninstall then reinstall MariaDB to upgrade between major versions (for example to switch from version 10.4 to version 10.5)."),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Stop the mariadb service:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop mariadb\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Uninstall the current version:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-compat MariaDB-common\n")),(0,t.kt)("blockquote",{parentName:"li"},(0,t.kt)("p",{parentName:"blockquote"},"During this uninstallation step, you may encounter an error because one or several MariaDB packages are missing. In that case, you have to execute the uninstallation command not including the missing package.")),(0,t.kt)("p",{parentName:"li"},"  For instance, you get the following error message:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"package MariaDB-compat is not installed\n")),(0,t.kt)("p",{parentName:"li"},"  As ",(0,t.kt)("strong",{parentName:"p"},"MariaDB-compat")," is the missing package, please execute the same command without quoting ",(0,t.kt)("strong",{parentName:"p"},"MariaDB-compat"),":"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-common\n")),(0,t.kt)("blockquote",{parentName:"li"},(0,t.kt)("p",{parentName:"blockquote"},"Make sure you have ",(0,t.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2608/docs/21.10/upgrade/upgrade-from-21-04#install-the-mariadb-repository"},"installed the official MariaDB repository")," before you continue the procedure."))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Install the 10.5 version:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"yum install MariaDB-server-10.5\\* MariaDB-client-10.5\\* MariaDB-shared-10.5\\* MariaDB-common-10.5\\*\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Start the mariadb service:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Launch the MariaDB upgrade process:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,t.kt)("p",{parentName:"li"},"If your database is password-protected, enter:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade -u <database_admin_user> -p\n")),(0,t.kt)("p",{parentName:"li"},"Example: if your database_admin_user is ",(0,t.kt)("inlineCode",{parentName:"p"},"root"),", enter:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"mysql_upgrade -u root -p\n")),(0,t.kt)("blockquote",{parentName:"li"},(0,t.kt)("p",{parentName:"blockquote"},"Refer to the ",(0,t.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/mysql_upgrade/"},"official documentation"),"\nfor more information or if errors occur during this last step."))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"To enable MariaDB on startup, execute the following command:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable mariadb\n")))),(0,t.kt)("h3",{id:"upgrading-from-101-to-105"},"Upgrading from 10.1 to 10.5"),(0,t.kt)("p",null,"The ",(0,t.kt)("inlineCode",{parentName:"p"},"innodb_additional_mem_pool_size")," parameter has been removed since MariaDB 10.2,\nso you should remove it from file ",(0,t.kt)("strong",{parentName:"p"},"/etc/my.cnf.d/centreon.cnf")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-diff"},"#\n# Custom MySQL/MariaDB server configuration for Centreon\n#\n[server]\ninnodb_file_per_table=1\n\nopen_files_limit = 32000\n\nkey_buffer_size = 256M\nsort_buffer_size = 32M\njoin_buffer_size = 4M\nthread_cache_size = 64\nread_buffer_size = 512K\nread_rnd_buffer_size = 256K\nmax_allowed_packet = 8M\n\n# For 4 Go Ram\n-#innodb_additional_mem_pool_size=512M\n#innodb_buffer_pool_size=512M\n\n# For 8 Go Ram\n-#innodb_additional_mem_pool_size=1G\n#innodb_buffer_pool_size=1G\n")),(0,t.kt)("h2",{id:"upgrading-between-minor-versions-of-mariadb"},"Upgrading between minor versions of MariaDB"),(0,t.kt)("p",null,"Follow these steps to upgrade between minor versions of MariaDBB (for example, to switch from version 10.3.2 to version 10.3.5) : "),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Update MariaDB :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"yum update mariadb-*\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Restart MariaDB :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"restart mariadb\n")))))}g.isMDXComponent=!0}}]);