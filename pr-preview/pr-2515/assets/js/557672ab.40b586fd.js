"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[37286],{254242:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>u,toc:()=>m});n(667294);var a=n(603905),r=n(451715),o=n(907626);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const s={id:"upgrade",title:"Upgrade the extension"},c=void 0,u={unversionedId:"graph-views/upgrade",id:"version-21.10/graph-views/upgrade",title:"Upgrade the extension",description:"This chapter describes how to upgrade your Centreon MAP extension. This",source:"@site/versioned_docs/version-21.10/graph-views/upgrade.md",sourceDirName:"graph-views",slug:"/graph-views/upgrade",permalink:"/docs/21.10/graph-views/upgrade",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-21.10/graph-views/upgrade.md",tags:[],version:"21.10",lastUpdatedAt:1692951601,formattedLastUpdatedAt:"Aug 25, 2023",frontMatter:{id:"upgrade",title:"Upgrade the extension"},sidebar:"version-21.10/docs",previous:{title:"Update the extension",permalink:"/docs/21.10/graph-views/update"},next:{title:"Migrate the extension",permalink:"/docs/21.10/graph-views/migrate"}},d={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Update the RPM signing key",id:"update-the-rpm-signing-key",level:3},{value:"Step 1: Centreon MAP server",id:"step-1-centreon-map-server",level:2},{value:"Step 2: Centreon MAP web interface",id:"step-2-centreon-map-web-interface",level:2},{value:"Step 3: Centreon MAP desktop client",id:"step-3-centreon-map-desktop-client",level:2},{value:"Step 4: Update dialects in .properties files",id:"step-4-update-dialects-in-properties-files",level:2},{value:"Step 5: MariaDB database",id:"step-5-mariadb-database",level:2}],k={toc:m},g="wrapper";function h(e){var{components:t}=e,n=i(e,["components"]);return(0,a.kt)(g,p(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){l(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This chapter describes how to upgrade your Centreon MAP extension. This\nis done by upgrading the four main components:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Centreon MAP server"),(0,a.kt)("li",{parentName:"ul"},"Centreon MAP web interface & its widget"),(0,a.kt)("li",{parentName:"ul"},"Desktop client (automatically updated)"),(0,a.kt)("li",{parentName:"ul"},"MariaDB database.")),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Before upgrading Centreon MAP server, we highly recommend performing a\nMariaDB dump (backup) of your ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon_studio")," database. This will\nallow you easily to roll back to the previous state if necessary."),(0,a.kt)("p",null,"Be sure to read the release notes for an explanation of features, fixes\n& custom procedures."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"When you're upgrading to a new major or minor version (i.e:A.B.x with\nA or B that changes) you need to contact our Support service to retrieve\nthe new repository"),"."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Mistakes when editing configuration files can lead to malfunctions of the software. We recommend that you make a backup of the file before editing it and that you only change the settings advised by Centreon.")),(0,a.kt)("h3",{id:"update-the-rpm-signing-key"},"Update the RPM signing key"),(0,a.kt)("p",null,"For security reasons, the keys used to sign Centreon RPMs are rotated regularly. The last change occurred on October 14, 2021. When upgrading from an older version, you need to go through the ",(0,a.kt)("a",{parentName:"p",href:"/docs/21.10/security/key-rotation#existing-installation"},"key rotation procedure"),", to remove the old key and install the new one."),(0,a.kt)("h2",{id:"step-1-centreon-map-server"},"Step 1: Centreon MAP server"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If you are still running version ",(0,a.kt)("strong",{parentName:"p"},"4.0.X"),", you ",(0,a.kt)("strong",{parentName:"p"},"must first install\nand run the server in version 4.1.X before upgrading to the latest\nversion"),".")),(0,a.kt)("p",null,"Run the following commands to upgrade your Centreon MAP server:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Stop and disable legacy tomcat service coming from precedent version:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop tomcat\nsystemctl disable tomcat\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Update Centreon & Centreon MAP repositories:"))),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install https://yum.centreon.com/standard/21.10/el8/stable/noarch/RPMS/centreon-release-21.10-5.el8.noarch.rpm\n"))),(0,a.kt)(o.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install https://yum.centreon.com/standard/21.10/el7/stable/noarch/RPMS/centreon-release-21.10-5.el7.centos.noarch.rpm\n")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Install Centreon Business repository, you can find it on the\n",(0,a.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/en-us/categories/10341239833105-Repositories"},"support portal"),".")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Update Centreon MAP server:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum update centreon-map-server\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Enable and start ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon-map")," service:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable centreon-map\nsystemctl start centreon-map\n")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If you want totally clean up legacy Tomcat service, you can just remove\nTomcat and move old log file to new log folder:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum remove tomcat\ncp /var/log/centreon-studio/* /var/log/centreon-map/\nrm -rf /var/log/centreon-studio\n")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},"This point only applies if you customized your ",(0,a.kt)("strong",{parentName:"li"},"centreon-map.conf")," configuration file. When upgrading your MAP module, the ",(0,a.kt)("strong",{parentName:"li"},"/etc/centreon-studio/centreon-map.conf")," file is not upgraded automatically: the new configuration file brought by the rpm does not replace the old file. You must copy the changes manually to your customized configuration file.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The old configuration file is renamed ",(0,a.kt)("strong",{parentName:"p"},"centreon-map.conf.rpmsave"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The upgrade installs a new ",(0,a.kt)("strong",{parentName:"p"},"centreon-map.conf")," file."),(0,a.kt)("p",{parentName:"li"},"Run a diff between the old and the new configuration files:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"diff -u /etc/centreon-studio/centreon-map.conf /etc/centreon-studio/centreon-map.conf.rpmsave\n")),(0,a.kt)("p",{parentName:"li"},"For each difference between the files, assess whether you should copy it from ",(0,a.kt)("strong",{parentName:"p"},"centreon-map.conf.rpmsave")," to ",(0,a.kt)("strong",{parentName:"p"},"centreon-map.conf"),"."))),(0,a.kt)("h2",{id:"step-2-centreon-map-web-interface"},"Step 2: Centreon MAP web interface"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum update centreon-map-web-client\n")),(0,a.kt)("p",null,"Complete the upgrade: "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Go to ",(0,a.kt)("strong",{parentName:"li"},"Administration > Extensions > Manager"),"."),(0,a.kt)("li",{parentName:"ol"},"Search for ",(0,a.kt)("strong",{parentName:"li"},"Map web client"),"."),(0,a.kt)("li",{parentName:"ol"},"Click on the update button (module & widget parts).")),(0,a.kt)("h2",{id:"step-3-centreon-map-desktop-client"},"Step 3: Centreon MAP desktop client"),(0,a.kt)("p",null,"If the user's computer has an online connection, the desktop client is\nautomatically upgraded to the latest version that corresponds to the server."),(0,a.kt)("p",null,"Alternatively, the client can be downloaded through the menu ",(0,a.kt)("inlineCode",{parentName:"p"},"Monitoring >\nMap")," and ",(0,a.kt)("strong",{parentName:"p"},"Desktop client")," button."),(0,a.kt)("h2",{id:"step-4-update-dialects-in-properties-files"},"Step 4: Update dialects in .properties files"),(0,a.kt)("p",null,"In the ",(0,a.kt)("strong",{parentName:"p"},"/etc/centreon-studio/centreon-database.properties")," and the ",(0,a.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio-database.properties")," files, replace ",(0,a.kt)("strong",{parentName:"p"},"MySQL5Dialect")," with ",(0,a.kt)("strong",{parentName:"p"},"MariaDB10Dialect"),"."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This configuration also works with a MySQL database.")),(0,a.kt)("h2",{id:"step-5-mariadb-database"},"Step 5: MariaDB database"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Stop the ",(0,a.kt)("strong",{parentName:"p"},"centreon-map")," service:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centreon-map\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"See ",(0,a.kt)("a",{parentName:"p",href:"/docs/21.10/upgrade/upgrade-mariadb"},"Upgrading MariaDB"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Start the ",(0,a.kt)("strong",{parentName:"p"},"centreon-map")," service:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start centreon-map\n")))))}h.isMDXComponent=!0}}]);