"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[63955],{603905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>h});var r=n(667294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=c(n),d=a,h=p["".concat(l,".").concat(d)]||p[d]||u[d]||o;return n?r.createElement(h,i(i({ref:t},m),{},{components:n})):r.createElement(h,i({ref:t},m))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},568076:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>p});n(667294);var r=n(603905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const s={id:"dsm",title:"Dynamic Service Management"},l=void 0,c={unversionedId:"monitoring/passive-monitoring/dsm",id:"version-22.04/monitoring/passive-monitoring/dsm",title:"Dynamic Service Management",description:"Centreon module, Dynamic Service Management (Centreon-DSM) is an extension to manage alarms with an eventlogs system.",source:"@site/versioned_docs/version-22.04/monitoring/passive-monitoring/dsm.md",sourceDirName:"monitoring/passive-monitoring",slug:"/monitoring/passive-monitoring/dsm",permalink:"/centreon-documentation/pr-preview/pr-2619/docs/22.04/monitoring/passive-monitoring/dsm",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-22.04/monitoring/passive-monitoring/dsm.md",tags:[],version:"22.04",lastUpdatedAt:1695045176,formattedLastUpdatedAt:"Sep 18, 2023",frontMatter:{id:"dsm",title:"Dynamic Service Management"},sidebar:"version-22.04/docs",previous:{title:"Debug SNMP Traps management",permalink:"/centreon-documentation/pr-preview/pr-2619/docs/22.04/monitoring/passive-monitoring/debug-snmp-traps-management"},next:{title:"Auto Remediation",permalink:"/centreon-documentation/pr-preview/pr-2619/docs/22.04/monitoring/event-handler"}},m={},p=[{value:"Installation",id:"installation",level:2},{value:"On a central server",id:"on-a-central-server",level:3},{value:"On a poller",id:"on-a-poller",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Configure Slots",id:"configure-slots",level:3},{value:"Configure traps",id:"configure-traps",level:3},{value:"Configure Traps links",id:"configure-traps-links",level:3},{value:"Administration",id:"administration",level:2},{value:"Advanced configuration",id:"advanced-configuration",level:3},{value:"Purging cache",id:"purging-cache",level:3}],u={toc:p},d="wrapper";function h(e){var{components:t}=e,s=i(e,["components"]);return(0,r.kt)(d,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},u,s),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Centreon module, Dynamic Service Management (Centreon-DSM) is an extension to manage alarms with an eventlogs system.\nWith DSM, Centreon can receive events such as SNMP traps resulting from the detection of a problem and assign events\ndynamically to a slot defined in Centreon, like a tray events."),(0,r.kt)("p",null,'A resource has a set number of "slots" (containers) on which alerts will be  assigned (stored). While this event has\nnot been taken into account by a human action, it will remain visible in the interface Centreon. When event is\nacknowledged, the slot becomes available for new events.'),(0,r.kt)("p",null,"The goal of this module is to overhead the basic trap management system of Centreon. The basic function run with a\nsingle service and alarm crashed by successive alarms."),(0,r.kt)("p",null,"It is an essential complement to the management of SNMP traps."),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("h3",{id:"on-a-central-server"},"On a central server"),(0,r.kt)("p",null,"This part is to install ",(0,r.kt)("strong",{parentName:"p"},"Centreon DSM")," on a central server. Centreon DSM server and client will be installed on the\nmain server."),(0,r.kt)("p",null,"Run the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-dsm-server centreon-dsm-client\n")),(0,r.kt)("p",null,"After installing the rpm, you have to finish the module installation through the web frontend. Go to\n",(0,r.kt)("strong",{parentName:"p"},"Administration > Extensions > Manager")," menu and search for ",(0,r.kt)("strong",{parentName:"p"},"dsm"),". Click on ",(0,r.kt)("strong",{parentName:"p"},"Install selection"),".\nYour Centreon DSM Module is now installed."),(0,r.kt)("p",null,"You can now start and enable the daemon on your server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable dsmd\nsystemctl start dsmd\n")),(0,r.kt)("h3",{id:"on-a-poller"},"On a poller"),(0,r.kt)("p",null,"This part is to install ",(0,r.kt)("strong",{parentName:"p"},"Centreon DSM")," on a poller. Only client will be installed."),(0,r.kt)("p",null,"Run the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-dsm-client\n")),(0,r.kt)("p",null,"You now have to create an access from the poller to the DBMS server on the ",(0,r.kt)("strong",{parentName:"p"},"centreon_storage")," database."),(0,r.kt)("h2",{id:"architecture"},"Architecture"),(0,r.kt)("p",null,"The event must be transmitted to the server via an SNMP trap. The SNMP trap is thus collected by the\n",(0,r.kt)("strong",{parentName:"p"},"snmptrapd daemon"),". If reception parameters are not valid (authorized community), the event is deleted."),(0,r.kt)("p",null,"Once the SNMP trap has been received, it is sent to the ",(0,r.kt)("strong",{parentName:"p"},"centreontrapdforward")," script which writes the information\nreceived in a buffer folder (by default: ",(0,r.kt)("strong",{parentName:"p"},"/var/spool/centreontrapd/"),")."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"centreontrapd")," service reads the information received in the buffer folder and interprets the traps received\nchecking, in the centreon database, the actions necessary to process these events. In Centreon DSM we execute a ",(0,r.kt)("strong",{parentName:"p"},"special command"),"."),(0,r.kt)("p",null,"This special command is executing binary ",(0,r.kt)("strong",{parentName:"p"},"dsmclient.pl")," with arguments. This client will store the new trap in a slot\nqueue that the daemon read every 5 seconds."),(0,r.kt)("p",null,"The daemon ",(0,r.kt)("strong",{parentName:"p"},"dsmd.pl"),' will search in database "centreon" name slots (pool service liabilities) associated with the host.\nIf no slot is created, the event is deleted. Otherwise, the binary will look if there is at least one free slot. If at\nleast one slot is free, then it will transmit to monitoring engine external commands to change the state of the slot.\nOtherwise the data will be made no secret pending the release of a slot. A slot is releasable served by paying the\nliabilities.'),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("h3",{id:"configure-slots"},"Configure Slots"),(0,r.kt)("p",null,"Go to ",(0,r.kt)("strong",{parentName:"p"},"Administration > Modules > Dynamic Services")," menu and click on ",(0,r.kt)("strong",{parentName:"p"},"Add")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(166679).Z,width:"770",height:"470"})),(0,r.kt)("p",null,"Please follow the table below in order to understand the role of all parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name"),": This is the name of the slot group."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Description"),": This is the description of the group."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Host Name"),": The name which host the slots."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Service template based"),": The base service template use to create service slots on the host. This template must\nhave been a passive template. This template must be 100 % passive and a custom macro have to be created on it. The\nmacro is named ",(0,r.kt)("strong",{parentName:"li"},"ALARM_ID")," and the default value must be ",(0,r.kt)("strong",{parentName:"li"},"empty"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Number of slots"),": The number of slot that Centreon will create on the selected host when the form will be validated."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Slot name prefix"),": The prefix is used to give the name of slots. The name will be followed by a number increment\nfrom 0 to the number of slots."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Check command"),": This check command is used when the service has to be forced in order to free a slot. The check\ncommand must have to send a ok return code."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Status"),": The status of the slot.")),(0,r.kt)("p",null,"An example of passive service template is available below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(640794).Z,width:"815",height:"664"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The macro ",(0,r.kt)("strong",{parentName:"p"},"ALARM_ID")," is mandatory. The default ",(0,r.kt)("strong",{parentName:"p"},"empty")," value is also necessary.")),(0,r.kt)("p",null,"When you validate the form, Centreon will create or update all slot. If you don't have changed any value, you don't\nhave to do other action. Else you have to ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/pr-2619/docs/22.04/monitoring/monitoring-servers/deploying-a-configuration"},"deploy the configuration")),"."),(0,r.kt)("h3",{id:"configure-traps"},"Configure traps"),(0,r.kt)("p",null,"The last step is to configure traps that you want to redirect to you slots."),(0,r.kt)("p",null,"Edit a SNMP trap that you want to redirect to slots systems. Go to ",(0,r.kt)("strong",{parentName:"p"},"Configuration > SNMP traps > SNMP traps")," menu\nand edit a SNMP trap definition."),(0,r.kt)("p",null,"In order to redirect alarms to slots, you have to enable ",(0,r.kt)("strong",{parentName:"p"},"Execute special command")," in the form and add the following\ncommand into the ",(0,r.kt)("strong",{parentName:"p"},"special command")," field:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon/bin/dsmclient.pl -H @HOSTADDRESS@ -o 'Example output : $*' -i 'linkdown' -s 1 -t @TIME@\n")),(0,r.kt)("p",null,"This command launch for each trap received this command in order to redirect alarms to dsmd daemon."),(0,r.kt)("p",null,"This command take some parameters. You can find in the following table the list and the description of each parameter:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-H"),": Host address (ip or name) in which you want to redirect the alarm. You can pass the value @HOSTADDRESS@ in\norder to keep the same host or you can use whatever you want in order to centralized all alarms on the same virtual\nhost for example who host all alarms."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-o"),": This is the output that dsm will put when the command will submit the result in the good slot. This output\ncan be built will all $* value and with a specific string that you pass in parameter."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-i"),": This is the id of the alarm. The alarm id can be built with the concatenation of some variables like \u201c$1-$4\u201d.\nThe id enable the possibility to use the option of auto-acknowledgement of alarm when you have the possibility to\ncreate the same id during the opening and the closing treatment of the alarm."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-s"),": This is the status that you want to pass in parameter to the alarm. You can use @STATUS@ in order to use the\ninherited status build from matching rule system."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-t"),": This is the time that you want to pass to dsm in order to keep the real trap reception time."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-m"),": This is the list of macros and its values that you want to update during the treatment of the alarm. Please\nfollow the syntax below: macro1=value1|macro2=value2|macro3=value3 This function is used to update some parameters in\nlive on Centreon-Engine core memory without a restart.")),(0,r.kt)("p",null,"Your form should now be like that:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(56157).Z,width:"1030",height:"646"})),(0,r.kt)("p",null,"After saving the form, please generate the\n",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/pr-2619/docs/22.04/monitoring/passive-monitoring/monitoring-with-snmp-traps#Applying-the-changes"},"SNMP traps database definition")),"."),(0,r.kt)("h3",{id:"configure-traps-links"},"Configure Traps links"),(0,r.kt)("p",null,"One thing is different compared to Centreon Trap system is that you cannot link directly the service template of the\nslot to the trap in order to not received x time the trap (x represent here the number of slots)."),(0,r.kt)("p",null,"You have to link traps to an active service of the resource, for example the ",(0,r.kt)("strong",{parentName:"p"},"Ping")," service."),(0,r.kt)("h2",{id:"administration"},"Administration"),(0,r.kt)("h3",{id:"advanced-configuration"},"Advanced configuration"),(0,r.kt)("p",null,"It is possible to overwrite default configuration of the module by creating/editing the\n",(0,r.kt)("strong",{parentName:"p"},"/etc/centreon/centreon_dsmd.pm")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"%centreon_dsmd_config = (\n    # which user will send action\n    centreon_user => 'centreon',\n    # timeout to send command\n    submit_command_timeout => 5,\n    # custom macro used to keep alarm ID\n    macro_config => 'ALARM_ID',\n    # number of alarms retrieve from the cache for analysis\n    sql_fetch => 1000,\n    # interval in seconds to clean locks\n    clean_locks_time => 3600,\n    # duration in seconds to keep locks\n    clean_locks_keep_stored => 3600,\n);\n\n1;\n")),(0,r.kt)("h3",{id:"purging-cache"},"Purging cache"),(0,r.kt)("p",null,"All actions performed by the DSMD engine are logged in the database\n",(0,r.kt)("strong",{parentName:"p"},"centreon_storage"),". A cron is provided to delete the data based on retention."),(0,r.kt)("p",null,"To modify the retention period, by default ",(0,r.kt)("strong",{parentName:"p"},"180 days"),", you can create/edit the\n",(0,r.kt)("strong",{parentName:"p"},"/etc/centreon/centreon_dsm_purge.pm")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"%centreon_dsm_purge_config = (\n    # period in days\n    history_time => 180,\n);\n\n1;\n")),(0,r.kt)("p",null,"To modify the hour of the cron job, you can edit the ",(0,r.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-dsm")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"#####################################\n# Centreon DSM\n#\n\n30 22 * * * root /usr/share/centreon/www/modules/centreon-dsm//cron/centreon_dsm_purge.pl --config='/etc/centreon/conf.pm' --severity=error >> /var/log/centreon/centreon_dsm_purge.log 2>&1\n")))}h.isMDXComponent=!0},640794:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/form-passive-service-e5c48215ae0046f00fc69a85a7c68052.png"},166679:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/form-slot-608269a8170d39da1cf7f7dcbf4728cf.png"},56157:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/trap-form-2-f1eadb2826eff5675a8b420e15dc2b7b.png"}}]);