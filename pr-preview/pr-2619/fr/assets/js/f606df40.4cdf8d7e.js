"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[34479],{603905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>v});var r=n(667294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),u=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,v=c["".concat(i,".").concat(m)]||c[m]||d[m]||o;return n?r.createElement(v,s(s({ref:t},p),{},{components:n})):r.createElement(v,s({ref:t},p))}));function v(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[c]="string"==typeof e?e:a,s[1]=l;for(var u=2;u<o;u++)s[u]=n[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},222503:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>v,frontMatter:()=>l,metadata:()=>u,toc:()=>c});n(667294);var r=n(603905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const l={id:"upgrade-from-19-10",title:"Mont\xe9e de version depuis Centreon 19.10"},i=void 0,u={unversionedId:"upgrade/upgrade-from-19-10",id:"version-22.04/upgrade/upgrade-from-19-10",title:"Mont\xe9e de version depuis Centreon 19.10",description:"Ce chapitre d\xe9crit la proc\xe9dure de mont\xe9e de version de votre plate-forme",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-22.04/upgrade/upgrade-from-19-10.md",sourceDirName:"upgrade",slug:"/upgrade/upgrade-from-19-10",permalink:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/upgrade/upgrade-from-19-10",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-22.04/upgrade/upgrade-from-19-10.md",tags:[],version:"22.04",lastUpdatedAt:1694794170,formattedLastUpdatedAt:"15 sept. 2023",frontMatter:{id:"upgrade-from-19-10",title:"Mont\xe9e de version depuis Centreon 19.10"},sidebar:"version-22.04/docs",previous:{title:"Mont\xe9e de version depuis Centreon 20.04",permalink:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/upgrade/upgrade-from-20-04"},next:{title:"Mont\xe9e de version depuis Centreon 19.04",permalink:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/upgrade/upgrade-from-19-04"}},p={},c=[{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Sauvegarde",id:"sauvegarde",level:3},{value:"Mettre \xe0 jour la cl\xe9 de signature RPM",id:"mettre-\xe0-jour-la-cl\xe9-de-signature-rpm",level:3},{value:"Mont\xe9e de version du serveur Centreon Central",id:"mont\xe9e-de-version-du-serveur-centreon-central",level:2},{value:"Mise \xe0 jour des d\xe9p\xf4ts",id:"mise-\xe0-jour-des-d\xe9p\xf4ts",level:3},{value:"Installer le d\xe9p\xf4t MariaDB",id:"installer-le-d\xe9p\xf4t-mariadb",level:3},{value:"Mont\xe9e de version de PHP",id:"mont\xe9e-de-version-de-php",level:3},{value:"Mont\xe9e de version de la solution Centreon",id:"mont\xe9e-de-version-de-la-solution-centreon",level:3},{value:"Mettre \xe0 jour une configuration Apache personnalis\xe9e",id:"mettre-\xe0-jour-une-configuration-apache-personnalis\xe9e",level:3},{value:"Actions compl\xe9mentaires",id:"actions-compl\xe9mentaires",level:3},{value:"Configurer l&#39;acc\xe8s \xe0 l&#39;API",id:"configurer-lacc\xe8s-\xe0-lapi",level:4},{value:"Mont\xe9e de version du serveur MariaDB",id:"mont\xe9e-de-version-du-serveur-mariadb",level:3},{value:"Mettre \xe0 jour le d\xe9p\xf4t Centreon",id:"mettre-\xe0-jour-le-d\xe9p\xf4t-centreon",level:4},{value:"Configuration",id:"configuration",level:4},{value:"Mont\xe9e de version",id:"mont\xe9e-de-version",level:4},{value:"Activer MariaDB au d\xe9marrage automatique",id:"activer-mariadb-au-d\xe9marrage-automatique",level:4},{value:"Changer le format des tables",id:"changer-le-format-des-tables",level:3},{value:"Finalisation de la mise \xe0 jour",id:"finalisation-de-la-mise-\xe0-jour",level:3},{value:"Actions post mont\xe9e de version",id:"actions-post-mont\xe9e-de-version",level:3},{value:"Mont\xe9e de version des extensions",id:"mont\xe9e-de-version-des-extensions",level:4},{value:"Droits sur les fichiers de Broker et Engine",id:"droits-sur-les-fichiers-de-broker-et-engine",level:4},{value:"D\xe9marrer le gestionnaire de t\xe2ches",id:"d\xe9marrer-le-gestionnaire-de-t\xe2ches",level:4},{value:"Red\xe9marrage des processus de supervision",id:"red\xe9marrage-des-processus-de-supervision",level:4},{value:"Mont\xe9e de version des Remote Servers",id:"mont\xe9e-de-version-des-remote-servers",level:2},{value:"Mont\xe9e de version des collecteurs",id:"mont\xe9e-de-version-des-collecteurs",level:2},{value:"Mise \xe0 jour des d\xe9p\xf4ts",id:"mise-\xe0-jour-des-d\xe9p\xf4ts-1",level:3},{value:"Mont\xe9e de version de la solution Centreon",id:"mont\xe9e-de-version-de-la-solution-centreon-1",level:3},{value:"Actions post mont\xe9e de version",id:"actions-post-mont\xe9e-de-version-1",level:3},{value:"Communications",id:"communications",level:2},{value:"S\xe9curisez votre plateforme",id:"s\xe9curisez-votre-plateforme",level:2}],d={toc:c},m="wrapper";function v(e){var{components:t}=e,l=s(e,["components"]);return(0,r.kt)(m,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},d,l),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Ce chapitre d\xe9crit la proc\xe9dure de mont\xe9e de version de votre plate-forme\nCentreon depuis la version 19.10 vers la version 22.04."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Lorsque vous effectuez la mont\xe9e de version de votre serveur central, assurez-vous d'\xe9galement mettre \xe0 jour tous vos serveurs distants et vos collecteurs. Dans votre architecture, tous les serveurs doivent avoir la m\xeame version de Centreon. De plus, tous les serveurs doivent utiliser la m\xeame ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/developer/developer-broker-bbdo#switching-versions-of-bbdo"},"version du protocole BBDO"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous souhaitez migrer votre serveur Centreon vers Oracle Linux\n/ RHEL 8, vous devez suivre la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/migrate/migrate-from-el-to-el"},"proc\xe9dure de migration"))),(0,r.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,r.kt)("h3",{id:"sauvegarde"},"Sauvegarde"),(0,r.kt)("p",null,"Avant toute chose, il est pr\xe9f\xe9rable de s\u2019assurer de l\u2019\xe9tat et de la consistance\ndes sauvegardes de l\u2019ensemble des serveurs centraux de votre plate-forme :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Serveur Centreon Central,"),(0,r.kt)("li",{parentName:"ul"},"Serveur de gestion de base de donn\xe9es.")),(0,r.kt)("h3",{id:"mettre-\xe0-jour-la-cl\xe9-de-signature-rpm"},"Mettre \xe0 jour la cl\xe9 de signature RPM"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Pour des raisons de s\xe9curit\xe9, les cl\xe9s utilis\xe9es pour signer les RPMs Centreon sont chang\xe9es r\xe9guli\xe8rement. Le dernier changement a eu lieu le 14 octobre 2021. Lorsque vous mettez Centreon \xe0 jour depuis une version plus ancienne, vous devez suivre la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/security/key-rotation#installation-existante"},"proc\xe9dure de changement de cl\xe9"),", afin de supprimer l'ancienne cl\xe9 et d'installer la nouvelle.")),(0,r.kt)("h2",{id:"mont\xe9e-de-version-du-serveur-centreon-central"},"Mont\xe9e de version du serveur Centreon Central"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Depuis la version 21.04, Centreon utilise ",(0,r.kt)("strong",{parentName:"p"},"MariaDB 10.5"),"."),(0,r.kt)("p",{parentName:"blockquote"},"Le processus suivant met seulement \xe0 jour les composants Centreon pour le\nmoment."),(0,r.kt)("p",{parentName:"blockquote"},"MariaDB sera mis \xe0 jour apr\xe8s.")),(0,r.kt)("h3",{id:"mise-\xe0-jour-des-d\xe9p\xf4ts"},"Mise \xe0 jour des d\xe9p\xf4ts"),(0,r.kt)("p",null,"Il est n\xe9cessaire de mettre \xe0 jour le d\xe9p\xf4t Centreon."),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y https://yum.centreon.com/standard/22.04/el7/stable/noarch/RPMS/centreon-release-22.04-3.el7.centos.noarch.rpm\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous \xeates dans un environnement CentOS, il faut installer les d\xe9p\xf4ts de\n",(0,r.kt)("em",{parentName:"p"},"Software Collections")," avec la commande suivante :"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y centos-release-scl-rh\n"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous avez une licence offline, installez le d\xe9p\xf4t des plugin packs correspondant \xe0 la version.\nSi vous avez une \xe9dition Business, installez \xe9galement le d\xe9p\xf4t Business.\nVous pouvez en trouver l'adresse sur le ",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/fr/categories/10341239833105-D%C3%A9p%C3%B4ts"},"portail support Centreon"),".")),(0,r.kt)("h3",{id:"installer-le-d\xe9p\xf4t-mariadb"},"Installer le d\xe9p\xf4t MariaDB"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd /tmp\ncurl -JO https://downloads.mariadb.com/MariaDB/mariadb_repo_setup\nbash ./mariadb_repo_setup\nsed -ri 's/1[0-1]\\.[0-9]+/10.5/' /etc/yum.repos.d/mariadb.repo\nrm -f ./mariadb_repo_setup\n")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-php"},"Mont\xe9e de version de PHP"),(0,r.kt)("p",null,"Centreon 22.04 utilise PHP en version 8.0."),(0,r.kt)("p",null,"Vous devez tout d'abord installer les d\xe9p\xf4ts ",(0,r.kt)("strong",{parentName:"p"},"remi")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y yum-utils\nyum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nyum install -y https://rpms.remirepo.net/enterprise/remi-release-7.rpm\n")),(0,r.kt)("p",null,"Ensuite, vous devez activer le d\xe9p\xf4t php 8.0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum-config-manager --enable remi-php80\n")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-la-solution-centreon"},"Mont\xe9e de version de la solution Centreon"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Assurez-vous que tous les utilisateurs sont d\xe9connect\xe9s avant de commencer\nla proc\xe9dure de mise \xe0 jour.")),(0,r.kt)("p",null,"Si vous avez des extensions Business install\xe9es, mettez \xe0 jour le d\xe9p\xf4t business en 22.04.\nRendez-vous sur le ",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/fr/categories/10341239833105-D%C3%A9p%C3%B4ts"},"portail du support")," pour en r\xe9cup\xe9rer l'adresse."),(0,r.kt)("p",null,"Arr\xeater le processus Centreon Broker :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop cbd\n")),(0,r.kt)("p",null,"Supprimez les fichiers de r\xe9tention pr\xe9sents :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rm /var/lib/centreon-broker/* -f\n")),(0,r.kt)("p",null,"Videz le cache de yum :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Mettez \xe0 jour l'ensemble des composants :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum update centreon\\* php-pecl-gnupg\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Acceptez les nouvelles cl\xe9s GPG des d\xe9p\xf4ts si n\xe9cessaire.")),(0,r.kt)("p",null,"Activez et d\xe9marrez le service ",(0,r.kt)("strong",{parentName:"p"},"gorgoned")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable gorgoned\nsystemctl start gorgoned\n")),(0,r.kt)("p",null,"Le fuseau horaire par d\xe9faut de PHP 8 doit \xeatre configur\xe9. Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'echo "date.timezone = Europe/Paris" >> /etc/php.d/50-centreon.ini\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Remplacez ",(0,r.kt)("strong",{parentName:"p"},"Europe/Paris")," par votre fuseau horaire. La liste des fuseaux\nhoraires est disponible ",(0,r.kt)("a",{parentName:"p",href:"http://php.net/manual/en/timezones.php"},"ici"),".\nEx\xe9cutez les commandes suivantes :"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop rh-php72-php-fpm\nsystemctl disable rh-php72-php-fpm\nsystemctl enable php-fpm\nsystemctl start php-fpm\n"))),(0,r.kt)("h3",{id:"mettre-\xe0-jour-une-configuration-apache-personnalis\xe9e"},"Mettre \xe0 jour une configuration Apache personnalis\xe9e"),(0,r.kt)("p",null,"Cette section s'applique uniquement si vous avez personnalis\xe9 votre configuration Apache. Lors de la mont\xe9e de version, le fichier de configuration Apache n'est pas mis \xe0 jour automatiquement : le nouveau fichier de configuration amen\xe9 par le rpm ne remplace pas l'ancien. Vous devez reporter les changements manuellement dans votre fichier de configuration personnalis\xe9e."),(0,r.kt)("p",null,"Faites un diff entre l'ancien et le nouveau fichier de configuration Apache :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"diff -u /opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf /opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf.rpmnew\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf")," (post mont\xe9e de version) : ce fichier contient la configuration personnalis\xe9e. Il ne contient pas les nouveaut\xe9s apport\xe9es par la mont\xe9e de version, par exemple la cha\xeene ",(0,r.kt)("strong",{parentName:"li"},"authentication")," dans la directive ",(0,r.kt)("strong",{parentName:"li"},"LocationMatch")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf.rpmnew")," (post mont\xe9e de version) : ce fichier est fourni par le rpm; il contient la cha\xeene ",(0,r.kt)("strong",{parentName:"li"},"authentication"),", mais ne contient pas la configuration personnalis\xe9e.")),(0,r.kt)("p",null,"Pour chaque diff\xe9rence entre les fichiers, \xe9valuez si celle-ci doit \xeatre report\xe9e du fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf.rpmnew")," au fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf"),"."),(0,r.kt)("p",null,"Notamment, assurez-vous que votre configuration Apache personnalis\xe9e contient la directive suivante (incluant ",(0,r.kt)("strong",{parentName:"p"},"authentication"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<LocationMatch ^/centreon/(authentication|api/(latest|beta|v[0-9]+|v[0-9]+\\.[0-9]+))/.*$>\n    ProxyPassMatch fcgi://127.0.0.1:9042/usr/share/centreon/api/index.php/$1\n</LocationMatch>\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous utilisiez l'authentification Web SSO, des \xe9tapes de configuration suppl\xe9mentaires sont n\xe9cessaires. Voir la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/releases/centreon-core#breaking-changes"},"note de release"),".")),(0,r.kt)("h3",{id:"actions-compl\xe9mentaires"},"Actions compl\xe9mentaires"),(0,r.kt)("h4",{id:"configurer-lacc\xe8s-\xe0-lapi"},"Configurer l'acc\xe8s \xe0 l'API"),(0,r.kt)("p",null,"Si vous aviez une configuration personnalis\xe9e, le processus de mise \xe0 jour RPM\nn'y a pas touch\xe9."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous utilisez le https, vous pouvez suivre\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/administration/secure-platform#passer-le-serveur-web-en-https"},"cette proc\xe9dure"))),(0,r.kt)("p",null,"Vous devez donc ajouter la section d'acc\xe8s \xe0 l'API dans votre fichier de\nconfiguration apache : ",(0,r.kt)("strong",{parentName:"p"},"/opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-apacheconf"},'Define base_uri "/centreon"\nDefine install_dir "/usr/share/centreon"\n\nServerTokens Prod\n\n<VirtualHost *:80>\n    Header set X-Frame-Options: "sameorigin"\n    Header always edit Set-Cookie ^(.*)$ $1;HttpOnly\n    ServerSignature Off\n    TraceEnable Off\n\n    Alias ${base_uri}/api ${install_dir}\n    Alias ${base_uri} ${install_dir}/www/\n\n    <LocationMatch ^\\${base_uri}/?(?!api/latest/|api/beta/|api/v[0-9]+/|api/v[0-9]+\\.[0-9]+/)(.*\\.php(/.*)?)$>\n        ProxyPassMatch "fcgi://127.0.0.1:9042${install_dir}/www/$1"\n    </LocationMatch>\n\n    <LocationMatch ^\\${base_uri}/?(authentication|api/(latest|beta|v[0-9]+|v[0-9]+\\.[0-9]+))/.*$>\n        ProxyPassMatch "fcgi://127.0.0.1:9042${install_dir}/api/index.php/$1"\n    </LocationMatch>\n\n    ProxyTimeout 300\n    ErrorDocument 404 ${base_uri}/index.html\n    Options -Indexes +FollowSymLinks\n\n    <IfModule mod_security2.c>\n        # https://github.com/SpiderLabs/ModSecurity/issues/652\n        SecRuleRemoveById 200003\n    </IfModule>\n\n    <Directory "${install_dir}/www">\n        DirectoryIndex index.php\n        AllowOverride none\n        Require all granted\n        FallbackResource ${base_uri}/index.html\n    </Directory>\n\n    <Directory "${install_dir}/api">\n        AllowOverride none\n        Require all granted\n    </Directory>\n\n    <If "\'${base_uri}\' != \'/\'">\n        RedirectMatch ^/$ ${base_uri}\n    </If>\n</VirtualHost>\n')),(0,r.kt)("p",null,"Red\xe9marrez ensuite le service Apache :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart httpd24-httpd\n")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-du-serveur-mariadb"},"Mont\xe9e de version du serveur MariaDB"),(0,r.kt)("p",null,"Les composants MariaDB peuvent maintenant \xeatre mis \xe0 jour."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la documentation officielle de MariaDB pour en savoir\nd'avantage sur ce processus :"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"},"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"))),(0,r.kt)("h4",{id:"mettre-\xe0-jour-le-d\xe9p\xf4t-centreon"},"Mettre \xe0 jour le d\xe9p\xf4t Centreon"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Cette \xe9tape est n\xe9cessaire seulement si votre environnement comprend une base de donn\xe9es d\xe9port\xe9e.\nSi le serveur central Centreon et\nMariaDB sont h\xe9berg\xe9s sur le m\xeame serveur, sautez cette \xe9tape.")),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante sur le serveur de base de donn\xe9es d\xe9di\xe9 :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y https://yum.centreon.com/standard/22.04/el7/stable/noarch/RPMS/centreon-release-22.04-3.el7.centos.noarch.rpm\n")),(0,r.kt)("h4",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Le param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"innodb_additional_mem_pool_size")," a \xe9t\xe9 supprim\xe9 depuis MariaDB\n10.2, vous devez donc le supprimer du fichier ",(0,r.kt)("strong",{parentName:"p"},"/etc/my.cnf.d/centreon.cnf")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"#\n# Custom MySQL/MariaDB server configuration for Centreon\n#\n[server]\ninnodb_file_per_table=1\n\nopen_files_limit = 32000\n\nkey_buffer_size = 256M\nsort_buffer_size = 32M\njoin_buffer_size = 4M\nthread_cache_size = 64\nread_buffer_size = 512K\nread_rnd_buffer_size = 256K\nmax_allowed_packet = 8M\n\n# For 4 Go Ram\n-#innodb_additional_mem_pool_size=512M\n#innodb_buffer_pool_size=512M\n\n# For 8 Go Ram\n-#innodb_additional_mem_pool_size=1G\n#innodb_buffer_pool_size=1G\n")),(0,r.kt)("h4",{id:"mont\xe9e-de-version"},"Mont\xe9e de version"),(0,r.kt)("p",null,"Il est n\xe9cessaire de d\xe9sinstaller puis r\xe9installer MariaDB pour changer de version majeure (c'est-\xe0-dire pour passer d'une version 10.1 \xe0 une version 10.5)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Arr\xeatez le service mariadb :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9sinstallez la version actuelle :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-common\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez la version 10.5 :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install MariaDB-server-10.5\\* MariaDB-client-10.5\\* MariaDB-shared-10.5\\* MariaDB-compat-10.5\\* MariaDB-common-10.5\\*\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9marrer le service mariadb :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Lancez le processus de mise \xe0 jour MariaDB :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,r.kt)("p",{parentName:"li"}," Si votre base de donn\xe9es est prot\xe9g\xe9e par mot de passe, entrez :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"}," mysql_upgrade -u <utilisateur_admin_bdd> -p\n")),(0,r.kt)("p",{parentName:"li"}," Exemple : si votre utilisateur_admin_bdd est ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", entrez:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade -u root -p\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la ",(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/mysql_upgrade/"},"documentation officielle"),"\npour plus d'informations ou si des erreurs apparaissent pendant cette derni\xe8re \xe9tape.")))),(0,r.kt)("h4",{id:"activer-mariadb-au-d\xe9marrage-automatique"},"Activer MariaDB au d\xe9marrage automatique"),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable mariadb\n")),(0,r.kt)("h3",{id:"changer-le-format-des-tables"},"Changer le format des tables"),(0,r.kt)("p",null,'Toutes les tables doivent \xeatre au format "dynamic". Pour conna\xeetre le type des tables, ex\xe9cutez les commandes suivantes :'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'mysql -u root\nSELECT table_schema,table_name,row_format FROM information_schema.tables WHERE table_schema IN ("centreon", "centreon_storage") ORDER BY table_schema;\n')),(0,r.kt)("p",null,"Puis quittez mariadb."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"exit\n")),(0,r.kt)("p",null,"Pour changer le type des tables de la base ",(0,r.kt)("strong",{parentName:"p"},"centreon"),", ex\xe9cutez la commande suivante:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'mysql --batch --skip-column-names --execute \'SELECT CONCAT("ALTER TABLE `", table_name, "` ROW_FORMAT=dynamic;") AS aQuery FROM information_schema.tables WHERE table_schema = "centreon" AND row_format IS NOT NULL AND row_format NOT IN ("Dynamic")\' | mysql centreon\n')),(0,r.kt)("p",null,"Pour changer le type des tables de la base ",(0,r.kt)("strong",{parentName:"p"},"centreon_storage"),", ex\xe9cutez la commande suivante:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'mysql --batch --skip-column-names --execute \'SELECT CONCAT("ALTER TABLE `", table_name, "` ROW_FORMAT=dynamic;") AS aQuery FROM information_schema.tables WHERE table_schema = "centreon_storage" AND row_format IS NOT NULL AND row_format NOT IN ("Dynamic")\' | mysql centreon_storage\n')),(0,r.kt)("h3",{id:"finalisation-de-la-mise-\xe0-jour"},"Finalisation de la mise \xe0 jour"),(0,r.kt)("p",null,"Avant de d\xe9marrer la mont\xe9e de version via l'interface web, rechargez le\nserveur Apache avec la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl reload httpd24-httpd\n")),(0,r.kt)("p",null,"Connectez-vous ensuite \xe0 l'interface web Centreon pour d\xe9marrer le processus de\nmise \xe0 jour :"),(0,r.kt)("p",null,"Cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(635821).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(704688).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"La note de version pr\xe9sente les principaux changements, cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(145167).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Le processus r\xe9alise les diff\xe9rentes mises \xe0 jour, cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(324086).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Votre serveur Centreon est maintenant \xe0 jour, cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Finish")," pour\nacc\xe9der \xe0 la page de connexion :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(912243).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Si le module Centreon BAM est install\xe9, r\xe9f\xe9rez-vous \xe0 la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/service-mapping/upgrade"},"documentation\nassoci\xe9e")," pour le mettre \xe0 jour."),(0,r.kt)("h3",{id:"actions-post-mont\xe9e-de-version"},"Actions post mont\xe9e de version"),(0,r.kt)("h4",{id:"mont\xe9e-de-version-des-extensions"},"Mont\xe9e de version des extensions"),(0,r.kt)("p",null,"Depuis le menu ",(0,r.kt)("strong",{parentName:"p"},"Administration > Extensions > Gestionnaire"),", mettez \xe0 jour\ntoutes les extensions, en commen\xe7ant par les suivantes :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"License Manager,"),(0,r.kt)("li",{parentName:"ul"},"Plugin Packs Manager,"),(0,r.kt)("li",{parentName:"ul"},"Auto Discovery.")),(0,r.kt)("p",null,"Vous pouvez alors mettre \xe0 jour toutes les autres extensions commerciales."),(0,r.kt)("h4",{id:"droits-sur-les-fichiers-de-broker-et-engine"},"Droits sur les fichiers de Broker et Engine"),(0,r.kt)("p",null,"Ajustez les droits sur les fichiers de Broker et d'Engine :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"chown apache:apache /etc/centreon-engine/*\nchown apache:apache /etc/centreon-broker/*\nsu - apache -s /bin/bash -c umask\n")),(0,r.kt)("h4",{id:"d\xe9marrer-le-gestionnaire-de-t\xe2ches"},"D\xe9marrer le gestionnaire de t\xe2ches"),(0,r.kt)("p",null,"Depuis la version 20.04, Centreon a chang\xe9 son gestionnaire de t\xe2ches en\npassant de ",(0,r.kt)("em",{parentName:"p"},"Centcore")," \xe0 ",(0,r.kt)("em",{parentName:"p"},"Gorgone"),"."),(0,r.kt)("p",null,"Pour acter ce changement, r\xe9alisez les actions suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centcore\nsystemctl enable gorgoned\nsystemctl start gorgoned\n")),(0,r.kt)("p",null,"Les statistiques Engine qui \xe9taient collect\xe9es par ",(0,r.kt)("em",{parentName:"p"},"Centcore")," le seront\nmaintenant par ",(0,r.kt)("em",{parentName:"p"},"Gorgone")),(0,r.kt)("p",null,"Il faut alors changer les droits sur les fichiers RRD de statistiques en\nex\xe9cutant la commande suivante:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"chown -R centreon-gorgone /var/lib/centreon/nagios-perf/*\n")),(0,r.kt)("h4",{id:"red\xe9marrage-des-processus-de-supervision"},"Red\xe9marrage des processus de supervision"),(0,r.kt)("p",null,"Le composant Centreon Broker a chang\xe9 le format de son fichier de configuration."),(0,r.kt)("p",null,"Il utilise maintenant JSON \xe0 la place de XML."),(0,r.kt)("p",null,"Pour \xeatre sur que Broker et que le module Broker de Engine utilisent les\nnouveaux fichiers de configuration, suivez ces \xe9tapes :"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9ployez la configuration du Central depuis l'interface web en suivant\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/monitoring/monitoring-servers/deploying-a-configuration"},"cette proc\xe9dure"),",")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Red\xe9marrez Broker et Engine sur le serveur Central en ex\xe9cutant la commande\nsuivante:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart cbd centengine\n")))),(0,r.kt)("h2",{id:"mont\xe9e-de-version-des-remote-servers"},"Mont\xe9e de version des Remote Servers"),(0,r.kt)("p",null,"Cette proc\xe9dure est identique \xe0 la mont\xe9e de version d'un serveur Centreon Central."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"En fin de mise \xe0 jour, la configuration doit \xeatre d\xe9ploy\xe9e depuis le serveur Central.")),(0,r.kt)("h2",{id:"mont\xe9e-de-version-des-collecteurs"},"Mont\xe9e de version des collecteurs"),(0,r.kt)("p",null,"Cette proc\xe9dure concerne les collecteurs rattach\xe9s \xe0 un seveur central."),(0,r.kt)("h3",{id:"mise-\xe0-jour-des-d\xe9p\xf4ts-1"},"Mise \xe0 jour des d\xe9p\xf4ts"),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y https://yum.centreon.com/standard/22.04/el7/stable/noarch/RPMS/centreon-release-22.04-3.el7.centos.noarch.rpm\n")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-la-solution-centreon-1"},"Mont\xe9e de version de la solution Centreon"),(0,r.kt)("p",null,"Videz le cache de yum :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Mettez \xe0 jour l'ensemble des composants :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum update centreon\\*\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Acceptez les nouvelles cl\xe9s GPG des d\xe9p\xf4ts si n\xe9cessaire.")),(0,r.kt)("p",null,"D\xe9marrez et activez ",(0,r.kt)("strong",{parentName:"p"},"gorgoned"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start gorgoned\nsystemctl enable gorgoned\n")),(0,r.kt)("p",null,"Red\xe9marrez ",(0,r.kt)("strong",{parentName:"p"},"centengine"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart centengine\n")),(0,r.kt)("h3",{id:"actions-post-mont\xe9e-de-version-1"},"Actions post mont\xe9e de version"),(0,r.kt)("p",null,"Du fait du nouveau format de configuration du module Broker de Engine, la\nconfiguration doit \xeatre re-d\xe9ploy\xe9e."),(0,r.kt)("p",null,"D\xe9ployez la configuration du Poller depuis l'interface web en suivant\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/monitoring/monitoring-servers/deploying-a-configuration"},"cette proc\xe9dure"),",\net en choisissant la m\xe9thode ",(0,r.kt)("em",{parentName:"p"},"Red\xe9marrer")," pour le processus Engine"),(0,r.kt)("h2",{id:"communications"},"Communications"),(0,r.kt)("p",null,"Par d\xe9faut, la communication entre le serveur Central et les Pollers ou les\nRemote Servers utilisera toujours SSH."),(0,r.kt)("p",null,"Consid\xe9rez changer le protocole de communication en suivant la proc\xe9dure\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/monitoring/monitoring-servers/communications#changer-la-communication-de-ssh-a-zmq"},"Changer la communication de SSH \xe0 ZMQ"),"."),(0,r.kt)("h2",{id:"s\xe9curisez-votre-plateforme"},"S\xe9curisez votre plateforme"),(0,r.kt)("p",null,"N'oubliez pas de s\xe9curiser votre plateforme Centreon en suivant nos\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2619/fr/docs/22.04/administration/secure-platform"},"recommandations")))}v.isMDXComponent=!0},635821:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_1-229784d5ed7986045c49b65b99ce38cd.png"},704688:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_2-f12be23b17ba9e83853cbdbaaea65402.png"},145167:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_3-d505e49a3b4f60dfd887ff45ddbf006b.png"},324086:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_4-97901eb976096c68fb2bd9d37c4de9bc.png"},912243:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_5-01f8c54614c006d7c1bf9e03799c1b81.png"}}]);