"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[79841],{603905:(e,r,a)=>{a.d(r,{Zo:()=>u,kt:()=>b});var t=a(667294);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?o(Object(a),!0).forEach((function(r){n(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function l(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=t.createContext({}),s=function(e){var r=t.useContext(p),a=r;return e&&(a="function"==typeof e?e(r):i(i({},r),e)),a},u=function(e){var r=s(e.components);return t.createElement(p.Provider,{value:r},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},c=t.forwardRef((function(e,r){var a=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(a),c=n,b=d["".concat(p,".").concat(c)]||d[c]||m[c]||o;return a?t.createElement(b,i(i({ref:r},u),{},{components:a})):t.createElement(b,i({ref:r},u))}));function b(e,r){var a=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=c;var l={};for(var p in r)hasOwnProperty.call(r,p)&&(l[p]=r[p]);l.originalType=e,l[d]="string"==typeof e?e:n,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}c.displayName="MDXCreateElement"},849604:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>u,contentTitle:()=>p,default:()=>b,frontMatter:()=>l,metadata:()=>s,toc:()=>d});a(667294);var t=a(603905);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})),e}function i(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}const l={id:"upgrade-mariadb",title:"Mettre \xe0 jour MariaDB"},p=void 0,s={unversionedId:"upgrade/upgrade-mariadb",id:"version-21.10/upgrade/upgrade-mariadb",title:"Mettre \xe0 jour MariaDB",description:"Vous pouvez potentiellement avoir plusieurs bases MariaDB dans votre architecture. Le serveur central a une base, chaque serveur distant a une base, et les modules MBI et MAP ont chacun une base d\xe9di\xe9e. Dans une architecture, toutes les bases doivent avoir la m\xeame version de MariaDB.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-21.10/upgrade/upgrade-mariadb.md",sourceDirName:"upgrade",slug:"/upgrade/upgrade-mariadb",permalink:"/centreon-documentation/pr-preview/pr-2569/fr/docs/21.10/upgrade/upgrade-mariadb",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-21.10/upgrade/upgrade-mariadb.md",tags:[],version:"21.10",lastUpdatedAt:1693986686,formattedLastUpdatedAt:"6 sept. 2023",frontMatter:{id:"upgrade-mariadb",title:"Mettre \xe0 jour MariaDB"},sidebar:"version-21.10/docs",previous:{title:"Mont\xe9e de version de Centreon Failover vers Centreon HA",permalink:"/centreon-documentation/pr-preview/pr-2569/fr/docs/21.10/upgrade/centreon-ha/upgrade-from-centreon-failover"},next:{title:"Introduction",permalink:"/centreon-documentation/pr-preview/pr-2569/fr/docs/21.10/migrate/introduction"}},u={},d=[{value:"Processus de mise \xe0 jour",id:"processus-de-mise-\xe0-jour",level:2},{value:"Version de Maria DB par version de Centreon",id:"version-de-maria-db-par-version-de-centreon",level:2},{value:"Conna\xeetre la version de MariaDB",id:"conna\xeetre-la-version-de-mariadb",level:2},{value:"Changer de version majeure de MariaDB",id:"changer-de-version-majeure-de-mariadb",level:2},{value:"Mont\xe9e de version de 10.1 \xe0 10.5",id:"mont\xe9e-de-version-de-101-\xe0-105",level:3},{value:"Changer de version mineure de MariaDB",id:"changer-de-version-mineure-de-mariadb",level:2}],m={toc:d},c="wrapper";function b(e){var{components:r}=e,a=i(e,["components"]);return(0,t.kt)(c,o(function(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{},t=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),t.forEach((function(r){n(e,r,a[r])}))}return e}({},m,a),{components:r,mdxType:"MDXLayout"}),(0,t.kt)("p",null,"Vous pouvez potentiellement avoir plusieurs bases MariaDB dans votre architecture. Le serveur central a une base, chaque serveur distant a une base, et les modules MBI et MAP ont chacun une base d\xe9di\xe9e. Dans une architecture, toutes les bases doivent avoir la m\xeame version de MariaDB."),(0,t.kt)("h2",{id:"processus-de-mise-\xe0-jour"},"Processus de mise \xe0 jour"),(0,t.kt)("p",null,"Lorsque vous passez d'une version majeure de Centreon \xe0 une autre, vous devez :"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Upgrader Centreon (paquets, installation web, d\xe9ploiement de la configuration)."),(0,t.kt)("li",{parentName:"ol"},"Upgrader MariaDB.")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la documentation officielle de MariaDB pour en savoir davantage sur le processus de mise \xe0 jour :"),(0,t.kt)("ul",{parentName:"blockquote"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"},"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/")))),(0,t.kt)("h2",{id:"version-de-maria-db-par-version-de-centreon"},"Version de Maria DB par version de Centreon"),(0,t.kt)("table",null,(0,t.kt)("thead",{parentName:"table"},(0,t.kt)("tr",{parentName:"thead"},(0,t.kt)("th",{parentName:"tr",align:null},"Centreon"),(0,t.kt)("th",{parentName:"tr",align:null},"MariaDB"))),(0,t.kt)("tbody",{parentName:"table"},(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"21.10"),(0,t.kt)("td",{parentName:"tr",align:null},"10.5")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"21.04"),(0,t.kt)("td",{parentName:"tr",align:null},"10.5")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"20.10"),(0,t.kt)("td",{parentName:"tr",align:null},"10.3.x")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"20.04"),(0,t.kt)("td",{parentName:"tr",align:null},"10.3.x")),(0,t.kt)("tr",{parentName:"tbody"},(0,t.kt)("td",{parentName:"tr",align:null},"19.10"),(0,t.kt)("td",{parentName:"tr",align:null},"10.1.x")))),(0,t.kt)("h2",{id:"conna\xeetre-la-version-de-mariadb"},"Conna\xeetre la version de MariaDB"),(0,t.kt)("p",null,"Pour conna\xeetre la version de MariaDB install\xe9e sur une machine, tapez la commande suivante :"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"rpm -qa |grep MariaDB\n")),(0,t.kt)("p",null,"Le r\xe9sultat doit ressembler \xe0 \xe7a :"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"MariaDB-client-10.5.8-1.el7.centos.x86_64\nMariaDB-server-10.5.8-1.el7.centos.x86_64\nMariaDB-common-10.5.8-1.el7.centos.x86_64\nMariaDB-shared-10.5.8-1.el7.centos.x86_64\nMariaDB-compat-10.5.8-1.el7.centos.x86_64\n")),(0,t.kt)("h2",{id:"changer-de-version-majeure-de-mariadb"},"Changer de version majeure de MariaDB"),(0,t.kt)("p",null,"Il est n\xe9cessaire de d\xe9sinstaller puis r\xe9installer MariaDB pour changer de version majeure (par exemple pour passer d'une version 10.4 \xe0 une version 10.5)."),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Arr\xeatez le service mariadb :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop mariadb\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"D\xe9sinstallez la version actuelle :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-compat MariaDB-common\n")),(0,t.kt)("blockquote",{parentName:"li"},(0,t.kt)("p",{parentName:"blockquote"},"Pendant cette \xe9tape de d\xe9sinstallation, vous pouvez rencontrer une erreur parce qu'un ou plusieurs paquets MariaDB sont manquants. Dans ce cas, vous devez ex\xe9cuter la commande de d\xe9sinstallation sans inclure le paquet manquant.")),(0,t.kt)("p",{parentName:"li"},"  Par exemple, vous obtenez le message d'erreur suivant :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"package MariaDB-compat is not installed\n")),(0,t.kt)("p",{parentName:"li"},"  Comme le paquet ",(0,t.kt)("strong",{parentName:"p"},"MariaDB-compat")," est manquant, vous devez ex\xe9cuter la m\xeame commande sans citer ",(0,t.kt)("strong",{parentName:"p"},"MariaDB-compat")," :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-common\n")),(0,t.kt)("blockquote",{parentName:"li"},(0,t.kt)("p",{parentName:"blockquote"},"Assurez-vous d'avoir ",(0,t.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2569/fr/docs/21.10/upgrade/upgrade-from-21-04#installer-le-d%C3%A9p%C3%B4t-mariadb"},"install\xe9 le d\xe9p\xf4t officiel de MariaDB")," avant de poursuivre la proc\xe9dure."))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Installez la version 10.5 :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"yum install MariaDB-server-10.5\\* MariaDB-client-10.5\\* MariaDB-shared-10.5\\* MariaDB-common-10.5\\*\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"D\xe9marrer le service mariadb :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Lancez le processus de mise \xe0 jour MariaDB :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,t.kt)("p",{parentName:"li"}," Si votre base de donn\xe9es est prot\xe9g\xe9e par mot de passe, entrez :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"}," mysql_upgrade -u <utilisateur_admin_bdd> -p\n")),(0,t.kt)("p",{parentName:"li"}," Exemple : si votre utilisateur_admin_bdd est ",(0,t.kt)("inlineCode",{parentName:"p"},"root"),", entrez:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"mysql_upgrade -u root -p\n")),(0,t.kt)("blockquote",{parentName:"li"},(0,t.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la ",(0,t.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/mysql_upgrade/"},"documentation officielle"),"\npour plus d'informations ou si des erreurs apparaissent pendant cette \xe9tape."))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Pour activer MariaDB, ex\xe9cutez la commande suivante :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable mariadb\n")))),(0,t.kt)("h3",{id:"mont\xe9e-de-version-de-101-\xe0-105"},"Mont\xe9e de version de 10.1 \xe0 10.5"),(0,t.kt)("p",null,"Le param\xe8tre ",(0,t.kt)("inlineCode",{parentName:"p"},"innodb_additional_mem_pool_size")," a \xe9t\xe9 supprim\xe9 depuis MariaDB\n10.2, vous devez donc le supprimer du fichier ",(0,t.kt)("strong",{parentName:"p"},"/etc/my.cnf.d/centreon.cnf")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-diff"},"#\n# Custom MySQL/MariaDB server configuration for Centreon\n#\n[server]\ninnodb_file_per_table=1\n\nopen_files_limit = 32000\n\nkey_buffer_size = 256M\nsort_buffer_size = 32M\njoin_buffer_size = 4M\nthread_cache_size = 64\nread_buffer_size = 512K\nread_rnd_buffer_size = 256K\nmax_allowed_packet = 8M\n\n# For 4 Go Ram\n-#innodb_additional_mem_pool_size=512M\n#innodb_buffer_pool_size=512M\n\n# For 8 Go Ram\n-#innodb_additional_mem_pool_size=1G\n#innodb_buffer_pool_size=1G\n")),(0,t.kt)("h2",{id:"changer-de-version-mineure-de-mariadb"},"Changer de version mineure de MariaDB"),(0,t.kt)("p",null,"Suivez ces \xe9tapes pour changer de version mineure de MariaDB (par exemple, pour passer d'une 10.3.2 \xe0 une 10.3.5) : "),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Mettez \xe0 jour MariaDB :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"yum update mariadb-*\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Red\xe9marrez MariaDB :"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"restart mariadb\n")))))}b.isMDXComponent=!0}}]);