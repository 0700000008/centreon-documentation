"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[9650],{603905:(e,r,n)=>{n.d(r,{Zo:()=>p,kt:()=>g});var t=n(667294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=t.createContext({}),u=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):s(s({},r),e)),n},p=function(e){var r=u(e.components);return t.createElement(l.Provider,{value:r},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},m=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,g=d["".concat(l,".").concat(m)]||d[m]||c[m]||o;return n?t.createElement(g,s(s({ref:r},p),{},{components:n})):t.createElement(g,s({ref:r},p))}));function g(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in r)hasOwnProperty.call(r,l)&&(i[l]=r[l]);i.originalType=e,i[d]="string"==typeof e?e:a,s[1]=i;for(var u=2;u<o;u++)s[u]=n[u];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},602909:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>u,toc:()=>d});n(667294);var t=n(603905);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})),e}function s(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={id:"backup-restore",title:"Sauvegarde et restauration"},l=void 0,u={unversionedId:"reporting/backup-restore",id:"version-22.10/reporting/backup-restore",title:"Sauvegarde et restauration",description:"Sauvegarde de Centreon MBI",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-22.10/reporting/backup-restore.md",sourceDirName:"reporting",slug:"/reporting/backup-restore",permalink:"/centreon-documentation/pr-preview/pr-2581/fr/docs/22.10/reporting/backup-restore",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-22.10/reporting/backup-restore.md",tags:[],version:"22.10",lastUpdatedAt:1693555452,formattedLastUpdatedAt:"1 sept. 2023",frontMatter:{id:"backup-restore",title:"Sauvegarde et restauration"},sidebar:"version-22.10/docs",previous:{title:"Migrer l'extension",permalink:"/centreon-documentation/pr-preview/pr-2581/fr/docs/22.10/reporting/migrate"},next:{title:"Centreon UI",permalink:"/centreon-documentation/pr-preview/pr-2581/fr/docs/22.10/administration/parameters/centreon-ui"}},p={},d=[{value:"Sauvegarde de Centreon MBI",id:"sauvegarde-de-centreon-mbi",level:2},{value:"Sauvegarde des donn\xe9es de configuration",id:"sauvegarde-des-donn\xe9es-de-configuration",level:3},{value:"Elements sauvegard\xe9s",id:"elements-sauvegard\xe9s",level:4},{value:"Fonctionnement du script de sauvegarde",id:"fonctionnement-du-script-de-sauvegarde",level:4},{value:"P\xe9riodicit\xe9 des sauvegardes",id:"p\xe9riodicit\xe9-des-sauvegardes",level:4},{value:"Sauvegarde du serveur de reporting d\xe9di\xe9",id:"sauvegarde-du-serveur-de-reporting-d\xe9di\xe9",level:3},{value:"Elements sauvegard\xe9s",id:"elements-sauvegard\xe9s-1",level:4},{value:"Fonctionnement du script de sauvegarde sur un serveur central",id:"fonctionnement-du-script-de-sauvegarde-sur-un-serveur-central",level:4},{value:"P\xe9riodicit\xe9 des sauvegardes",id:"p\xe9riodicit\xe9-des-sauvegardes-1",level:4},{value:"Restauration de Centreon MBI",id:"restauration-de-centreon-mbi",level:2},{value:"Restauration des donn\xe9es de configuration",id:"restauration-des-donn\xe9es-de-configuration",level:3},{value:"R\xe9installation du module Centreon MBI",id:"r\xe9installation-du-module-centreon-mbi",level:4},{value:"Int\xe9gration des anciens rapports g\xe9n\xe9r\xe9s",id:"int\xe9gration-des-anciens-rapports-g\xe9n\xe9r\xe9s",level:4},{value:"Int\xe9gration des param\xe8tres de rapports personnalis\xe9s",id:"int\xe9gration-des-param\xe8tres-de-rapports-personnalis\xe9s",level:4},{value:"Int\xe9gration des donn\xe9es de configuration Centreon MBI",id:"int\xe9gration-des-donn\xe9es-de-configuration-centreon-mbi",level:4},{value:"Supprimer les donn\xe9es extraites de la sauvegarde",id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde",level:4},{value:"Restauration des param\xe8tres du serveur de reporting Centreon MBI",id:"restauration-des-param\xe8tres-du-serveur-de-reporting-centreon-mbi",level:3},{value:"R\xe9installation du module Centreon MBI",id:"r\xe9installation-du-module-centreon-mbi-1",level:4},{value:"Int\xe9gration de la configuration du moteur CBIS",id:"int\xe9gration-de-la-configuration-du-moteur-cbis",level:4},{value:"Int\xe9gration des mod\xe8les de rapports personnalis\xe9s",id:"int\xe9gration-des-mod\xe8les-de-rapports-personnalis\xe9s",level:4},{value:"Int\xe9gration des donn\xe9es MariaDB",id:"int\xe9gration-des-donn\xe9es-mariadb",level:3},{value:"Red\xe9marrer le moteur CBIS",id:"red\xe9marrer-le-moteur-cbis",level:4},{value:"Supprimer les donn\xe9es extraites de la sauvegarde",id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde-1",level:4}],c={toc:d},m="wrapper";function g(e){var{components:r}=e,n=s(e,["components"]);return(0,t.kt)(m,o(function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){a(e,r,n[r])}))}return e}({},c,n),{components:r,mdxType:"MDXLayout"}),(0,t.kt)("h2",{id:"sauvegarde-de-centreon-mbi"},"Sauvegarde de Centreon MBI"),(0,t.kt)("h3",{id:"sauvegarde-des-donn\xe9es-de-configuration"},"Sauvegarde des donn\xe9es de configuration"),(0,t.kt)("h4",{id:"elements-sauvegard\xe9s"},"Elements sauvegard\xe9s"),(0,t.kt)("p",null,"Les \xe9l\xe9ments sauvegard\xe9s sont les suivants :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sauvegarde des mod\xe8les de rapports personnalis\xe9s et de leur\nparam\xe8trage"),(0,t.kt)("li",{parentName:"ul"},"Sauvegarde des rapports g\xe9n\xe9r\xe9s")),(0,t.kt)("h4",{id:"fonctionnement-du-script-de-sauvegarde"},"Fonctionnement du script de sauvegarde"),(0,t.kt)("p",null,"Le script de sauvegarde est ex\xe9cut\xe9 de mani\xe8re journali\xe8re via un cron\nd\xe9fini dans le fichier ",(0,t.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-bi-backup-web")," :"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'#\n# Cron to backup Centreon MBI Engine frontend module\n#\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\n\n# rewrite file with new cron line\nCRONTAB_EXEC_USER=""\n\n0 12 * * * root bash /usr/share/centreon-bi-backup/centreon-bi-backup-web.sh >> /var/log/centreon-bi/centreon-bi-backup-web.log 2>&1\n')),(0,t.kt)("p",null,"Les donn\xe9es sauvegard\xe9es se trouvent par d\xe9faut dans le r\xe9pertoire :\n",(0,t.kt)("strong",{parentName:"p"},"/var/backup"),"."),(0,t.kt)("p",null,"Pour modifier ce r\xe9pertoire, mettre \xe0 jour la valeur ",(0,t.kt)("strong",{parentName:"p"},"BACKUP","_","DIR"),"\n(ligne ",(0,t.kt)("strong",{parentName:"p"},"63"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-web.sh")),(0,t.kt)("p",null,"Sur un server Centreon seule la configuration, les rapports g\xe9n\xe9r\xe9s et\nles mod\xe8les de rapports personnalis\xe9s ont besoin d'\xeatre sauvegard\xe9s. La\nsauvegarde est au format suivant :\ncentreon-bi-front-reports-and-custom-conf-aaaa-mm-jj.tar.gz"),(0,t.kt)("h4",{id:"p\xe9riodicit\xe9-des-sauvegardes"},"P\xe9riodicit\xe9 des sauvegardes"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"P\xe9riodicit\xe9 des sauvegardes : journali\xe8res"),(0,t.kt)("li",{parentName:"ul"},"Rotation des sauvegardes : 8 jours")),(0,t.kt)("p",null,"Pour modifier la valeur de rotation des sauvegardes, \xe9diter la valeur\n",(0,t.kt)("strong",{parentName:"p"},"RETENTION","_","AGE")," (ligne ",(0,t.kt)("strong",{parentName:"p"},"67"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-web.sh")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Il est important d'exporter les sauvegardes sur une autre machine\nafin d'assurer leurs p\xe9rennit\xe9s.")),(0,t.kt)("h3",{id:"sauvegarde-du-serveur-de-reporting-d\xe9di\xe9"},"Sauvegarde du serveur de reporting d\xe9di\xe9"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Il est important de disposer d'au moins 5 Go d'espace libre sur le\n",(0,t.kt)("strong",{parentName:"p"},"Volume Group")," h\xe9bergeant l'espace de stockage ",(0,t.kt)("strong",{parentName:"p"},"data")," du SGBD\nMariaDB. Pour cela, ex\xe9cuter la commande suivante en renseignant\nle nom du ",(0,t.kt)("strong",{parentName:"p"},"Volume Group")," :")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"vgdisplay vg_data | grep -i free \n")),(0,t.kt)("h4",{id:"elements-sauvegard\xe9s-1"},"Elements sauvegard\xe9s"),(0,t.kt)("p",null,"Les \xe9l\xe9ments sauvegard\xe9s sont les suivants :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Param\xe8tres de configuration du moteur de g\xe9n\xe9ration de rapports"),(0,t.kt)("li",{parentName:"ul"},"Donn\xe9es agr\xe9gg\xe9es"),(0,t.kt)("li",{parentName:"ul"},"Rapports & ressources")),(0,t.kt)("h4",{id:"fonctionnement-du-script-de-sauvegarde-sur-un-serveur-central"},"Fonctionnement du script de sauvegarde sur un serveur central"),(0,t.kt)("p",null,"Le script de sauvegarde est ex\xe9cut\xe9 de mani\xe8re journali\xe8re via un cron\nd\xe9fini dans le fichier\n",(0,t.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-bi-backup-reporting-server")," :"),(0,t.kt)("blockquote",null,(0,t.kt)("pre",{parentName:"blockquote"},(0,t.kt)("code",{parentName:"pre"},'#\n# Cron to backup Centreon MBI reporting server\n#\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\n\n# rewrite file with new cron line\nCRONTAB_EXEC_USER=""\n\n30 12 * * 0 root bash /usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh --total >> /var/log/centreon-bi/centreon-bi-backup-reporting-server-db.log 2>&1\n30 12 * * 1-6 root bash /usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh --totalincr >> /var/log/centreon-bi/centreon-bi-backup-reporting-server-db.log 2>&1\n0 12 * * * root bash /usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh --centreonbifiles >> /var/log/centreon-bi/centreon-bi-backup-reporting-server-files.log 2>&1\n'))),(0,t.kt)("p",null,"Les donn\xe9es sauvegard\xe9es se trouvent par d\xe9faut dans le r\xe9pertoire :\n",(0,t.kt)("strong",{parentName:"p"},"/var/backup"),"."),(0,t.kt)("p",null,"Pour modifier ce r\xe9pertoire, mettre \xe0 jour la valeur ",(0,t.kt)("strong",{parentName:"p"},"BACKUP","_","DIR"),"\n(ligne ",(0,t.kt)("strong",{parentName:"p"},"83"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh")),(0,t.kt)("p",null,"Trois types de sauvegarde sont ex\xe9cut\xe9s dans la semaine :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"tous les jours une sauvegarde des fichiers de configuration du\nmoteur de g\xe9n\xe9ration des rapports, format :\ncentreon-bin-reports-and-conf-aaaa-mm-jj.tar.gz"),(0,t.kt)("li",{parentName:"ul"},"tous les dimanches une sauvegarde compl\xe8te de l'ETL, format :\nmysql-centreon","_","storage-bi-aaaa-mm-jj.tar.gz"),(0,t.kt)("li",{parentName:"ul"},"du lundi au samedi une sauvegarde incr\xe9mentale de l'ETL (toutes les\ntables et seulement la derni\xe8re partition des tables partitionn\xe9es),\nformat : mysql-centreon","_","storage-bi-aaaa-mm-jj.tar.gz")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"Important")),(0,t.kt)("p",{parentName:"blockquote"},"Bien s'assurer que pendant la sauvegarde du serveur de repoting, les\nscipts ETL ne doivent pas \xeatre en cours d'execution. De plus, aucun\nrapport ne doit \xeatre en cours de g\xe9n\xe9ration.")),(0,t.kt)("h4",{id:"p\xe9riodicit\xe9-des-sauvegardes-1"},"P\xe9riodicit\xe9 des sauvegardes"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"P\xe9riodicit\xe9 des sauvegardes : journali\xe8res"),(0,t.kt)("li",{parentName:"ul"},"Rotation des sauvegardes : 8 jours")),(0,t.kt)("p",null,"Pour modifier la valeur de rotation des sauvegardes, \xe9diter la valeur\n",(0,t.kt)("strong",{parentName:"p"},"RETENTION","_","AGE")," (ligne ",(0,t.kt)("strong",{parentName:"p"},"88"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Il est important d'exporter les sauvegardes sur une autre machine\nafin d'assurer leurs p\xe9rennit\xe9s.")),(0,t.kt)("h2",{id:"restauration-de-centreon-mbi"},"Restauration de Centreon MBI"),(0,t.kt)("h3",{id:"restauration-des-donn\xe9es-de-configuration"},"Restauration des donn\xe9es de configuration"),(0,t.kt)("p",null,"Le processus de restauration comprend plusieurs \xe9tapes :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"R\xe9installation du module ",(0,t.kt)("strong",{parentName:"li"},"centreon-bi-server")," dans une version\nidentique \xe0 celle sauvegard\xe9e."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des anciens rapports g\xe9n\xe9r\xe9s."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des param\xe8tres de rapports personnalis\xe9s."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des donn\xe9es de configuration Centreon MBI."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des donn\xe9es MariaDB."),(0,t.kt)("li",{parentName:"ul"},"Supprimer les donn\xe9es extraites de la sauvegarde."),(0,t.kt)("li",{parentName:"ul"},"R\xe9installer la sauvegarde.")),(0,t.kt)("h4",{id:"r\xe9installation-du-module-centreon-mbi"},"R\xe9installation du module Centreon MBI"),(0,t.kt)("p",null,"Sur le serveur central Centreon, lancer la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"yum install centreon-bi-server-x.y.z\n")),(0,t.kt)("h4",{id:"int\xe9gration-des-anciens-rapports-g\xe9n\xe9r\xe9s"},"Int\xe9gration des anciens rapports g\xe9n\xe9r\xe9s"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bi-front-reports-and-custom-conf-aaaa-mm-jj.tar.gz")," et\nextraire celle-ci dans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"cd /tmp\ntar xzf centreon-bi-front-reports-and-custom-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9grer les rapports g\xe9n\xe9r\xe9s via la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"/bin/cp -rf /tmp/var/lib/centreon/centreon-bi-server/archives/* /var/lib/centreon/centreon-bi-server/archives\n")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Si le r\xe9pertoire est diff\xe9rent, c'est que les param\xe8tres par d\xe9faut ont\n\xe9t\xe9 modifi\xe9s par l'utilisateur. Il suffit simplement de reprendre la\nbonne arborescence.")),(0,t.kt)("p",null,"Modifier les droits sur les fichiers ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"chown -R centreonBI:centreonBI /var/lib/centreon/centreon-bi-server/archives \n")),(0,t.kt)("h4",{id:"int\xe9gration-des-param\xe8tres-de-rapports-personnalis\xe9s"},"Int\xe9gration des param\xe8tres de rapports personnalis\xe9s"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bi-front-reports-and-custom-conf-aaaa-mm-jj.tar.gz")," et\nextraire celle-ci dans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"# cd /tmp\ntar xzf centreon-bi-front-reports-and-custom-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9gration des anciens param\xe8tres ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"/bin/cp -rf /tmp/usr/share/centreon/www/modules/centreon-bi-server/configuration/generation/xsl/* /usr/share/centreon/www/modules/centreon-bi-server/configuration/generation/xsl\n/bin/cp -rf /tmp/var/lib/centreon/centreon-bi-server/reports/infos/* /var/lib/centreon/centreon-bi-server/reports/infos\n")),(0,t.kt)("p",null,"Modifier les droits sur les fichiers ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"chown -R apache:apache /usr/share/centreon/www/modules/centreon-bi-server/configuration/generation/xsl\n")),(0,t.kt)("h4",{id:"int\xe9gration-des-donn\xe9es-de-configuration-centreon-mbi"},"Int\xe9gration des donn\xe9es de configuration Centreon MBI"),(0,t.kt)("p",null,"Int\xe9grer la sauvegarde SQL via la commande suivante ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"mysql -u root -p centreon_storage < /tmp/var/backup/dump_centreon_storage.sql\n")),(0,t.kt)("h4",{id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde"},"Supprimer les donn\xe9es extraites de la sauvegarde"),(0,t.kt)("p",null,"Supprimer les donn\xe9es extraites via les commandes suivantes ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"cd /tmp\nrm -Rf /tmp/usr\nrm -Rf /tmp/var\n")),(0,t.kt)("h3",{id:"restauration-des-param\xe8tres-du-serveur-de-reporting-centreon-mbi"},"Restauration des param\xe8tres du serveur de reporting Centreon MBI"),(0,t.kt)("p",null,"Le processus de restauration comprend plusieurs \xe9tapes :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"R\xe9installation du module ",(0,t.kt)("strong",{parentName:"li"},"centreon-bi-reporting-server")," dans une\nversion identique \xe0 celle sauvegard\xe9e."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration de la configuration du moteur CBIS."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des mod\xe8les de rapports personnalis\xe9s."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des donn\xe9es."),(0,t.kt)("li",{parentName:"ul"},"Red\xe9marrer le moteur CBIS."),(0,t.kt)("li",{parentName:"ul"},"Supprimer les donn\xe9es extraites de la sauvegarde."),(0,t.kt)("li",{parentName:"ul"},"R\xe9installer la sauvegarde.")),(0,t.kt)("h4",{id:"r\xe9installation-du-module-centreon-mbi-1"},"R\xe9installation du module Centreon MBI"),(0,t.kt)("p",null,"Sur le serveur central Centreon, lancer la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"yum install centreon-bi-reporting-server-x.y.z\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"*x.y.z")," correspond \xe0 la version exacte du module sauvegard\xe9.*"),(0,t.kt)("h4",{id:"int\xe9gration-de-la-configuration-du-moteur-cbis"},"Int\xe9gration de la configuration du moteur CBIS"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bin-reports-and-conf-aaaa-mm-jj.tar.gz")," et extraire celle-ci\ndans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"cd /tmp\ntar xzf centreon-bin-reports-and-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9grer la configuration via la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"# /bin/cp -rf /tmp/etc/centreon-bi/* /etc/centreon-bi\n")),(0,t.kt)("h4",{id:"int\xe9gration-des-mod\xe8les-de-rapports-personnalis\xe9s"},"Int\xe9gration des mod\xe8les de rapports personnalis\xe9s"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bin-reports-and-conf-aaaa-mm-jj.tar.gz")," et extraire celle-ci\ndans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"cd /tmp\ntar xzf /var/backup/centreon-bin-reports-and-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9grer les mod\xe8les de rapports via les commandes ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"/bin/cp -rf /tmp/usr/share/centreon-bi/reports/* /usr/share/centreon-bi/reports\nchown -R centreonBI:centreonBI /usr/share/centreon-bi/reports\n/bin/cp -rf /tmp/usr/share/centreon-bi/Resources/* /usr/share/centreon-bi/Resources\nchown -R centreonBI:centreonBI /usr/share/centreon-bi/Resources\n")),(0,t.kt)("h3",{id:"int\xe9gration-des-donn\xe9es-mariadb"},"Int\xe9gration des donn\xe9es MariaDB"),(0,t.kt)("p",null,"Arr\xeater le service MariaDB ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"systemctl stop mysql\n")),(0,t.kt)("p",null,"Supprimer le r\xe9p\xe9rtoire ",(0,t.kt)("em",{parentName:"p"},"/var/lib/mysql")," du serveur de reporting::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"rm -rf /var/lib/mysql\n")),(0,t.kt)("p",null,"D\xe9compresser la derni\xe8re sauvegarde totale ( par d\xe9faut la sauvegarde\ntotale est faite le dimanche)::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"tar -xzf /var/backup/mysql-centreon_storage-bi-xxxx-xx-xx.tar.gz -C /\n")),(0,t.kt)("p",null,"D\xe9compresser l'ensemble des sauvegardes partielles faites entre la\nsauvegarde totale et la date du jour, ",(0,t.kt)("strong",{parentName:"p"},"de la plus ancienne \xe0 la plus\nr\xe9cente")," en lan\xe7ant la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"tar -xzf /var/backup/mysql-centreon_storage-bi-xxxx-xx-xx.tar.gz -C /\n")),(0,t.kt)("p",null,"Modifier les droits sur le r\xe9p\xe9rtoire ",(0,t.kt)("em",{parentName:"p"},"/var/lib/mysql")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"chown -R mysql:root /var/lib/mysql\n")),(0,t.kt)("p",null,"D\xe9marrer le service MariaDB::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"systemctl start mariadb\n")),(0,t.kt)("h4",{id:"red\xe9marrer-le-moteur-cbis"},"Red\xe9marrer le moteur CBIS"),(0,t.kt)("p",null,"Red\xe9marrer le processus via la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"systemctl restart cbis\nStopping Centreon MBI scheduler : cbis\nWaiting for cbis to exit .. done.\nStarting Centreon MBI scheduler : cbis\nService started...\n")),(0,t.kt)("h4",{id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde-1"},"Supprimer les donn\xe9es extraites de la sauvegarde"),(0,t.kt)("p",null,"Supprimer les donn\xe9es extraites via les commandes suivantes ::"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"cd /tmp\nrm -Rf /tmp/etc\nrm -Rf /tmp/usr\n")))}g.isMDXComponent=!0}}]);