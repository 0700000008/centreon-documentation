"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[48248],{455723:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>v,frontMatter:()=>i,metadata:()=>c,toc:()=>m});n(667294);var r=n(603905),a=n(451715),s=n(907626);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={id:"upgrade-from-20-10",title:"Mont\xe9e de version depuis Centreon 20.10"},u=void 0,c={unversionedId:"upgrade/upgrade-from-20-10",id:"version-21.10/upgrade/upgrade-from-20-10",title:"Mont\xe9e de version depuis Centreon 20.10",description:"Ce chapitre d\xe9crit la proc\xe9dure de mont\xe9e de version de votre plate-forme",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-21.10/upgrade/upgrade-from-20-10.md",sourceDirName:"upgrade",slug:"/upgrade/upgrade-from-20-10",permalink:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/upgrade/upgrade-from-20-10",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-21.10/upgrade/upgrade-from-20-10.md",tags:[],version:"21.10",lastUpdatedAt:1694501365,formattedLastUpdatedAt:"12 sept. 2023",frontMatter:{id:"upgrade-from-20-10",title:"Mont\xe9e de version depuis Centreon 20.10"},sidebar:"version-21.10/docs",previous:{title:"Mont\xe9e de version depuis Centreon 21.04",permalink:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/upgrade/upgrade-from-21-04"},next:{title:"Mont\xe9e de version depuis Centreon 20.04",permalink:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/upgrade/upgrade-from-20-04"}},d={},m=[{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Sauvegarde",id:"sauvegarde",level:3},{value:"Mettre \xe0 jour la cl\xe9 de signature RPM",id:"mettre-\xe0-jour-la-cl\xe9-de-signature-rpm",level:3},{value:"Mont\xe9e de version du serveur Centreon Central",id:"mont\xe9e-de-version-du-serveur-centreon-central",level:2},{value:"Mise \xe0 jour des d\xe9p\xf4ts",id:"mise-\xe0-jour-des-d\xe9p\xf4ts",level:3},{value:"Mont\xe9e de version de PHP",id:"mont\xe9e-de-version-de-php",level:3},{value:"Mont\xe9e de version de la solution Centreon",id:"mont\xe9e-de-version-de-la-solution-centreon",level:3},{value:"Mettre \xe0 jour une configuration Apache personnalis\xe9e",id:"mettre-\xe0-jour-une-configuration-apache-personnalis\xe9e",level:3},{value:"Finalisation de la mise \xe0 jour",id:"finalisation-de-la-mise-\xe0-jour",level:3},{value:"Actions post mont\xe9e de version",id:"actions-post-mont\xe9e-de-version",level:3},{value:"Mont\xe9e de version du serveur MariaDB",id:"mont\xe9e-de-version-du-serveur-mariadb",level:3},{value:"Mettre \xe0 jour le d\xe9p\xf4t Centreon",id:"mettre-\xe0-jour-le-d\xe9p\xf4t-centreon",level:4},{value:"Mettre \xe0 jour MariaDB",id:"mettre-\xe0-jour-mariadb",level:4},{value:"Activer MariaDB au d\xe9marrage automatique",id:"activer-mariadb-au-d\xe9marrage-automatique",level:4},{value:"Mont\xe9e de version des Remote Servers",id:"mont\xe9e-de-version-des-remote-servers",level:2},{value:"Mont\xe9e de version des Pollers",id:"mont\xe9e-de-version-des-pollers",level:2},{value:"Mise \xe0 jour des d\xe9p\xf4ts",id:"mise-\xe0-jour-des-d\xe9p\xf4ts-1",level:3},{value:"Mont\xe9e de version de la solution Centreon",id:"mont\xe9e-de-version-de-la-solution-centreon-1",level:3}],k={toc:m},h="wrapper";function v(e){var{components:t}=e,i=p(e,["components"]);return(0,r.kt)(h,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({},k,i),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Ce chapitre d\xe9crit la proc\xe9dure de mont\xe9e de version de votre plate-forme\nCentreon depuis la version 20.10 vers la version 21.10."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous souhaitez migrer votre serveur Centreon vers CentOS / Oracle Linux\n/ RHEL 8, vous devez suivre la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/migrate/migrate-from-20-x"},"proc\xe9dure de migration"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Pour effectuer cette proc\xe9dure, votre version de MariaDB doit \xeatre >= 10.3.22.\nSi cela n'est pas le cas, merci de suivre avant le\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/upgrade/upgrade-from-19-10#upgrade-mariadb-server"},"chapitre de mise \xe0 jour de MariaDB"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Attention, suite \xe0 la correction d'un probl\xe8me relatif au sch\xe9ma de base de donn\xe9es, il sera n\xe9cessaire\nd'arr\xeater l'insertion en base de donn\xe9es des donn\xe9es collect\xe9es le temps de la mise \xe0 jour. Celles-ci seront stock\xe9es\ndans des fichiers temporaires puis ins\xe9r\xe9es \xe0 la fin du processus de mise \xe0 jour.")),(0,r.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,r.kt)("h3",{id:"sauvegarde"},"Sauvegarde"),(0,r.kt)("p",null,"Avant toute chose, il est pr\xe9f\xe9rable de s\u2019assurer de l\u2019\xe9tat et de la consistance\ndes sauvegardes de l\u2019ensemble des serveurs centraux de votre plate-forme :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Serveur Centreon Central,"),(0,r.kt)("li",{parentName:"ul"},"Serveur de gestion de base de donn\xe9es.")),(0,r.kt)("h3",{id:"mettre-\xe0-jour-la-cl\xe9-de-signature-rpm"},"Mettre \xe0 jour la cl\xe9 de signature RPM"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Pour des raisons de s\xe9curit\xe9, les cl\xe9s utilis\xe9es pour signer les RPMs Centreon sont chang\xe9es r\xe9guli\xe8rement. Le dernier changement a eu lieu le 14 octobre 2021. Lorsque vous mettez Centreon \xe0 jour depuis une version plus ancienne, vous devez suivre la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/security/key-rotation#installation-existante"},"proc\xe9dure de changement de cl\xe9"),", afin de supprimer l'ancienne cl\xe9 et d'installer la nouvelle.")),(0,r.kt)("h2",{id:"mont\xe9e-de-version-du-serveur-centreon-central"},"Mont\xe9e de version du serveur Centreon Central"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Depuis la version 21.04, Centreon utilise ",(0,r.kt)("strong",{parentName:"p"},"MariaDB 10.5"),"."),(0,r.kt)("p",{parentName:"blockquote"},"Le processus suivant met seulement \xe0 jour les composants Centreon pour le\nmoment."),(0,r.kt)("p",{parentName:"blockquote"},"MariaDB sera mis \xe0 jour apr\xe8s.")),(0,r.kt)("h3",{id:"mise-\xe0-jour-des-d\xe9p\xf4ts"},"Mise \xe0 jour des d\xe9p\xf4ts"),(0,r.kt)("p",null,"Il est n\xe9cessaire de mettre \xe0 jour le d\xe9p\xf4t Centreon."),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install -y https://yum.centreon.com/standard/21.10/el8/stable/noarch/RPMS/centreon-release-21.10-5.el8.noarch.rpm\n"))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y https://yum.centreon.com/standard/21.10/el7/stable/noarch/RPMS/centreon-release-21.10-5.el7.centos.noarch.rpm\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous avez une licence offline, installez le d\xe9p\xf4t des plugin packs correspondant \xe0 la version.\nSi vous avez une \xe9dition Business, installez \xe9galement le d\xe9p\xf4t Business.\nVous pouvez en trouver l'adresse sur le ",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/fr/categories/10341239833105-D%C3%A9p%C3%B4ts"},"portail support Centreon"),".")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-php"},"Mont\xe9e de version de PHP"),(0,r.kt)("p",null,"Centreon 21.10 utilise PHP en version 8.0."),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8",label:"RHEL 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Vous devez tout d'abord installer les d\xe9p\xf4ts ",(0,r.kt)("strong",{parentName:"p"},"remi")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install -y dnf-plugins-core\ndnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\ndnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm\nsudo subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms\n\n")),(0,r.kt)("p",null,"Ensuite, vous devez changer le flux PHP de la version 7.3 \xe0 8.0 en ex\xe9cutant les commandes suivantes et en r\xe9pondant ",(0,r.kt)("strong",{parentName:"p"},"y"),"\npour confirmer :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf module reset php\ndnf module install php:remi-8.0\n"))),(0,r.kt)(s.Z,{value:"Alma / Oracle Linux 8",label:"Alma / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Vous devez tout d'abord installer les d\xe9p\xf4ts ",(0,r.kt)("strong",{parentName:"p"},"remi")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install -y dnf-plugins-core\ndnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\ndnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm\n\n")),(0,r.kt)("p",null,"Ensuite, vous devez changer le flux PHP de la version 7.3 \xe0 8.0 en ex\xe9cutant les commandes suivantes et en r\xe9pondant ",(0,r.kt)("strong",{parentName:"p"},"y"),"\npour confirmer :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf module reset php\ndnf module install php:remi-8.0\n"))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("p",null,"Vous devez tout d'abord installer les d\xe9p\xf4ts ",(0,r.kt)("strong",{parentName:"p"},"remi")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y yum-utils\nyum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nyum install -y https://rpms.remirepo.net/enterprise/remi-release-7.rpm\n")),(0,r.kt)("p",null,"Ensuite, vous devez activer le d\xe9p\xf4t php 8.0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum-config-manager --enable remi-php80\n")))),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-la-solution-centreon"},"Mont\xe9e de version de la solution Centreon"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Assurez-vous que tous les utilisateurs sont d\xe9connect\xe9s avant de commencer\nla proc\xe9dure de mise \xe0 jour.")),(0,r.kt)("p",null,"Si vous avez des extensions Business install\xe9es, mettez \xe0 jour le d\xe9p\xf4t business en 21.10.\nRendez-vous sur le ",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/fr/categories/10341239833105-D%C3%A9p%C3%B4ts"},"portail du support")," pour en r\xe9cup\xe9rer l'adresse."),(0,r.kt)("p",null,"Arr\xeater le processus Centreon Broker :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop cbd\n")),(0,r.kt)("p",null,"Supprimez les fichiers de r\xe9tention pr\xe9sents :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rm /var/lib/centreon-broker/* -f\n")),(0,r.kt)("p",null,"Videz le cache de yum :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Mettez \xe0 jour l'ensemble des composants :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum update centreon\\*\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Acceptez les nouvelles cl\xe9s GPG des d\xe9p\xf4ts si n\xe9cessaire.")),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Ex\xe9cutez les commandes suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable php-fpm\nsystemctl restart php-fpm\n"))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("p",null,"Le fuseau horaire par d\xe9faut de PHP 8 doit \xeatre configur\xe9. Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'echo "date.timezone = Europe/Paris" >> /etc/php.d/50-centreon.ini\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Remplacez ",(0,r.kt)("strong",{parentName:"p"},"Europe/Paris")," par votre fuseau horaire. La liste des fuseaux\nhoraires est disponible ",(0,r.kt)("a",{parentName:"p",href:"http://php.net/manual/en/timezones.php"},"ici"),".\nEx\xe9cutez les commandes suivantes :"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop rh-php72-php-fpm\nsystemctl disable rh-php72-php-fpm\nsystemctl enable php-fpm\nsystemctl start php-fpm\n"))),(0,r.kt)("p",null,"Ou, si votre version de PHP est la 7.4 :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop rh-php74-php-fpm\nsystemctl disable rh-php74-php-fpm\nsystemctl enable php-fpm\nsystemctl start php-fpm\n")))),(0,r.kt)("h3",{id:"mettre-\xe0-jour-une-configuration-apache-personnalis\xe9e"},"Mettre \xe0 jour une configuration Apache personnalis\xe9e"),(0,r.kt)("p",null,"Cette section s'applique uniquement si vous avez personnalis\xe9 votre configuration Apache."),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL / Oracle Linux 8",label:"RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Lors de la mont\xe9e de version, le fichier de configuration Apache n'est pas mis \xe0 jour automatiquement : le nouveau fichier de configuration amen\xe9 par le rpm ne remplace pas l'ancien. Vous devez reporter les changements manuellement dans votre fichier de configuration personnalis\xe9e."),(0,r.kt)("p",null,"Faites un diff entre l'ancien et le nouveau fichier de configuration Apache :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"diff -u /etc/httpd/conf.d/10-centreon.conf /etc/httpd/conf.d/10-centreon.conf.rpmnew\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf")," (post mont\xe9e de version) : ce fichier contient la configuration personnalis\xe9e. Il ne contient pas les nouveaut\xe9s apport\xe9es par la mont\xe9e de version."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf.rpmnew")," (post mont\xe9e de version) : ce fichier est fourni par le rpm; il ne contient pas la configuration personnalis\xe9e.")),(0,r.kt)("p",null,"Pour chaque diff\xe9rence entre les fichiers, \xe9valuez si celle-ci doit \xeatre report\xe9e du fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf.rpmnew")," au fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf"),"."),(0,r.kt)("p",null,"Notamment, assurez-vous que votre configuration Apache personnalis\xe9e contient la directive suivante (incluant ",(0,r.kt)("strong",{parentName:"p"},"authentication"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<LocationMatch ^/centreon/(authentication|api/(latest|beta|v[0-9]+|v[0-9]+\\.[0-9]+))/.*$>\n    ProxyPassMatch fcgi://127.0.0.1:9042/usr/share/centreon/api/index.php/$1\n</LocationMatch>\n")),(0,r.kt)("p",null,"V\xe9rifiez qu'Apache est bien configur\xe9, en ex\xe9cutant la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"apachectl configtest\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est le suivant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"Syntax OK\n")),(0,r.kt)("p",null,"Red\xe9marrez Apache pour appliquer les modifications :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart php-fpm httpd\n")),(0,r.kt)("p",null,"Puis v\xe9rifiez le statut :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl status httpd\n")),(0,r.kt)("p",null,"Si tout est correct, vous devriez avoir quelque chose comme :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'\u25cf httpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)\n  Drop-In: /usr/lib/systemd/system/httpd.service.d\n           \u2514\u2500php-fpm.conf\n   Active: active (running) since Tue 2020-10-27 12:49:42 GMT; 2h 35min ago\n     Docs: man:httpd.service(8)\n Main PID: 1483 (httpd)\n   Status: "Total requests: 446; Idle/Busy workers 100/0;Requests/sec: 0.0479; Bytes served/sec: 443 B/sec"\n    Tasks: 278 (limit: 5032)\n   Memory: 39.6M\n   CGroup: /system.slice/httpd.service\n           \u251c\u25001483 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001484 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001485 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001486 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001487 /usr/sbin/httpd -DFOREGROUND\n           \u2514\u25001887 /usr/sbin/httpd -DFOREGROUND\n'))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("p",null,"Lors de la mont\xe9e de version, le fichier de configuration Apache n'est pas mis \xe0 jour automatiquement : le nouveau fichier de configuration amen\xe9 par le rpm ne remplace pas l'ancien. Vous devez reporter les changements manuellement dans votre fichier de configuration personnalis\xe9e."),(0,r.kt)("p",null,"Faites un diff entre l'ancien et le nouveau fichier de configuration Apache :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"diff -u /opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf /opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf.rpmnew\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf")," (post mont\xe9e de version) : ce fichier contient la configuration personnalis\xe9e. Il ne contient pas les nouveaut\xe9s apport\xe9es par la mont\xe9e de version."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf.rpmnew")," (post mont\xe9e de version) : ce fichier est fourni par le rpm; il ne contient pas la configuration personnalis\xe9e.")),(0,r.kt)("p",null,"Pour chaque diff\xe9rence entre les fichiers, \xe9valuez si celle-ci doit \xeatre report\xe9e du fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf.rpmnew")," au fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf"),"."),(0,r.kt)("p",null,"Notamment, assurez-vous que votre configuration Apache personnalis\xe9e contient la directive suivante (incluant ",(0,r.kt)("strong",{parentName:"p"},"authentication"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<LocationMatch ^/centreon/(authentication|api/(latest|beta|v[0-9]+|v[0-9]+\\.[0-9]+))/.*$>\n    ProxyPassMatch fcgi://127.0.0.1:9042/usr/share/centreon/api/index.php/$1\n</LocationMatch>\n")),(0,r.kt)("p",null,"V\xe9rifiez qu'Apache est bien configur\xe9, en ex\xe9cutant la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"/opt/rh/httpd24/root/usr/sbin/apachectl configtest\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est le suivant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"Syntax OK\n")),(0,r.kt)("p",null,"Red\xe9marrez Apache pour appliquer les modifications :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart php-fpm httpd24-httpd\n")),(0,r.kt)("p",null,"Puis v\xe9rifiez le statut :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl status httpd24-httpd\n")),(0,r.kt)("p",null,"Si tout est correct, vous devriez avoir quelque chose comme :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'\u25cf httpd24-httpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd24-httpd.service; enabled; vendor preset: disabled)\n   Active: active (running) since mar. 2020-05-12 15:39:58 CEST; 25min ago\n  Process: 31762 ExecStop=/opt/rh/httpd24/root/usr/sbin/httpd-scl-wrapper $OPTIONS -k graceful-stop (code=exited, status=0/SUCCESS)\n Main PID: 31786 (httpd)\n   Status: "Total requests: 850; Idle/Busy workers 50/50;Requests/sec: 0.547; Bytes served/sec: 5.1KB/sec"\n   CGroup: /system.slice/httpd24-httpd.service\n           \u251c\u2500 1219 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031786 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031788 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031789 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031790 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031802 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031865 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031866 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031882 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u251c\u250031903 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n           \u2514\u250032050 /opt/rh/httpd24/root/usr/sbin/httpd -DFOREGROUND\n')))),(0,r.kt)("h3",{id:"finalisation-de-la-mise-\xe0-jour"},"Finalisation de la mise \xe0 jour"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Avant de d\xe9marrer la mont\xe9e de version via l'interface web, rechargez le serveur Apache avec la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl reload httpd\n"))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("p",null,"Avant de d\xe9marrer la mont\xe9e de version via l'interface web, rechargez le serveur Apache avec la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl reload httpd24-httpd\n")))),(0,r.kt)("p",null,"Connectez-vous ensuite \xe0 l'interface web Centreon pour d\xe9marrer le processus de\nmise \xe0 jour :"),(0,r.kt)("p",null,"Cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(898747).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(149546).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"La note de version pr\xe9sente les principaux changements, cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(337655).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Le processus r\xe9alise les diff\xe9rentes mises \xe0 jour, cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Next")," :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(441957).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Votre serveur Centreon est maintenant \xe0 jour, cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Finish")," pour\nacc\xe9der \xe0 la page de connexion :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(113462).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Si le module Centreon BAM est install\xe9, r\xe9f\xe9rez-vous \xe0 la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/service-mapping/upgrade"},"documentation\nassoci\xe9e")," pour le mettre \xe0 jour."),(0,r.kt)("h3",{id:"actions-post-mont\xe9e-de-version"},"Actions post mont\xe9e de version"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Mont\xe9e de version des extensions :"),(0,r.kt)("p",{parentName:"li"},"Depuis le menu ",(0,r.kt)("inlineCode",{parentName:"p"},"Administration > Extensions > Gestionnaire"),", mettez \xe0 jour\ntoutes les extensions, en commen\xe7ant par les suivantes :"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"License Manager,"),(0,r.kt)("li",{parentName:"ul"},"Plugin Packs Manager,"),(0,r.kt)("li",{parentName:"ul"},"Auto Discovery.")),(0,r.kt)("p",{parentName:"li"},"Vous pouvez alors mettre \xe0 jour toutes les autres extensions commerciales.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2584/fr/docs/21.10/monitoring/monitoring-servers/deploying-a-configuration"},"D\xe9ployer la configuration"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Red\xe9marrez les processus Centreon :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl restart cbd centengine centreontrapd gorgoned\n")))),(0,r.kt)("h3",{id:"mont\xe9e-de-version-du-serveur-mariadb"},"Mont\xe9e de version du serveur MariaDB"),(0,r.kt)("p",null,"Les composants MariaDB peuvent maintenant \xeatre mis \xe0 jour."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la documentation officielle de MariaDB pour en savoir\ndavantage sur ce processus :"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"},"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"))),(0,r.kt)("h4",{id:"mettre-\xe0-jour-le-d\xe9p\xf4t-centreon"},"Mettre \xe0 jour le d\xe9p\xf4t Centreon"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Cette \xe9tape est n\xe9cessaire seulement si votre environnement comprend une base de donn\xe9es d\xe9port\xe9e.\nSi le serveur central Centreon et\nMariaDB sont h\xe9berg\xe9s sur le m\xeame serveur, sautez cette \xe9tape.")),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante sur le serveur de base de donn\xe9es d\xe9di\xe9 :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install -y https://yum.centreon.com/standard/21.10/el8/stable/noarch/RPMS/centreon-release-21.10-5.el8.noarch.rpm\n"))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y https://yum.centreon.com/standard/21.10/el7/stable/noarch/RPMS/centreon-release-21.10-5.el7.centos.noarch.rpm\n")))),(0,r.kt)("h4",{id:"mettre-\xe0-jour-mariadb"},"Mettre \xe0 jour MariaDB"),(0,r.kt)("p",null,"Il est n\xe9cessaire de d\xe9sinstaller puis r\xe9installer MariaDB pour changer de version majeure (c'est-\xe0-dire pour passer d'une version 10.3 \xe0 une version 10.5)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Arr\xeatez le service mariadb :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9sinstallez la version actuelle :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-compat MariaDB-common\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez la version 10.5 :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install MariaDB-server-10.5\\* MariaDB-client-10.5\\* MariaDB-shared-10.5\\* MariaDB-compat-10.5\\* MariaDB-common-10.5\\*\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9marrer le service mariadb :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Lancez le processus de mise \xe0 jour MariaDB :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,r.kt)("p",{parentName:"li"}," Si votre base de donn\xe9es est prot\xe9g\xe9e par mot de passe, entrez :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"}," mysql_upgrade -u <utilisateur_admin_bdd> -p\n")),(0,r.kt)("p",{parentName:"li"}," Exemple : si votre utilisateur_admin_bdd est ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", entrez:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"mysql_upgrade -u root -p\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la ",(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/mysql_upgrade/"},"documentation officielle"),"\npour plus d'informations ou si des erreurs apparaissent pendant cette derni\xe8re \xe9tape.")))),(0,r.kt)("h4",{id:"activer-mariadb-au-d\xe9marrage-automatique"},"Activer MariaDB au d\xe9marrage automatique"),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable mariadb\n")),(0,r.kt)("h2",{id:"mont\xe9e-de-version-des-remote-servers"},"Mont\xe9e de version des Remote Servers"),(0,r.kt)("p",null,"Cette proc\xe9dure est identique \xe0 la mont\xe9e de version d'un serveur Centreon\nCentral."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"En fin de mise \xe0 jour, la configuration doit \xeatre d\xe9ploy\xe9e depuis le serveur Central.")),(0,r.kt)("h2",{id:"mont\xe9e-de-version-des-pollers"},"Mont\xe9e de version des Pollers"),(0,r.kt)("h3",{id:"mise-\xe0-jour-des-d\xe9p\xf4ts-1"},"Mise \xe0 jour des d\xe9p\xf4ts"),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install -y https://yum.centreon.com/standard/21.10/el8/stable/noarch/RPMS/centreon-release-21.10-5.el8.noarch.rpm\n"))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y https://yum.centreon.com/standard/21.10/el7/stable/noarch/RPMS/centreon-release-21.10-5.el7.centos.noarch.rpm\n")))),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-la-solution-centreon-1"},"Mont\xe9e de version de la solution Centreon"),(0,r.kt)("p",null,"Videz le cache de yum :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Mettez \xe0 jour l'ensemble des composants :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum update centreon\\*\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Acceptez les nouvelles cl\xe9s GPG des d\xe9p\xf4ts si n\xe9cessaire.")),(0,r.kt)("p",null,"D\xe9marrez et activez ",(0,r.kt)("strong",{parentName:"p"},"gorgoned"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start gorgoned\nsystemctl enable gorgoned\n")),(0,r.kt)("p",null,"Red\xe9marrez ",(0,r.kt)("strong",{parentName:"p"},"centengine"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart centengine\n")))}v.isMDXComponent=!0},898747:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_1-229784d5ed7986045c49b65b99ce38cd.png"},149546:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_2-f12be23b17ba9e83853cbdbaaea65402.png"},337655:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_3-d505e49a3b4f60dfd887ff45ddbf006b.png"},441957:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_4-97901eb976096c68fb2bd9d37c4de9bc.png"},113462:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web_update_5-01f8c54614c006d7c1bf9e03799c1b81.png"}}]);