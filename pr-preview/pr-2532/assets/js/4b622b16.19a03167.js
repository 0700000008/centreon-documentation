"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[26275],{603905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>g});var n=r(667294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),s=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=s(r),d=a,g=u["".concat(p,".").concat(d)]||u[d]||m[d]||o;return r?n.createElement(g,l(l({ref:t},c),{},{components:r})):n.createElement(g,l({ref:t},c))}));function g(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=d;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:a,l[1]=i;for(var s=2;s<o;s++)l[s]=r[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},886720:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>u});r(667294);var n=r(603905);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}const i={id:"migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform"},p=void 0,s={unversionedId:"migrate/migrate-from-3-4",id:"version-22.10/migrate/migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform",description:"Prerequisites",source:"@site/versioned_docs/version-22.10/migrate/migrate-from-3-4.md",sourceDirName:"migrate",slug:"/migrate/migrate-from-3-4",permalink:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/migrate/migrate-from-3-4",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-22.10/migrate/migrate-from-3-4.md",tags:[],version:"22.10",lastUpdatedAt:1694523572,formattedLastUpdatedAt:"Sep 12, 2023",frontMatter:{id:"migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform"},sidebar:"version-22.10/docs",previous:{title:"Migrate from an EL-type OS to Debian 11",permalink:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/migrate/migrate-from-el-to-debian"},next:{title:"Nagios Reader to Centreon CLAPI",permalink:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/migrate/nagios-to-centreon"}},c={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migrate",id:"migrate",level:2},{value:"Install the new server",id:"install-the-new-server",level:3},{value:"Synchronize the data",id:"synchronize-the-data",level:3},{value:"Retrieve databases",id:"retrieve-databases",level:3},{value:"Synchronize the plugins",id:"synchronize-the-plugins",level:3},{value:"Upgrade Centreon",id:"upgrade-centreon",level:3},{value:"Upgrade the modules",id:"upgrade-the-modules",level:3}],m={toc:u},d="wrapper";function g(e){var{components:t}=e,r=l(e,["components"]);return(0,n.kt)(d,o(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){a(e,t,r[t])}))}return e}({},m,r),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"The following procedure only applies to migration from a Centreon 3.4 platform\ninstalled on a 64-bit GNU/Linux distribution other than CentOS / Oracle Linux / RHEL 8.\nHere are the system requirements:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Components"),(0,n.kt)("th",{parentName:"tr",align:null},"Version"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Centreon Web"),(0,n.kt)("td",{parentName:"tr",align:null},"2.8.x")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Centreon Broker"),(0,n.kt)("td",{parentName:"tr",align:null},"3.0.x")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Centreon Engine"),(0,n.kt)("td",{parentName:"tr",align:null},"1.8.x")))),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If your platform was installed from Centreon ISO or Centreon 3.4 repositories\nrunning on CentOS or Red Hat version 7, refer to the\n",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/upgrade/upgrade-from-3-4"},"upgrade")," documentation.")),(0,n.kt)("h2",{id:"migrate"},"Migrate"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If your Centreon platform includes a Centreon redundancy system, please\ncontact ",(0,n.kt)("a",{parentName:"p",href:"https://support.centreon.com"},"Centreon support"),".")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you try to migrate a platform using the ",(0,n.kt)("strong",{parentName:"p"},"Centreon Poller Display 1.6.x"),",\nplease refer to the following ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/migrate/poller-display-to-remote-server"},"migration\nprocedure"),".")),(0,n.kt)("h3",{id:"install-the-new-server"},"Install the new server"),(0,n.kt)("p",null,"Perform the following actions:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"You will need to install a new Centreon Central server from\n",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/installation/installation-of-a-central-server/using-packages"},"packages"),", until you\ncomplete the installation process by connecting to the Centreon Web\ninterface.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Perform software and system updates:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"yum update\n")))),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"It is advisable to set the same password for the ",(0,n.kt)("em",{parentName:"p"},"centreon")," user during the web\ninstallation process.")),(0,n.kt)("h3",{id:"synchronize-the-data"},"Synchronize the data"),(0,n.kt)("p",null,"Connect to your old Centreon server and synchronize following directories:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"rsync -avz /etc/centreon root@<IP_NEW_CENTREON>:/etc\nrsync -avz /etc/centreon-broker root@<IP_NEW_CENTREON>:/etc\nrsync -avz /var/log/centreon-engine/archives/ root@<IP_NEW_CENTREON>:/var/log/centreon-engine\nrsync -avz --exclude centcore/ --exclude log/ /var/lib/centreon root@<IP_NEW_CENTREON>:/var/lib\nrsync -avz /var/spool/centreon/.ssh root@<IP_NEW_CENTREON>:/var/spool/centreon\nrsync -avz /usr/share/centreon/www/img/media root@<IP_NEW_CENTREON>:/usr/share/centreon/www/img\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Replace ",(0,n.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," by the IP or the new Centreon server.")),(0,n.kt)("h3",{id:"retrieve-databases"},"Retrieve databases"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Dump source databases:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysqldump -u root -p centreon > /tmp/centreon.sql\nmysqldump -u root -p centreon_storage > /tmp/centreon_storage.sql\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Stop source MariaDB servers:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"}," service mysqld stop\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Export the dumps to the new Centreon 22.10 database server (make sure you\nhave enough space for large databases dumps):"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"rsync -avz /tmp/centreon.sql root@<IP_NEW_CENTREON>:/tmp/\nrsync -avz /tmp/centreon_storage.sql root@<IP_NEW_CENTREON>:/tmp/\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the Centreon 22.10 database server, drop the original databases and\ncreate them again:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u root -p\n")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-SQL"},"DROP DATABASE centreon;\nDROP DATABASE centreon_storage;\nCREATE DATABASE centreon;\nCREATE DATABASE centreon_storage;\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Import the previously transfered dumps:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u root centreon -p </tmp/centreon.sql\nmysql -u root centreon_storage -p </tmp/centreon_storage.sql\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Upgrade the tables:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,n.kt)("p",{parentName:"li"},"If your database is password-protected, enter:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade -u <database_admin_user> -p\n")),(0,n.kt)("p",{parentName:"li"},"Example: if your database_admin_user is ",(0,n.kt)("inlineCode",{parentName:"p"},"root"),", enter:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre"},"mysql_upgrade -u root -p\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Start the mariadb process on the new server:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n")))),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Replace ",(0,n.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," by the IP or the new Centreon server.")),(0,n.kt)("h3",{id:"synchronize-the-plugins"},"Synchronize the plugins"),(0,n.kt)("p",null,"Synchronizing the monitoring plugins is more complex and depends on your\ninstallation. The main directories to synchronize are:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"/usr/lib/nagios/plugins/"),(0,n.kt)("li",{parentName:"ol"},"/usr/lib/centreon/plugins/")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"To run the plugins, you must first install the required dependencies.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you still have distant Centreon Engine 1.8.1 Pollers that you want to\npostpone the upgrade to 22.10, be aware that Centreon Web 22.10 resource\n$USER1$ actually points to /usr/lib64/nagios/plugins"),(0,n.kt)("p",{parentName:"blockquote"},"On the 1.8.1 Pollers to mitigate the issue:"),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mv /usr/lib64/nagios/plugins/* /usr/lib/nagios/plugins/\nrmdir /usr/lib64/nagios/plugins/\nln -s -t /usr/lib64/nagios/ /usr/lib/nagios/plugins/\n")),(0,n.kt)("p",{parentName:"blockquote"},"You now have a symbolic link as:"),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"$ ls -alt /usr/lib64/nagios/\nlrwxrwxrwx   1 root root      24  1 nov.  17:59 plugins -> /usr/lib/nagios/plugins/\n-rwxr-xr-x   1 root root 1711288  6 avril  2018 cbmod.so\n"))),(0,n.kt)("p",null,"You can now push poller configuration from Centreon 22.10 whether the distant\nPoller is Centreon Engine 22.10 or 1.8.1."),(0,n.kt)("h3",{id:"upgrade-centreon"},"Upgrade Centreon"),(0,n.kt)("p",null,"On the new server, force the update by moving the contents of the\n",(0,n.kt)("strong",{parentName:"p"},"/var/lib/centreon/installs/install-22.10.0-YYYYMMDD","_","HHMMSS")," directory to\nthe ",(0,n.kt)("strong",{parentName:"p"},"/usr/share/centreon/www/install")," directory:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd /var/lib/centreon/installs/\nmv install-22.10.0-YYYYMMDD_HHMMSS/ /usr/share/centreon/www/install/\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you use the same IP address or same DNS name between old Centreon webserver\nand the new one, do a full cache cleanup of your browser to avoid JS issues")),(0,n.kt)("p",null,"Go to ",(0,n.kt)("inlineCode",{parentName:"p"},"http://<IP_NEW_CENTREON>/centreon")," URL and perform the upgrade."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you changed the ",(0,n.kt)("em",{parentName:"p"},"centreon")," password during the installation process you must\nfollow these steps:"),(0,n.kt)("ol",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/centreon.conf.php file,"),(0,n.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/conf.pm file,"),(0,n.kt)("li",{parentName:"ol"},"Edit the Centreon Broker central configuration using Centreon web interface\nand change the password for the ",(0,n.kt)("strong",{parentName:"li"},"Perfdata generator")," and ",(0,n.kt)("strong",{parentName:"li"},"Broker SQL\ndatabase")," output,"),(0,n.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/config.d/10-database.yaml file."))),(0,n.kt)("p",null,"If the IP of your Centreon server has changed, edit the configuration for all\nthe Centreon Broker modules of your Pollers and change the IP to connect to\nthe Centreon Central server (output IPv4). See the ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/monitoring/monitoring-servers/advanced-configuration#tcp-outputs"},"Advanced\nconfiguration"),"\nchapter for more information."),(0,n.kt)("p",null,"Then ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2532/docs/22.10/monitoring/monitoring-servers/deploying-a-configuration"},"generate")," the\nconfiguration of all your pollers and export it."),(0,n.kt)("h3",{id:"upgrade-the-modules"},"Upgrade the modules"),(0,n.kt)("p",null,"Please refer to the documentation of each module to verify compatibility with\nCentreon 22.10 and perform the upgrade."))}g.isMDXComponent=!0}}]);