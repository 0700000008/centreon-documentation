"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[86577],{518687:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>N,frontMatter:()=>E,metadata:()=>d,toc:()=>i});t(667294);var r=t(603905),a=t(451715),s=t(907626);function A(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const E={id:"acceptance-guide",title:"Guide de recette du cluster"},c=void 0,d={unversionedId:"administration/centreon-ha/acceptance-guide",id:"version-22.04/administration/centreon-ha/acceptance-guide",title:"Guide de recette du cluster",description:"Veuillez noter que toutes les commandes pr\xe9sent\xe9es dans ce document doivent \xeatre ex\xe9cut\xe9es respectivement en tant que root, sauf indication contraire.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-22.04/administration/centreon-ha/acceptance-guide.md",sourceDirName:"administration/centreon-ha",slug:"/administration/centreon-ha/acceptance-guide",permalink:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/acceptance-guide",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-22.04/administration/centreon-ha/acceptance-guide.md",tags:[],version:"22.04",lastUpdatedAt:1694533508,formattedLastUpdatedAt:"12 sept. 2023",frontMatter:{id:"acceptance-guide",title:"Guide de recette du cluster"},sidebar:"version-22.04/docs",previous:{title:"Configurer une authentification par Autologin",permalink:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/connect/autologin"},next:{title:"Supervision de Centreon-HA",permalink:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/monitoring-guide"}},u={},i=[{value:"Conditions requises pour les tests",id:"conditions-requises-pour-les-tests",level:3},{value:"V\xe9rifier l&#39;\xe9tat du cluster",id:"v\xe9rifier-l\xe9tat-du-cluster",level:3},{value:"V\xe9rifier les contraintes",id:"v\xe9rifier-les-contraintes",level:3},{value:"V\xe9rifier l&#39;\xe9tat de la synchronisation de la base de donn\xe9es",id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es",level:3},{value:"Basculement des ressources du Centreon",id:"basculement-des-ressources-du-centreon",level:2},{value:"Etat du cluster avant le failover",id:"etat-du-cluster-avant-le-failover",level:3},{value:"Effectuer un basculement",id:"effectuer-un-basculement",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale",level:3},{value:"Simuler la perte du noeud secondaire",id:"simuler-la-perte-du-noeud-secondaire",level:2},{value:"Traitement",id:"traitement",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-1",level:3},{value:"Simuler la perte du noeud primaire",id:"simuler-la-perte-du-noeud-primaire",level:3},{value:"Traitement",id:"traitement-1",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-2",level:3},{value:"Conditions requises pour les tests",id:"conditions-requises-pour-les-tests-1",level:3},{value:"V\xe9rifier l&#39;\xe9tat du cluster",id:"v\xe9rifier-l\xe9tat-du-cluster-1",level:3},{value:"V\xe9rifier les contraintes",id:"v\xe9rifier-les-contraintes-1",level:3},{value:"V\xe9rifier l&#39;\xe9tat de la synchronisation de la base de donn\xe9es",id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es-1",level:3},{value:"Basculement des ressources du Centreon",id:"basculement-des-ressources-du-centreon-1",level:2},{value:"Etat du cluster avant le failover",id:"etat-du-cluster-avant-le-failover-1",level:3},{value:"Effectuer un basculement",id:"effectuer-un-basculement-1",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-3",level:3},{value:"Simuler la perte du noeud secondaire",id:"simuler-la-perte-du-noeud-secondaire-1",level:2},{value:"Traitement",id:"traitement-2",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-4",level:3},{value:"Simuler la perte du noeud primaire",id:"simuler-la-perte-du-noeud-primaire-1",level:3},{value:"Traitement",id:"traitement-3",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-5",level:3}],_={toc:i},p="wrapper";function N(e){var{components:n}=e,t=l(e,["components"]);return(0,r.kt)(p,o(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){A(e,n,t[n])}))}return e}({},_,t),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Veuillez noter que toutes les commandes pr\xe9sent\xe9es dans ce document doivent \xeatre ex\xe9cut\xe9es respectivement en tant que ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", sauf indication contraire.")),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"HA 2 Nodes",label:"HA 2 Nodes",mdxType:"TabItem"},(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Ce document fera r\xe9f\xe9rence aux param\xe8tres qui varient d'une installation \xe0 l'autre (par exemple, les noms et adresses IP des n\u0153uds) via . ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/installation/installation-of-centreon-ha/installation-2-nodes#D%C3%A9finition-des-noms-et-adresses-IP-des-serveurs"},"les macros d\xe9finies ici"))),(0,r.kt)("h3",{id:"conditions-requises-pour-les-tests"},"Conditions requises pour les tests"),(0,r.kt)("p",null,"Pour v\xe9rifier le bon fonctionnement de votre cluster, vous obtiendrez toutes les commandes pour effectuer un test de basculement et simuler des pannes de r\xe9seau."),(0,r.kt)("p",null,"Il est n\xe9cessaire de v\xe9rifier l'\xe9tat du cluster avant d'effectuer les tests d'acceptation. "),(0,r.kt)("h3",{id:"v\xe9rifier-l\xe9tat-du-cluster"},"V\xe9rifier l'\xe9tat du cluster"),(0,r.kt)("p",null,"Pour v\xe9rifier l'\xe9tat g\xe9n\xe9ral du cluster, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8/ Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:09:30 2021\nLast change: Fri Jul  9 11:08:57 2021 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"V\xe9rifiez les erreurs ",(0,r.kt)("inlineCode",{parentName:"p"},"Failed")," dans les ressources et corrigez-les \xe0 l'aide du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/troubleshooting-guide"},"guide de d\xe9pannage"),".")),(0,r.kt)("h3",{id:"v\xe9rifier-les-contraintes"},"V\xe9rifier les contraintes"),(0,r.kt)("p",null,"Pour v\xe9rifier qu'il n'y a pas de ",(0,r.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation"),", ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint\n")),(0,r.kt)("p",null,"La commande devrait renvoyer ceci :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\nOrdering Constraints:\nColocation Constraints:\n  centreon with ms_mysql-clone (score:INFINITY) (rsc-role:Started) (with-rsc-role:Master)\n  ms_mysql-clone with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\nOrdering Constraints:\nColocation Constraints:\n  centreon with ms_mysql-master (score:INFINITY) (rsc-role:Started) (with-rsc-role:Master)\n  ms_mysql-master with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,r.kt)("h3",{id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es"},"V\xe9rifier l'\xe9tat de la synchronisation de la base de donn\xe9es"),(0,r.kt)("p",null,"Pour v\xe9rifier que la synchronisation de la base de donn\xe9es fonctionne, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si la synchronisation indique ",(0,r.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/operating-guide"},"operating-guide"),".")),(0,r.kt)("h2",{id:"basculement-des-ressources-du-centreon"},"Basculement des ressources du Centreon"),(0,r.kt)("h3",{id:"etat-du-cluster-avant-le-failover"},"Etat du cluster avant le failover"),(0,r.kt)("p",null,"Avant d'ex\xe9cuter un test de basculement, v\xe9rifiez l'\xe9tat du cluster avec la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:24:27 2021\nLast change: Fri Jul  9 11:08:57 2021 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("h3",{id:"effectuer-un-basculement"},"Effectuer un basculement"),(0,r.kt)("p",null,"Pour d\xe9placer les ressources, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,r.kt)("p",null,"Vous pouvez \xe9galement utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," pour observer le basculement pendant qu'il se produit. Il sera n\xe9cessaire d'utiliser Ctrl+c pour quitter la commande."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Avertissement : La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource move centreon")," d\xe9finit une contrainte ",(0,r.kt)("inlineCode",{parentName:"p"},"-INFINITY")," sur le noeud h\xe9bergeant la ressource, qui n'est plus autoris\xe9e \xe0 \xeatre ex\xe9cut\xe9e sur ce noeud.")),(0,r.kt)("p",null,"En cons\xe9quence, les ressources se d\xe9placent vers un autre noeud. Suite \xe0 cette manipulation, il est donc n\xe9cessaire d'ex\xe9cuter la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource clear centreon")," pour s'assurer que les ressources pourront \xeatre d\xe9plac\xe9es \xe0 nouveau vers ce noeud dans le futur."),(0,r.kt)("p",null,"Pour v\xe9rifier que les ressources ont \xe9t\xe9 d\xe9plac\xe9es vers le second n\u0153ud, ex\xe9cutez la commande : "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:38:32 2021\nLast change: Fri Jul  9 11:37:55 2021 by root via crm_attribute on @CENTRAL_SLAVE_NAME@\n    \n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_SLAVE_NAME@ ]\n     Slaves: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n")))),(0,r.kt)("p",null,"Vous pouvez remarquer que comme pour les ressources ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon"),", le noeud secondaire a \xe9galement \xe9t\xe9 promu en ",(0,r.kt)("inlineCode",{parentName:"p"},"master")," pour la ressource ",(0,r.kt)("inlineCode",{parentName:"p"},"ms_mysql"),". Ce comportement est voulu et d\xfb aux ",(0,r.kt)("inlineCode",{parentName:"p"},"Colocation Constraints")," entre les ressources ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"msq_mysql"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Les ",(0,r.kt)("inlineCode",{parentName:"p"},"Colocation Constraints")," sont introuvables sur un cluster \xe0 4 n\u0153uds !")),(0,r.kt)("p",null,"Une fois le basculement termin\xe9, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Cela permettra de supprimer les contraintes \xe9tablies lors du basculement.")),(0,r.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si la synchronisation a ",(0,r.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/operating-guide"},"operating-guide"),".")),(0,r.kt)("h3",{id:"retour-\xe0-la-situation-nominale"},"Retour \xe0 la situation nominale"),(0,r.kt)("p",null,"Pour revenir \xe0 la situation nominale, vous devez lancer le basculement des ressources."),(0,r.kt)("p",null,"Ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"La sortie devrait \xeatre :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):         Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):          Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):       Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):          Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:38:32 2021\nLast change: Fri Jul  9 11:37:55 2021 by root via crm_attribute on @CENTRAL_SLAVE_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_SLAVE_NAME@ ]\n     Slaves: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n")))),(0,r.kt)("p",null,"Ensuite, ex\xe9cutez la commande de nettoyage des contraintes si vous avez des ",(0,r.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("p",null,"Ensuite, ex\xe9cutez la commande de basculement : "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,r.kt)("p",null,"Comme pr\xe9c\xe9demment, vous pouvez suivre le basculement avec la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr"),"."),(0,r.kt)("p",null,"Enfin, supprimez les contraintes avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("h2",{id:"simuler-la-perte-du-noeud-secondaire"},"Simuler la perte du noeud secondaire"),(0,r.kt)("p",null,"Pour simuler une panne de r\xe9seau qui isolerait le noeud secondaire, vous pouvez utiliser ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," pour supprimer le trafic depuis et vers le noeud secondaire.\nLe noeud secondaire sera compl\xe8tement exclu du cluster. Le noeud primaire garde la majorit\xe9 avec le QDevice."),(0,r.kt)("h3",{id:"traitement"},"Traitement"),(0,r.kt)("p",null,"Pour effectuer ce test, lancez les commandes ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," sur le noeud primaire :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @IP_SECONDARY_NODE@ -j DROP\niptables -A OUTPUT -d @IP_SECONDARY_NODE@ -j DROP\n")),(0,r.kt)("p",null,"L'ex\xe9cution de la commande a pour r\xe9sultat qu'aucune ressource active n'est visible sur le n\u0153ud secondaire et que le n\u0153ud primaire est consid\xe9r\xe9 comme \"hors ligne\" :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE: [ @CENTRAL_MASTER_NAME@ ]\nNo active resources\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_SLAVE_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition WITHOUT quorum\nLast updated: Fri Jul  9 16:11:53 2021\nLast change: Fri Jul  9 16:06:34 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nNo active resources\n")))),(0,r.kt)("p",null,"Les ressources et le cluster fonctionnent toujours en effectuant un ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs status")," sur le noeud primaire.\nLe noeud secondaire est vu ",(0,r.kt)("inlineCode",{parentName:"p"},"offline")," sur le primaire."),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ ]\n  * OFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 16:19:03 2021\nLast change: Fri Jul  9 16:05:26 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ ]\nOFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("h3",{id:"retour-\xe0-la-situation-nominale-1"},"Retour \xe0 la situation nominale"),(0,r.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,r.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\n")),(0,r.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,r.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Et le supprimer avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,r.kt)("p",null,"Le noeud secondaire est \xe0 nouveau vu ",(0,r.kt)("inlineCode",{parentName:"p"},"en ligne")," par le cluster :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 17:12:39 2021\nLast change: Fri Jul  9 16:06:34 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("h3",{id:"simuler-la-perte-du-noeud-primaire"},"Simuler la perte du noeud primaire"),(0,r.kt)("h3",{id:"traitement-1"},"Traitement"),(0,r.kt)("p",null,"Pour effectuer ce test, ex\xe9cutez les commandes sur le serveur primaire :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @IP_SECONDARY_NODE@ -j DROP \niptables -A OUTPUT -d @IP_SECONDARY_NODE@ -j DROP \niptables -A INPUT -s @QDEVICE_IP@ -j DROP \niptables -A OUTPUT -d @QDEVICE_IP@  -j DROP\n")),(0,r.kt)("p",null,"Les ressources sur le noeud primaire doivent s'arr\xeater et doivent d\xe9marrer sur le noeud secondaire. Vous pouvez utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," sur le noeud secondaire pour surveiller le d\xe9marrage des ressources :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE [ @CENTRAL_MASTER_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 15:14:00 2021\nLast change: Fri Jul  9 15:11:35 2021 by root via crm_resource on @CENTRAL_SLAVE_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n")))),(0,r.kt)("p",null,"Ce test v\xe9rifie que les ressources seront bascul\xe9es sur le n\u0153ud secondaire si le n\u0153ud primaire est indisponible et permet la continuit\xe9 du service."),(0,r.kt)("h3",{id:"retour-\xe0-la-situation-nominale-2"},"Retour \xe0 la situation nominale"),(0,r.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,r.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\nDROP       all  --  @QDEVICE_NAME@      anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\nDROP       all  --  anywhere             @QDEVICE_NAME@\n")),(0,r.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,r.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Et le supprimer avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@;\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,r.kt)("p",null,"En ex\xe9cutant la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon")," sur le second noeud, vous verrez le noeud primaire monter dans le cluster.\nSi vous souhaitez passer au noeud primaire, ex\xe9cutez les ","[commandes de basculement]"," (acceptance-guide.md#Retour-\xe0-la-situation-nominale).")),(0,r.kt)(s.Z,{value:"HA 4 Nodes",label:"HA 4 Nodes",mdxType:"TabItem"},(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Ce document fera r\xe9f\xe9rence aux param\xe8tres qui varient d'une installation \xe0 l'autre (par exemple, les noms et adresses IP des n\u0153uds) via . ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/installation/installation-of-centreon-ha/installation-4-nodes#D%C3%A9finition-des-noms-et-adresses-IP-des-serveurs"},"macros d\xe9finies ici"))),(0,r.kt)("h3",{id:"conditions-requises-pour-les-tests-1"},"Conditions requises pour les tests"),(0,r.kt)("p",null,"Pour v\xe9rifier le bon fonctionnement de votre cluster, vous obtiendrez toutes les commandes pour effectuer un test de basculement et simuler des pannes de r\xe9seau."),(0,r.kt)("p",null,"Il est n\xe9cessaire de v\xe9rifier l'\xe9tat du cluster avant d'effectuer les tests d'acceptation. "),(0,r.kt)("h3",{id:"v\xe9rifier-l\xe9tat-du-cluster-1"},"V\xe9rifier l'\xe9tat du cluster"),(0,r.kt)("p",null,"Pour v\xe9rifier l'\xe9tat g\xe9n\xe9ral du cluster, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8/ Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"V\xe9rifiez les erreurs ",(0,r.kt)("inlineCode",{parentName:"p"},"Failed")," dans les ressources et corrigez-les \xe0 l'aide du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/troubleshooting-guide"},"guide de d\xe9pannage"),".")),(0,r.kt)("h3",{id:"v\xe9rifier-les-contraintes-1"},"V\xe9rifier les contraintes"),(0,r.kt)("p",null,"Pour v\xe9rifier qu'il n'y a pas de ",(0,r.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation"),", ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint\n")),(0,r.kt)("p",null,"La commande devrait renvoyer ceci :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\n  Resource: cbd_rrd-clone\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: centreon\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: ms_mysql-clone\n    Disabled on: @CENTRAL_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: php-clone\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\nOrdering Constraints:\n  stop centreon then demote ms_mysql-clone (kind:Mandatory)\nColocation Constraints:\n  ms_mysql-clone with vip_mysql (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\n  Resource: cbd_rrd-clone\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: centreon\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: ms_mysql-master\n    Disabled on: @CENTRAL_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: php-clone\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\nOrdering Constraints:\n  stop centreon then demote ms_mysql-master (kind:Mandatory)\nColocation Constraints:\n  ms_mysql-master with vip_mysql (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,r.kt)("h3",{id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es-1"},"V\xe9rifier l'\xe9tat de la synchronisation de la base de donn\xe9es"),(0,r.kt)("p",null,"Pour v\xe9rifier que la synchronisation de la base de donn\xe9es fonctionne, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Connection Status '@DATABASE_MASTER_NAME@' [OK]\nConnection Status '@DATABASE_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si la synchronisation indique ",(0,r.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/operating-guide"},"operating-guide"),".")),(0,r.kt)("h2",{id:"basculement-des-ressources-du-centreon-1"},"Basculement des ressources du Centreon"),(0,r.kt)("h3",{id:"etat-du-cluster-avant-le-failover-1"},"Etat du cluster avant le failover"),(0,r.kt)("p",null,"Avant d'ex\xe9cuter un test de basculement, v\xe9rifiez l'\xe9tat du cluster avec la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,r.kt)("h3",{id:"effectuer-un-basculement-1"},"Effectuer un basculement"),(0,r.kt)("p",null,"Pour d\xe9placer les ressources, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,r.kt)("p",null,"Vous pouvez \xe9galement utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," pour observer le basculement pendant qu'il se produit. Il sera n\xe9cessaire d'utiliser Ctrl+c pour quitter la commande."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Avertissement : La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource move centreon")," d\xe9finit une contrainte ",(0,r.kt)("inlineCode",{parentName:"p"},"-INFINITY")," sur le noeud h\xe9bergeant la ressource, qui n'est plus autoris\xe9e \xe0 \xeatre ex\xe9cut\xe9e sur ce noeud.")),(0,r.kt)("p",null,"En cons\xe9quence, les ressources se d\xe9placent vers un autre noeud. Suite \xe0 cette manipulation, il est donc n\xe9cessaire d'ex\xe9cuter la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource clear centreon")," pour s'assurer que les ressources pourront \xeatre d\xe9plac\xe9es \xe0 nouveau vers ce noeud dans le futur."),(0,r.kt)("p",null,"Pour v\xe9rifier que les ressources ont \xe9t\xe9 d\xe9plac\xe9es vers le second n\u0153ud, ex\xe9cutez la commande : "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,r.kt)("p",null,"Une fois le basculement termin\xe9, ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Cela permettra de supprimer les contraintes \xe9tablies lors du basculement.")),(0,r.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si la synchronisation a ",(0,r.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2419/fr/docs/22.04/administration/centreon-ha/operating-guide"},"operating-guide"),".")),(0,r.kt)("h3",{id:"retour-\xe0-la-situation-nominale-3"},"Retour \xe0 la situation nominale"),(0,r.kt)("p",null,"Pour revenir \xe0 la situation nominale, vous devez lancer le basculement des ressources."),(0,r.kt)("p",null,"Ex\xe9cutez la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"La sortie devrait \xeatre :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,r.kt)("p",null,"Ensuite, ex\xe9cutez la commande de nettoyage des contraintes si vous avez des ",(0,r.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("p",null,"Ensuite, ex\xe9cutez la commande de basculement : "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,r.kt)("p",null,"Comme pr\xe9c\xe9demment, vous pouvez suivre le basculement avec la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr"),"."),(0,r.kt)("p",null,"Enfin, supprimez les contraintes avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("h2",{id:"simuler-la-perte-du-noeud-secondaire-1"},"Simuler la perte du noeud secondaire"),(0,r.kt)("p",null,"Pour simuler une panne de r\xe9seau qui isolerait le @CENTRAL_SLAVE_NAME@, vous pouvez utiliser ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," pour supprimer le trafic depuis et vers le @CENTRAL_SLAVE_NAME@.\nLe @CENTRAL_SLAVE_NAME@ sera compl\xe8tement exclu du cluster. Le @CENTRAL_MASTER_NAME@ garde la majorit\xe9 avec le QDevice."),(0,r.kt)("h3",{id:"traitement-2"},"Traitement"),(0,r.kt)("p",null,"Pour effectuer ce test, lancez les commandes ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," sur le @CENTRAL_SLAVE_NAME@. Faites attention \xe0 ne pas utiliser @CENTRAL_SLAVE_IPADDR@ sinon vous perdrez la connexion SSH sur ce noeud."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @CENTRAL_MASTER_IPADDR@ -j DROP\niptables -A OUTPUT -d @CENTRAL_MASTER_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A INPUT -s @QDEVICE_IPADDR@ -j DROP\niptables -A OUTPUT -d @QDEVICE_IPADDR@ -j DROP\n")),(0,r.kt)("p",null,"L'ex\xe9cution de la commande fait qu'aucune ressource active n'est visible sur le n\u0153ud secondaire et que le n\u0153ud primaire est vu comme ",(0,r.kt)("inlineCode",{parentName:"p"},"offline"),".\nLes ressources et le cluster fonctionnent toujours en ex\xe9cutant un ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs status")," sur le noeud primaire."),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Thu May  5 10:34:05 2022\nLast change: Thu May  5 09:09:50 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Thu May  5 10:34:05 2022\nLast change: Thu May  5 09:09:50 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,r.kt)("h3",{id:"retour-\xe0-la-situation-nominale-4"},"Retour \xe0 la situation nominale"),(0,r.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,r.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\n")),(0,r.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,r.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Et le supprimer avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,r.kt)("p",null,"Le noeud secondaire est \xe0 nouveau vu ",(0,r.kt)("inlineCode",{parentName:"p"},"en ligne")," par le cluster :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,r.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit comporter les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Connection Status '@DATABASE_MASTER_NAME@' [OK]\nConnection Status '@DATABASE_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("h3",{id:"simuler-la-perte-du-noeud-primaire-1"},"Simuler la perte du noeud primaire"),(0,r.kt)("h3",{id:"traitement-3"},"Traitement"),(0,r.kt)("p",null,"Pour effectuer ce test, ex\xe9cutez les commandes sur le @CENTRAL_MASTER_NAME@ :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @CENTRAL_SLAVE_IPADDR@ -j DROP\niptables -A OUTPUT -d @CENTRAL_SLAVE_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A INPUT -s @QDEVICE_IPADDR@ -j DROP\niptables -A OUTPUT -d @QDEVICE_IPADDR@ -j DROP\n")),(0,r.kt)("p",null,"Les ressources sur le @CENTRAL_MASTER_NAME@ doivent s'arr\xeater et d\xe9marrer sur le @CENTRAL_SLAVE_NAME@. Vous pouvez utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," sur le @CENTRAL_SLAVE_NAME@ pour surveiller le d\xe9marrage des ressources :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Thu May  5 11:06:38 2022\nLast change: Thu May  5 09:09:50 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nvip_mysql       (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nMigration Summary:\n* Node @DATABASE_MASTER_NAME@:\n* Node @CENTRAL_SLAVE_NAME@:\n* Node @DATABASE_SLAVE_NAME@:\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Thu May  5 11:06:38 2022\nLast change: Thu May  5 09:09:50 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nvip_mysql       (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nMigration Summary:\n* Node @DATABASE_MASTER_NAME@:\n* Node @CENTRAL_SLAVE_NAME@:\n* Node @DATABASE_SLAVE_NAME@:\n")))),(0,r.kt)("p",null,"Ce test v\xe9rifie que les ressources seront bascul\xe9es sur le n\u0153ud secondaire si le n\u0153ud primaire est indisponible et permet la continuit\xe9 du service."),(0,r.kt)("h3",{id:"retour-\xe0-la-situation-nominale-5"},"Retour \xe0 la situation nominale"),(0,r.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,r.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@  anywhere\nDROP       all  --  @DATABASE_MASTER_NAME@  anywhere\nDROP       all  --  @DATABASE_SLAVE_NAME@  anywhere\nDROP       all  --  @QDEVICE_NAME@  anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\nDROP       all  --  anywhere             @DATABASE_MASTER_NAME@\nDROP       all  --  anywhere             @DATABASE_SLAVE_NAME@\nDROP       all  --  anywhere             @QDEVICE_NAME@\n")),(0,r.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,r.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Et le supprimer avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@;\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,r.kt)("p",null,"En ex\xe9cutant la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon")," sur le second noeud, vous verrez le noeud primaire monter dans le cluster.\nSi vous souhaitez passer au noeud primaire, ex\xe9cutez les ","[commandes de basculement]"," (acceptance-guide.md#return-to-nominal-situation)."))))}N.isMDXComponent=!0}}]);