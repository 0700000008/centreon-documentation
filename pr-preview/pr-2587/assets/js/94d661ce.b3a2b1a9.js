"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[19311],{874880:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>u,default:()=>g,frontMatter:()=>p,metadata:()=>m,toc:()=>d});n(667294);var a=n(603905),r=n(451715),l=n(907626);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const p={id:"sc-splunk-metrics",title:"Splunk Metrics"},u=void 0,m={unversionedId:"integrations/data-analytics/sc-splunk-metrics",id:"version-22.10/integrations/data-analytics/sc-splunk-metrics",title:"Splunk Metrics",description:"The Splunk Metrics stream connector allows you to send data from Centreon to Splunk instances.",source:"@site/versioned_docs/version-22.10/integrations/data-analytics/sc-splunk-metrics.md",sourceDirName:"integrations/data-analytics",slug:"/integrations/data-analytics/sc-splunk-metrics",permalink:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/integrations/data-analytics/sc-splunk-metrics",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-22.10/integrations/data-analytics/sc-splunk-metrics.md",tags:[],version:"22.10",lastUpdatedAt:1694004916,formattedLastUpdatedAt:"Sep 6, 2023",frontMatter:{id:"sc-splunk-metrics",title:"Splunk Metrics"},sidebar:"version-22.10/docs",previous:{title:"Datadog Metrics",permalink:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/integrations/data-analytics/sc-datadog-metrics"},next:{title:"Splunk Events",permalink:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/integrations/data-analytics/sc-splunk-events"}},c={},d=[{value:"Before starting",id:"before-starting",level:2},{value:"Installation",id:"installation",level:2},{value:"Dependencies",id:"dependencies",level:3},{value:"Lua modules",id:"lua-modules",level:3},{value:"Download the Splunk metrics stream connector",id:"download-the-splunk-metrics-stream-connector",level:3},{value:"Configuring your Splunk equipment",id:"configuring-your-splunk-equipment",level:2},{value:"Configuring the stream connector in Centreon",id:"configuring-the-stream-connector-in-centreon",level:2},{value:"Filtering or adapting the data you want to send to Splunk",id:"filtering-or-adapting-the-data-you-want-to-send-to-splunk",level:3},{value:"Event bulking",id:"event-bulking",level:2},{value:"Event format",id:"event-format",level:2},{value:"service_status event",id:"service_status-event",level:3},{value:"host_status event",id:"host_status-event",level:3},{value:"Custom event format",id:"custom-event-format",level:3},{value:"Curl commands: testing the stream connector",id:"curl-commands-testing-the-stream-connector",level:2},{value:"Sending events",id:"sending-events",level:3}],k={toc:d},h="wrapper";function g(e){var{components:t}=e,n=i(e,["components"]);return(0,a.kt)(h,s(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){o(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The Splunk Metrics stream connector allows you to send data from Centreon to Splunk instances."),(0,a.kt)("h2",{id:"before-starting"},"Before starting"),(0,a.kt)("p",null,"If you want to retrieve only metrics, use the Splunk Metrics stream connector. If you want to retrieve all the data for the events, use the Splunk Events stream connector."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In most cases, you will want to send data from the central server. It is also possible to send it from a remote server or a poller (e.g. if you want to avoid the central server being a SPOF, or if you are an MSP and you install the stream connector on a poller or a remote serevr within your customer's infrastructure)."),(0,a.kt)("li",{parentName:"ul"},"By default, the Splunk Metrics stream connector sends ",(0,a.kt)("strong",{parentName:"li"},"metrics")," from ",(0,a.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/developer/developer-broker-mapping#host-status"},(0,a.kt)("strong",{parentName:"a"},"host_status"))," and ",(0,a.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/developer/developer-broker-mapping#service-status"},(0,a.kt)("strong",{parentName:"a"},"service_status"))," Broker events. These metrics are contained in the ",(0,a.kt)("strong",{parentName:"li"},"perf_data")," field of the events. The event format is shown ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"#event-format"},"here")),"."),(0,a.kt)("li",{parentName:"ul"},"These events are sent each time a host or a service is checked. Various parameters let you ",(0,a.kt)("a",{parentName:"li",href:"#filtering-or-adapting-the-data-you-want-to-send-to-splunk"},"filter out events"),".")),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,"Perform the installation on the server that will send data to Splunk (central server, remote server, poller)."),(0,a.kt)("h3",{id:"dependencies"},"Dependencies"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"CentOS 7/Redhat 7",label:"CentOS 7/Redhat 7",mdxType:"TabItem"},(0,a.kt)("p",null,"Install the ",(0,a.kt)("strong",{parentName:"p"},"Epel")," repository."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum -y install epel-release\n")),(0,a.kt)("p",null,"Install dependencies."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install luarocks make gcc lua-curl lua-devel\n"))),(0,a.kt)(l.Z,{value:"RedHat 8",label:"RedHat 8",mdxType:"TabItem"},(0,a.kt)("p",null,"Install dnf plugins package."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf -y install dnf-plugins-core\n")),(0,a.kt)("p",null,"Install ",(0,a.kt)("strong",{parentName:"p"},"Epel")," repository."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\n")),(0,a.kt)("p",null,"Enable ",(0,a.kt)("strong",{parentName:"p"},"Codeready")," repository."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms\n")),(0,a.kt)("p",null,"Install dependencies."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install make gcc libcurl-devel lua-devel luarocks\n")))),(0,a.kt)("h3",{id:"lua-modules"},"Lua modules"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"CentOS/Redhat 7",label:"CentOS/Redhat 7",mdxType:"TabItem"},(0,a.kt)("p",null,"Install Centreon lua modules."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"luarocks install centreon-stream-connectors-lib\n"))),(0,a.kt)(l.Z,{value:"Redhat 8",label:"Redhat 8",mdxType:"TabItem"},(0,a.kt)("p",null,"Install ",(0,a.kt)("strong",{parentName:"p"},"lua-curl"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"luarocks install Lua-cURL\n")),(0,a.kt)("p",null,"Install Centreon lua modules."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"luarocks install centreon-stream-connectors-lib\n")))),(0,a.kt)("h3",{id:"download-the-splunk-metrics-stream-connector"},"Download the Splunk metrics stream connector"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"wget -O /usr/share/centreon-broker/lua/splunk-metrics-apiv2.lua https://raw.githubusercontent.com/centreon/centreon-stream-connector-scripts/master/centreon-certified/splunk/splunk-metrics-apiv2.lua\nchmod 644 /usr/share/centreon-broker/lua/splunk-metrics-apiv2.lua\n")),(0,a.kt)("h2",{id:"configuring-your-splunk-equipment"},"Configuring your Splunk equipment"),(0,a.kt)("p",null,"You may need to configure your Splunk equipment so that it can receive data from Centreon. Please refer to Splunk's documentation.\nMake sure Splunk is able to receive data sent by Centreon: flows must not be blocked by Splunk's configuration or by a security equipment."),(0,a.kt)("p",null,'The correct sourcetype for the stream connector is "_json". Other useful information may be for example "source": "http:my_index", "index": "my_index", "host": "Central". You can also add this information to your stream connector\'s configuration if you need to.'),(0,a.kt)("h2",{id:"configuring-the-stream-connector-in-centreon"},"Configuring the stream connector in Centreon"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"On your central server, go to ",(0,a.kt)("strong",{parentName:"li"},"Configuration > Pollers > Broker configuration"),"."),(0,a.kt)("li",{parentName:"ol"},"Click on ",(0,a.kt)("strong",{parentName:"li"},"central-broker-master")," (or the appropriate broker configuration if it is a poller or a remote server that will send events)."),(0,a.kt)("li",{parentName:"ol"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Output")," tab, select ",(0,a.kt)("strong",{parentName:"li"},"Generic - Stream connector")," from the list and then click ",(0,a.kt)("strong",{parentName:"li"},"Add"),". A new output appears in the list."),(0,a.kt)("li",{parentName:"ol"},"Fill in the fields as follows:")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Field"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Name"),(0,a.kt)("td",{parentName:"tr",align:null},"Splunk metrics")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Path"),(0,a.kt)("td",{parentName:"tr",align:null},"/usr/share/centreon-broker/lua/splunk-metrics-apiv2.lua")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Filter category"),(0,a.kt)("td",{parentName:"tr",align:null},"Neb")))),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},"To enable Centreon to connect to your Splunk equipment, fill in the following mandatory parameters. The fields for the first entry are already present. Click on the ",(0,a.kt)("strong",{parentName:"li"},"+Add a new entry")," link located below the ",(0,a.kt)("strong",{parentName:"li"},"Filter category")," table to add another one.")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Value explanation"),(0,a.kt)("th",{parentName:"tr",align:null},"Value exemple"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"http_server_url"),(0,a.kt)("td",{parentName:"tr",align:null},"The URL of the Splunk service collector"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"https://mysplunk.centreon.com:8088/services/collector"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"splunk_token"),(0,a.kt)("td",{parentName:"tr",align:null},"Token to use the event collector API"),(0,a.kt)("td",{parentName:"tr",align:null})))),(0,a.kt)("ol",{start:6},(0,a.kt)("li",{parentName:"ol"},"Fill in any optional parameters you want (using the ",(0,a.kt)("strong",{parentName:"li"},"+Add a new entry")," link):")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Value explanation"),(0,a.kt)("th",{parentName:"tr",align:null},"default value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"logfile"),(0,a.kt)("td",{parentName:"tr",align:null},"The file in which logs are written"),(0,a.kt)("td",{parentName:"tr",align:null},"/var/log/centreon-broker/splunk-metrics.log")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"number"),(0,a.kt)("td",{parentName:"tr",align:null},"log_level"),(0,a.kt)("td",{parentName:"tr",align:null},"Logging level from 1 (errors) to 3 (debug)"),(0,a.kt)("td",{parentName:"tr",align:null},"1")))),(0,a.kt)("ol",{start:7},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Use the stream connector's optional parameters to ",(0,a.kt)("a",{parentName:"p",href:"#filtering-or-adapting-the-data-you-want-to-send-to-splunk"},"filter or adapt the data you want Centreon to send to Splunk"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/monitoring/monitoring-servers/deploying-a-configuration"},"Deploy the configuration"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Restart ",(0,a.kt)("strong",{parentName:"p"},"centengine")," on all pollers:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart centengine\n")),(0,a.kt)("p",{parentName:"li"},"Splunk should now receive data from Centreon. To test if it is working, see ",(0,a.kt)("a",{parentName:"p",href:"#curl-commands-testing-the-stream-connector"},"Curl commands: testing the stream connector"),"."))),(0,a.kt)("h3",{id:"filtering-or-adapting-the-data-you-want-to-send-to-splunk"},"Filtering or adapting the data you want to send to Splunk"),(0,a.kt)("p",null,"All stream connectors have a set of ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/centreon/centreon-stream-connector-scripts/blob/master/modules/docs/sc_param.md#default-parameters"},"optional parameters"),", that allow you to filter the data you will send to your Splunk equipment, to reformat the data, to define a proxy..."),(0,a.kt)("p",null,"Each optional parameter has a default value, that is indicated in the corresponding documentation."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"To override the default value of a parameter, click on the ",(0,a.kt)("strong",{parentName:"p"},"+Add a new entry")," link located below the ",(0,a.kt)("strong",{parentName:"p"},"Filter category"),' table to add a custom parameter. For example, if you want to only send to Splunk the events handled by a poller named "poller-1", enter:'),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-text"},"type = string\nname = accepted_pollers\nvalue = poller-1\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For the Splunk Metrics stream connector, the following values always override the default values, you do not need to define them in the interface."))),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Default value for the stream connector"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"accepted_categories"),(0,a.kt)("td",{parentName:"tr",align:null},"neb")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"accepted_elements"),(0,a.kt)("td",{parentName:"tr",align:null},"host_status,service_status")))),(0,a.kt)("h2",{id:"event-bulking"},"Event bulking"),(0,a.kt)("p",null,"This stream connector is compatible with event bulking. Meaning that it is able to send more that one event in each call to the Splunk REST API."),(0,a.kt)("p",null,"To use this feature you must add the following parameter in your stream connector configuration."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"number"),(0,a.kt)("td",{parentName:"tr",align:null},"max_buffer_size"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"more than one"))))),(0,a.kt)("h2",{id:"event-format"},"Event format"),(0,a.kt)("p",null,"This stream connector will send events with the following format."),(0,a.kt)("h3",{id:"service_status-event"},"service_status event"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "sourcetype": "_json",\n  "source": "http:my_index",\n  "index": "my_index",\n  "host": "Central",\n  "time": 1675865364,\n  "fields": {\n    "event_type": "service",\n    "state": 2,\n    "state_type": 1,\n    "hostname": "my_host",\n    "service_description": "my_service",\n    "ctime": 1675865364,\n    "metric: pl": 0,\n    "metric: rta": 10,\n    "metric: rtmin": 5,\n    "metric: rtmax": 15\n  }\n}\n')),(0,a.kt)("h3",{id:"host_status-event"},"host_status event"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "sourcetype": "_json",\n  "source": "http:my_index",\n  "index": "my_index",\n  "host": "Central",\n  "time": 1675865364,\n  "fields": {\n    "event_type": "host",\n    "state": 1,\n    "state_type": 1,\n    "hostname": "my_host",\n    "ctime": 1675865364,\n    "metric: pl": 0,\n    "metric: rta": 10,\n    "metric: rtmin": 5,\n    "metric: rtmax": 15\n  }\n}\n')),(0,a.kt)("h3",{id:"custom-event-format"},"Custom event format"),(0,a.kt)("p",null,"You can't change the format of the event for metrics oriented stream connectors. This means you cannot send other Broker events that contain performance data."),(0,a.kt)("h2",{id:"curl-commands-testing-the-stream-connector"},"Curl commands: testing the stream connector"),(0,a.kt)("h3",{id:"sending-events"},"Sending events"),(0,a.kt)("p",null,"If you want to test that events are sent to Splunk correctly:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Log in to the server that you configured to send events to Splunk (your central server, a remote server or a poller).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run the following command:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X POST -H "content-type: application/json" -H "authorization: Splunk <splunk_token>" \'<http_server_url>\' -d \'{"sourcetype": "<splunk_sourcetype>","source": "<splunk_source>","index": "<splunk_index>","host": "<splunk_host>","time": <epoch_timestamp>,"event": {"event_type": "host","state": 1,"state_type": 1,"hostname":"my_host","ctime": 1675865364,"metric: pl": 0,"metric: rta": 10,"metric: rtmin": 5,"metric: rtmax": 15}}\'\n')),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},"Replace all the ",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"em"},"<xxxx>"))," inside the above command with the correct value. For instance, ",(0,a.kt)("em",{parentName:"p"},"<splunk_sourcetype>")," may become ",(0,a.kt)("em",{parentName:"p"},"_json"),"."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Check that the event has been received by Splunk."))))}g.isMDXComponent=!0}}]);