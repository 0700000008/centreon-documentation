"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[12891],{342604:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>k,contentTitle:()=>p,default:()=>h,frontMatter:()=>c,metadata:()=>u,toc:()=>d});r(667294);var n=r(603905),o=r(451715),a=r(907626);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}const c={id:"secure-your-map-platform",title:"Secure your MAP platform"},p=void 0,u={unversionedId:"graph-views/secure-your-map-platform",id:"version-22.10/graph-views/secure-your-map-platform",title:"Secure your MAP platform",description:"This chapter describes advanced procedures to secure your Centreon MAP and MAP (Legacy)",source:"@site/versioned_docs/version-22.10/graph-views/secure-your-map-platform.md",sourceDirName:"graph-views",slug:"/graph-views/secure-your-map-platform",permalink:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/graph-views/secure-your-map-platform",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-22.10/graph-views/secure-your-map-platform.md",tags:[],version:"22.10",lastUpdatedAt:1694071479,formattedLastUpdatedAt:"Sep 7, 2023",frontMatter:{id:"secure-your-map-platform",title:"Secure your MAP platform"},sidebar:"version-22.10/docs",previous:{title:"Secure your platform",permalink:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/administration/secure-platform"},next:{title:"Basic principles of monitoring",permalink:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/monitoring/about"}},k={},d=[{value:"Configure HTTPS/TLS on the MAP (or MAP Legacy) server",id:"configure-httpstls-on-the-map-or-map-legacy-server",level:2},{value:"HTTPS/TLS configuration with a recognized key",id:"httpstls-configuration-with-a-recognized-key",level:3},{value:"HTTPS/TLS configuration with an auto-signed key",id:"httpstls-configuration-with-an-auto-signed-key",level:3},{value:"Activate TLS profile of Centreon MAP service",id:"activate-tls-profile-of-centreon-map-service",level:3},{value:"Configure TLS on the Broker connection",id:"configure-tls-on-the-broker-connection",level:2},{value:"Broker configuration",id:"broker-configuration",level:3},{value:"MAP server configuration",id:"map-server-configuration",level:3},{value:"Configuration with a self signed certificate",id:"configuration-with-a-self-signed-certificate",level:4},{value:"Configuration with a recognized CA certificate",id:"configuration-with-a-recognized-ca-certificate",level:4}],m={toc:d},f="wrapper";function h(e){var{components:t}=e,c=s(e,["components"]);return(0,n.kt)(f,l(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){i(e,t,r[t])}))}return e}({},m,c),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This chapter describes advanced procedures to secure your Centreon MAP and MAP (Legacy)\nplatform."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you want to use MAP and MAP (Legacy) in HTTPS, you must both secure your Centreon platform and MAP (or MAP Legacy). Follow this ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/administration/secure-platform"},"procedure")," if you need to secure your Centreon platform.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Mistakes when editing configuration files can lead to malfunctions of the software. We recommend that you make a backup of the file before editing it and that you only change the settings advised by Centreon.")),(0,n.kt)("h2",{id:"configure-httpstls-on-the-map-or-map-legacy-server"},"Configure HTTPS/TLS on the MAP (or MAP Legacy) server"),(0,n.kt)("h3",{id:"httpstls-configuration-with-a-recognized-key"},"HTTPS/TLS configuration with a recognized key"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"This section describes how to add a ",(0,n.kt)("strong",{parentName:"p"},"recognized key")," to the Centreon\nMAP (or MAP Legacy) server."),(0,n.kt)("p",{parentName:"blockquote"},"If you want to create an auto-signed key and add it to your server, please\nrefer to the ",(0,n.kt)("a",{parentName:"p",href:"#httpstls-configuration-with-an-auto-signed-key"},"following\nsection"))),(0,n.kt)("p",null,"You will require:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"A key file, referred to as ",(0,n.kt)("em",{parentName:"li"},"key.key"),"."),(0,n.kt)("li",{parentName:"ul"},"A certificate file, referred to as ",(0,n.kt)("em",{parentName:"li"},"certificate.crt"),".")),(0,n.kt)("p",null,"Access the Centreon MAP server through SSH."),(0,n.kt)("p",null,"Create a PKCS12 file with the following command line:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"openssl pkcs12 -inkey key.key -in certificate.crt -export -out keys.pkcs12\n")),(0,n.kt)("p",null,"Then, import this file into a new keystore (a Java repository of security\ncertificates):"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -importkeystore -srckeystore keys.pkcs12 -srcstoretype pkcs12 -destkeystore studio.jks\n")),(0,n.kt)("p",null,'Put above keystore file (studio.jks) to the folder "/etc/centreon-map/",\nand set below parameters inside\n',(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-map/map-config.properties"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"centreon-map.keystore=/etc/centreon-map/studio.jks\ncentreon-map.keystore-pass=xxx\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Replace the keystore-pass value "xxx" with the password you used for\nthe keystore and adapt the path (if it was changed) to the keystore.')),(0,n.kt)("h3",{id:"httpstls-configuration-with-an-auto-signed-key"},"HTTPS/TLS configuration with an auto-signed key"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Enabling the TLS mode with an auto-signed key will force every user to add an\nexception for the certificate before using the web interface."),(0,n.kt)("p",{parentName:"blockquote"},"Enable it only if your Centreon also uses this protocol."),(0,n.kt)("p",{parentName:"blockquote"},"Users will have to open the URL:"),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},"MAP:")),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"https://<MAP_IP>:9443/centreon-map/api/beta/actuator/health\n")),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},"MAP (Legacy):")),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"https://<MAP_IP>:8443/centreon-studio/api/beta/actuator/health\n")),(0,n.kt)("p",{parentName:"blockquote"},(0,n.kt)("em",{parentName:"p"},"The solution we recommend is to use a recognized key method, as explained\nabove."))),(0,n.kt)("p",null,"On the Centreon MAP server, create a keystore."),(0,n.kt)("p",null,"Go to the folder where Java is installed:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd $JAVA_HOME/bin\n")),(0,n.kt)("p",null,"Then generate a keystore file with the following command:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -genkey -alias studio -keyalg RSA -keystore /etc/centreon-studio/studio.jks\n")),(0,n.kt)("p",null,'The alias value "studio" and the keystore file path\n',(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-studio/studio.jks")," may be changed, but unless there is a\nspecific reason, we advise keeping the default values."),(0,n.kt)("p",null,"Provide the needed information when creating the keystore."),(0,n.kt)("p",null,'At the end of the screen form, when the "key password" is requested, use\nthe same password as the one used for the keystore itself by pressing the\nENTER key.'),(0,n.kt)("p",null,'Put above keystore file (studio.jks) to the folder "/etc/centreon-map/",\nand set below parameters inside\n',(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-map/map-config.properties"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"centreon-map.keystore=/etc/centreon-map/studio.jks\ncentreon-map.keystore-pass=xxx\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Replace the keystore-pass value "xxx" with the password you used for\nthe keystore and adapt the path (if it was changed to the keystore).')),(0,n.kt)("h3",{id:"activate-tls-profile-of-centreon-map-service"},"Activate TLS profile of Centreon MAP service"),(0,n.kt)(o.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(a.Z,{value:"MAP",label:"MAP",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Stop Centreon MAP service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centreon-map-engine\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Edit the file ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-map/centreon-map.conf"),', adding ",tls"\nafter "prod" profile:'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-text"},'RUN_ARGS="--spring.profiles.active=prod,tls"\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Restart Centreon MAP service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start centreon-map-engine\n"))))),(0,n.kt)(a.Z,{value:"MAP (Legacy)",label:"MAP (Legacy)",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Stop Centreon MAP service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centreon-map\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Edit the file ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-studio/centreon-map.conf"),', adding ",tls"\nafter "prod" profile:'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-text"},'RUN_ARGS="--spring.profiles.active=prod,tls"\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Restart Centreon MAP service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start centreon-map\n")))))),(0,n.kt)("p",null,"Centreon MAP server is now configured to respond to requests from HTTPS:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"at port 9443 for MAP,"),(0,n.kt)("li",{parentName:"ul"},"at port 8443 for MAP (Legacy).")),(0,n.kt)("p",null,"To change the default port, refer to the ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/graph-views/advanced-configuration#change-centreon-map-server-port"},"dedicated\nprocedure"),"."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Don't forget to modify the URL on Centreon side in the ",(0,n.kt)("strong",{parentName:"p"},"Map server address"),"\nfield in the ",(0,n.kt)("strong",{parentName:"p"},"Administration > Extensions > Map > Options")," menu.\n",(0,n.kt)("img",{alt:"image",src:r(389053).Z,width:"1671",height:"851"}))),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Don't forget to update your connection profile in the desktop client\nby checking the ssl checkbox.\n",(0,n.kt)("img",{alt:"image",src:r(581077).Z,width:"500",height:"291"}))),(0,n.kt)("h2",{id:"configure-tls-on-the-broker-connection"},"Configure TLS on the Broker connection"),(0,n.kt)("p",null,"An additional Broker output for Centreon Central (centreon-broker-master) has\nbeen created during the installation."),(0,n.kt)("p",null,"You can check it in your Centreon web interface, from the ",(0,n.kt)("inlineCode",{parentName:"p"},"Configuration >\nPollers > Broker Configuration"),", by editing the ",(0,n.kt)("inlineCode",{parentName:"p"},"centreon-broker-master"),"\nconfiguration."),(0,n.kt)("p",null,"The output configuration should look like this:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:r(239657).Z,width:"1009",height:"680"})),(0,n.kt)("h3",{id:"broker-configuration"},"Broker configuration"),(0,n.kt)("p",null,"You can enable TLS output and set up Broker's private key and public\ncertificate as described below:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:r(57661).Z,width:"1222",height:"471"})),(0,n.kt)("p",null,"To create a self-signed certificate, you can use the following commands: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"openssl req -new -newkey rsa:2048 -nodes -keyout broker_private.key -out broker.csr\nopenssl x509 -req -in broker.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out broker_public.crt -days 365 -sha256\n")),(0,n.kt)("p",null,"And then, copy the private key and the certificate into ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon/broker_cert/")," directory:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"mv broker_private.key /etc/centreon/broker_cert/\nmv broker_public.crt /etc/centreon/broker_cert/\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'"Trusted CA\'s certificate" field is optional. If you activate Broker\'s client\nauthentication by setting this "ca',"_",'certificate.crt", then you must setup a\n',(0,n.kt)("a",{parentName:"p",href:"#configure-httpstls-on-the-web-server"},"keystore for MAP server")),(0,n.kt)("p",{parentName:"blockquote"},"You MUST push the new broker configuration and restart the broker after\nconfiguration.")),(0,n.kt)("h3",{id:"map-server-configuration"},"MAP server configuration"),(0,n.kt)("p",null,"First of all, you should ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2587/docs/22.10/administration/secure-platform#enable-https-on-the-web-server"},"activate HTTPS/TLS on the web server")),(0,n.kt)("p",null,"Then, set the following parameters in MAP server configuration at:"),(0,n.kt)(o.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(a.Z,{value:"MAP",label:"MAP",mdxType:"TabItem"},(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-map/centreon-map.conf"))),(0,n.kt)(a.Z,{value:"MAP (Legacy)",label:"MAP (Legacy)",mdxType:"TabItem"},(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio-config.properties")))),(0,n.kt)("p",null,"To set the communication protocol with Centreon server to HTTPS:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"centreon.url=https://<server-address>\n")),(0,n.kt)("p",null,"To enable TLS socket connection with Broker:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"broker.tls=true\n")),(0,n.kt)("h4",{id:"configuration-with-a-self-signed-certificate"},"Configuration with a self signed certificate"),(0,n.kt)("p",null,"If the Broker public certificate is self signed, you must create a trust store\ncontaining given certificate or its CA certificate with the following command\nline:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -import -alias centreon-broker -file broker_public.crt -keystore truststore.jks\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},'"broker',"_",'public.crt" is Broker public certificate or its CA certificate\nin PEM format,'),(0,n.kt)("li",{parentName:"ul"},'"truststore.jks" is the generated trust store in JKS format,'),(0,n.kt)("li",{parentName:"ul"},"a store password is required during generation.")),(0,n.kt)("p",null,'Then, put the generated output file "truststore.jks" into\n"/etc/centreon-studio" of MAP server host.'),(0,n.kt)("p",null,"And add truststore parameters in\n",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-studio/studio-config.properties"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"centreon-map.truststore=/etc/centreon-studio/truststore.jks\ncentreon-map.truststore-pass=XXXX\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Replace the trustStorePassword value "xxx" with the password you used when\ngenerate the trust store.')),(0,n.kt)("p",null,'Meanwhile, you should activate the "tls_broker" profile of Centreon MAP\nservice.'),(0,n.kt)("p",null,"Edit the file ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-studio/centreon-map.conf"),', and replace ",tls" by\n",tls_broker" after "prod" profile:'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},'RUN_ARGS="--spring.profiles.active=prod,tls_broker"\n')),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'"tls_broker" profile implies "tls" profile. So Centreon MAP service\nserves necessarily HTTPS.')),(0,n.kt)("p",null,"Once you add a truststore, Centreon MAP will use it to validate self-signed certificates.\nThis means that if you use a self-signed certificate for the central server, you must add it to the truststore. If you don't, the\n",(0,n.kt)("strong",{parentName:"p"},"Monitoring > Map")," page will be blank, and the logs (",(0,n.kt)("strong",{parentName:"p"},"/var/log/centreon-map/centreon-map.log"),")\nwill show the following error :\n",(0,n.kt)("inlineCode",{parentName:"p"},"unable to find valid certification path to requested target"),"."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Copy the central server's ",(0,n.kt)("strong",{parentName:"p"},".crt")," certificate to the MAP server.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Add the certificate to the truststore:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -import -alias centreon-broker -file central_public.crt -keystore truststore.jks\n")))),(0,n.kt)("h4",{id:"configuration-with-a-recognized-ca-certificate"},"Configuration with a recognized CA certificate"),(0,n.kt)("p",null,'If the broker public certificate is signed with a recognized CA, the JVM\ndefault trust store "cacerts (/etc/pki/java/cacerts)" will be used. Nothing\nto configure for Centreon MAP service'))}h.isMDXComponent=!0},581077:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/desktop-ssl-option-35d21867fe17acbfe78e1702056257b6.png"},389053:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/map-address-https-fc6a107dda2236d28ff090b466462bde.png"},239657:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/output_broker-99d87793ecc682b990834f9d5b119d6b.png"},57661:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/output_broker_tls-06c7ceab462d3430c573d0546159aef1.png"}}]);