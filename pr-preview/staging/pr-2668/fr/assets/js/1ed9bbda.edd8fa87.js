"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[39972],{593334:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>E,contentTitle:()=>u,default:()=>_,frontMatter:()=>d,metadata:()=>i,toc:()=>A});t(667294);var r=t(603905),a=t(451715),s=t(907626);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const d={id:"acceptance-guide",title:"Guide de recette du cluster"},u=void 0,i={unversionedId:"administration/centreon-ha/acceptance-guide",id:"version-21.10/administration/centreon-ha/acceptance-guide",title:"Guide de recette du cluster",description:"Sauf mention contraire, toutes les commandes pr\xe9sent\xe9es dans ce document sont \xe0 lancer en tant que root.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-21.10/administration/centreon-ha/acceptance-guide.md",sourceDirName:"administration/centreon-ha",slug:"/administration/centreon-ha/acceptance-guide",permalink:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/administration/centreon-ha/acceptance-guide",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-21.10/administration/centreon-ha/acceptance-guide.md",tags:[],version:"21.10",lastUpdatedAt:1697639520,formattedLastUpdatedAt:"18 oct. 2023",frontMatter:{id:"acceptance-guide",title:"Guide de recette du cluster"},sidebar:"version-21.10/docs",previous:{title:"Installer l'Agent Centreon",permalink:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/health/centreon-agent"},next:{title:"Supervision de Centreon-HA",permalink:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/administration/centreon-ha/monitoring-guide"}},E={},A=[{value:"Condition des tests",id:"condition-des-tests",level:2},{value:"V\xe9rifier l&#39;\xe9tat du cluster",id:"v\xe9rifier-l\xe9tat-du-cluster",level:3},{value:"V\xe9rifier les contraintes",id:"v\xe9rifier-les-contraintes",level:3},{value:"V\xe9rifier le status de la synchronisation des bases",id:"v\xe9rifier-le-status-de-la-synchronisation-des-bases",level:3},{value:"Bascule des ressource Centreon",id:"bascule-des-ressource-centreon",level:2},{value:"\xc9tat du cluster avant la bascule",id:"\xe9tat-du-cluster-avant-la-bascule",level:3},{value:"Ex\xe9cuter une bascule",id:"ex\xe9cuter-une-bascule",level:3},{value:"Retour en situation nominale",id:"retour-en-situation-nominale",level:3},{value:"Simuler la perte du n\u0153ud secondaire",id:"simuler-la-perte-du-n\u0153ud-secondaire",level:2},{value:"Ex\xe9cution",id:"ex\xe9cution",level:3},{value:"Retour en situation nominale",id:"retour-en-situation-nominale-1",level:3},{value:"Simuler la perte du n\u0153ud primaire",id:"simuler-la-perte-du-n\u0153ud-primaire",level:2},{value:"Ex\xe9cution",id:"ex\xe9cution-1",level:3},{value:"Retour en situation nominale",id:"retour-en-situation-nominale-2",level:3}],p={toc:A},N="wrapper";function _(e){var{components:n}=e,t=c(e,["components"]);return(0,r.kt)(N,l(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){o(e,n,t[n])}))}return e}({},p,t),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Sauf mention contraire, toutes les commandes pr\xe9sent\xe9es dans ce document sont \xe0 lancer en tant que ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Dans ce document, nous ferons r\xe9f\xe9rence \xe0 des param\xe8tres variant d'une installation \xe0 une autre (noms et adresses IP des n\u0153uds par exemple) par l'interm\xe9diaire des ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/installation/installation-of-centreon-ha/installation-2-nodes#d%C3%A9finition-des-noms-et-adresses-ip-des-serveurs"},"macros d\xe9finies ici"))),(0,r.kt)("h2",{id:"condition-des-tests"},"Condition des tests"),(0,r.kt)("p",null,"Pour v\xe9rifier le bon fonctionnement de votre cluster, vous trouverez toutes les commandes pour effectuer un test de bascule et simuler des coupures r\xe9seau au sein du cluster."),(0,r.kt)("p",null,"Il est n\xe9cessaire de v\xe9rifier l'\xe9tat du cluster avant d'effectuer les tests de recette."),(0,r.kt)("h3",{id:"v\xe9rifier-l\xe9tat-du-cluster"},"V\xe9rifier l'\xe9tat du cluster"),(0,r.kt)("p",null,"Pour v\xe9rifier l'\xe9tat g\xe9n\xe9ral du cluster ex\xe9cuter la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"La commande doit vous renvoyer les informations suivantes :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:09:30 2021\nLast change: Fri Jul  9 11:08:57 2021 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"V\xe9rifier les erreurs de type ",(0,r.kt)("inlineCode",{parentName:"p"},"Failed")," pr\xe9sentes sur les ressources et corriger ces derni\xe8res en vous aidant du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/administration/centreon-ha/troubleshooting-guide"},"guide de troubleshooting"),".")),(0,r.kt)("h3",{id:"v\xe9rifier-les-contraintes"},"V\xe9rifier les contraintes"),(0,r.kt)("p",null,"Pour v\xe9rifier qu'il n'y ait pas de ",(0,r.kt)("inlineCode",{parentName:"p"},"Location Constraints"),", ex\xe9cuter la commande: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint\n")),(0,r.kt)("p",null,"La commande doit vous retourner les informations suivantes :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Location Constraints:\nOrdering Constraints:\nColocation Constraints:\n  centreon with ms_mysql-clone (score:INFINITY) (rsc-role:Started) (with-rsc-role:Master)\n  ms_mysql-clone with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Location Constraints:\nOrdering Constraints:\nColocation Constraints:\n  centreon with ms_mysql-master (score:INFINITY) (rsc-role:Started) (with-rsc-role:Master)\n  ms_mysql-master with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,r.kt)("h3",{id:"v\xe9rifier-le-status-de-la-synchronisation-des-bases"},"V\xe9rifier le status de la synchronisation des bases"),(0,r.kt)("p",null,"Pour v\xe9rifier que la synchronisation des bases fonctionne, ex\xe9cuter la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit vous renvoyer les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si la synchronisation pr\xe9sente des ",(0,r.kt)("inlineCode",{parentName:"p"},"KO")," vous devez corriger ces derni\xe8res en vous aidant du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/administration/centreon-ha/operating-guide"},"guide d'op\xe9ration"),".")),(0,r.kt)("h2",{id:"bascule-des-ressource-centreon"},"Bascule des ressource Centreon"),(0,r.kt)("h3",{id:"\xe9tat-du-cluster-avant-la-bascule"},"\xc9tat du cluster avant la bascule"),(0,r.kt)("p",null,"Avant d'ex\xe9cuter un test de bascule, v\xe9rifiez l'\xe9tat du cluster avec la commande \xe0 l'aide de la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:24:27 2021\nLast change: Fri Jul  9 11:08:57 2021 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("h3",{id:"ex\xe9cuter-une-bascule"},"Ex\xe9cuter une bascule"),(0,r.kt)("p",null,"Pour basculer les ressources, ex\xe9cuter la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,r.kt)("p",null,"Vous pouvez aussi utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," pour suivre la bascule au fur et \xe0 mesure. Il sera n\xe9cessaire d'utiliser Ctrl+c pour quitter la commande."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Attention : La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource move centreon")," positionne une contrainte ",(0,r.kt)("inlineCode",{parentName:"p"},"-INFINITY")," sur le n\u0153ud h\xe9bergeant la ressource qui n'est plus autoris\xe9e \xe0 \xeatre en fonctionnement sur ce n\u0153ud. De ce fait, la ressource bascule sur un autre n\u0153ud. Suite \xe0 cette manipulation, il est donc n\xe9cessaire d'ex\xe9cuter la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource clear centreon")," pour permettre \xe0 cette ressource de basculer \xe0 nouveau sur ce n\u0153ud \xe0 l'avenir.")),(0,r.kt)("p",null,"Pour v\xe9rifier que les ressources aient bien bascul\xe9 sur le second n\u0153ud, ex\xe9cuter la commande : "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:38:32 2021\nLast change: Fri Jul  9 11:37:55 2021 by root via crm_attribute on @CENTRAL_SLAVE_NAME@\n    \n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_SLAVE_NAME@ ]\n     Slaves: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n")))),(0,r.kt)("p",null,"Vous pouvez remarquer qu'en plus des ressources ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon"),", le n\u0153ud secondaire a aussi \xe9t\xe9 promu comme ",(0,r.kt)("inlineCode",{parentName:"p"},"master")," pour la ressource ",(0,r.kt)("inlineCode",{parentName:"p"},"ms_mysql"),". Ce comportement est voulu et d\xfb aux ",(0,r.kt)("inlineCode",{parentName:"p"},"Colocation Contraints")," entre la ressource ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"msq_mysql"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Les ",(0,r.kt)("inlineCode",{parentName:"p"},"Colocation Constraints")," ne sont pas pr\xe9sent sur un Cluster \xe0 4 n\u0153uds !")),(0,r.kt)("p",null,"Une fois que la bascule est termin\xe9e, ex\xe9cuter la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Ceci permettra de retirer les contraintes \xe9tablies lors de la bascule.")),(0,r.kt)("p",null,"V\xe9rifier aussi que la r\xe9plication MySQL est toujours op\xe9rationnelle \xe0 l'aide de la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit vous retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si la synchronisation pr\xe9sente des ",(0,r.kt)("inlineCode",{parentName:"p"},"KO")," vous devez corriger ces derni\xe8res en vous aidant du ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/administration/centreon-ha/operating-guide"},"guide d'op\xe9ration"),".")),(0,r.kt)("h3",{id:"retour-en-situation-nominale"},"Retour en situation nominale"),(0,r.kt)("p",null,"Afin de revenir en situation nominale, vous devez lancer la bascule des ressources."),(0,r.kt)("p",null,"Ex\xe9cuter la commande  :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,r.kt)("p",null,"afin de v\xe9rifier qu'il n'ait pas d'erreurs :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):         Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):          Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):       Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):          Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 11:38:32 2021\nLast change: Fri Jul  9 11:37:55 2021 by root via crm_attribute on @CENTRAL_SLAVE_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_SLAVE_NAME@ ]\n     Slaves: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n")))),(0,r.kt)("p",null,"Ensuite, lancer la commande de nettoyage des contraintes au cas o\xf9 vous avez :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("p",null,"Puis, lancer la commande de bascule : "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,r.kt)("p",null,"Comme pr\xe9c\xe9demment, vous pouvez suivre la bascule \xe0 l'aide de la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr"),"."),(0,r.kt)("p",null,"Enfin, supprimer les contraintes avec la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("h2",{id:"simuler-la-perte-du-n\u0153ud-secondaire"},"Simuler la perte du n\u0153ud secondaire"),(0,r.kt)("p",null,"Afin de simuler une coupure r\xe9seau qui isolerait le n\u0153ud secondaire, vous pouvez utiliser ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," pour bloquer le trafic vers le n\u0153ud secondaire.\nLe n\u0153ud secondaire sera compl\xe8tement exclu du cluster. Le n\u0153ud primaire garde la majorit\xe9 avec le QDevice."),(0,r.kt)("h3",{id:"ex\xe9cution"},"Ex\xe9cution"),(0,r.kt)("p",null,"Pour r\xe9aliser ce test, lancer les commandes ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," sur le n\u0153ud primaire :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @IP_SECONDARY_NODE@ -j DROP;\niptables -A OUTPUT -d @IP_SECONDARY_NODE@ -j DROP\n")),(0,r.kt)("p",null,"L'ex\xe9cution de la commande a pour effet de ne voir aucune ressource active sur le n\u0153ud secondaire et de voir le n\u0153ud primaire comme ",(0,r.kt)("inlineCode",{parentName:"p"},"offline")," :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nNo active resources\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_SLAVE_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition WITHOUT quorum\nLast updated: Fri Jul  9 16:11:53 2021\nLast change: Fri Jul  9 16:06:34 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nNo active resources\n")))),(0,r.kt)("p",null,"En ex\xe9cutant un ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon")," sur le premier n\u0153ud, les ressources et le cluster fonctionne toujours.\nLe n\u0153ud secondaire est vue ",(0,r.kt)("inlineCode",{parentName:"p"},"offline")," sur le primaire."),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ ]\n  * OFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 16:19:03 2021\nLast change: Fri Jul  9 16:05:26 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ ]\nOFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("h3",{id:"retour-en-situation-nominale-1"},"Retour en situation nominale"),(0,r.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, \xe9xecuter la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,r.kt)("p",null,"La commande doit vous retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\n")),(0,r.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,r.kt)("p",null,"Le cas contraire, il sera n\xe9cessaire de lister les num\xe9ros des r\xe8gles \xe0 l'aide de la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Et de le supprimer \xe0 l'aide de la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,r.kt)("p",null,"Le n\u0153ud secondaire est de nouveau vu ",(0,r.kt)("inlineCode",{parentName:"p"},"online")," par le cluster :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 17:12:39 2021\nLast change: Fri Jul  9 16:06:34 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("p",null,"V\xe9rifier aussi que la r\xe9plication MySQL est toujours op\xe9rationnelle \xe0 l'aide de la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La commande doit vous retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("h2",{id:"simuler-la-perte-du-n\u0153ud-primaire"},"Simuler la perte du n\u0153ud primaire"),(0,r.kt)("p",null,"Afin de simuler une coupure r\xe9seau qui isolerait le n\u0153ud primaire, vous pouvez utiliser ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables")," pour bloquer le trafic vers le n\u0153ud secondaire et le Qdevice.\nLe n\u0153ud primaire sera compl\xe8tement exclu du cluster. Le n\u0153ud secondaire gagne la majorit\xe9 avec le QDevice."),(0,r.kt)("h3",{id:"ex\xe9cution-1"},"Ex\xe9cution"),(0,r.kt)("p",null,"Afin de r\xe9aliser ce test, lancer les commandes sur le serveur primaire :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @CENTRAL_SLAVE_IP@ -j DROP ;\niptables -A OUTPUT -d @CENTRAL_SLAVE_IP@ -j DROP ; \niptables -A INPUT -s @QDEVICE_IP@ -j DROP ;\niptables -A OUTPUT -d @QDEVICE_IP@  -j DROP\n")),(0,r.kt)("p",null,"Les ressources sur le n\u0153ud primaire doivent s'arr\xeater et doivent d\xe9marrer sur le n\u0153ud secondaire. Vous pouvez utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," sur le n\u0153ud secondaire pour suivre le d\xe9marrage des ressources :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE [ @CENTRAL_MASTER_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php7-clone [php7]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition with quorum\nLast updated: Fri Jul  9 15:14:00 2021\nLast change: Fri Jul  9 15:11:35 2021 by root via crm_resource on @CENTRAL_SLAVE_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php7-clone [php7]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n")))),(0,r.kt)("p",null,"Sur le n\u0153ud primaire, la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"pcs status")," doit vous retourner le r\xe9sultat suivant :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE [ @CENTRAL_MASTER_NAME@ ]\n\nNo active resources\n"))),(0,r.kt)(s.Z,{value:"RHEL 7 / CentOS 7",label:"RHEL 7 / CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el7_9.1-9acf116022) - partition WITHOUT quorum\nLast updated: Fri Jul  9 15:40:14 2021\nLast change: Fri Jul  9 15:12:43 2021 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resource instances configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ ]\nOFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\n\nNo active resources\n")))),(0,r.kt)("p",null,"Ce test permet de v\xe9rifier qu'en cas d'indisponibilit\xe9 du n\u0153ud primaire, les ressources basculeront sur le n\u0153ud secondaire et permet une continuit\xe9 de service."),(0,r.kt)("h3",{id:"retour-en-situation-nominale-2"},"Retour en situation nominale"),(0,r.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cuter la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,r.kt)("p",null,"La commande doit vous retourner les informations suivantes :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\nDROP       all  --  @QDEVICE_NAME@      anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\nDROP       all  --  anywhere             @QDEVICE_NAME@\n")),(0,r.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,r.kt)("p",null,"Le cas contraire, il sera n\xe9cessaire de lister les num\xe9ros des r\xe8gles \xe0 l'aide de la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Et de le supprimer \xe0 l'aide de la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,r.kt)("p",null,"En lan\xe7ant la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon")," sur le second n\u0153ud, vous verrez le n\u0153ud primaire remonter dans le cluster.\nSi vous souhaitez basculer sur le n\u0153ud primaire, ex\xe9cuter les ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2668/fr/docs/21.10/administration/centreon-ha/acceptance-guide#retour-en-situation-nominal"},"commandes de bascule"),"."))}_.isMDXComponent=!0}}]);