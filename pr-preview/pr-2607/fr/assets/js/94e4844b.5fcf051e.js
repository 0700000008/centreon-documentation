"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[41980],{395660:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>v,frontMatter:()=>u,metadata:()=>i,toc:()=>m});n(667294);var r=n(603905),a=n(451715),s=n(907626);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const u={id:"upgrade-centreon-ha-from-20-04",title:"Mont\xe9e de version de Centreon HA depuis Centreon 20.04"},p=void 0,i={unversionedId:"upgrade/centreon-ha/upgrade-centreon-ha-from-20-04",id:"version-22.10/upgrade/centreon-ha/upgrade-centreon-ha-from-20-04",title:"Mont\xe9e de version de Centreon HA depuis Centreon 20.04",description:"Ce chapitre d\xe9crit comment mettre \xe0 niveau votre plate-forme Centreon HA de la version 20.04",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-22.10/upgrade/centreon-ha/upgrade-from-20-04.md",sourceDirName:"upgrade/centreon-ha",slug:"/upgrade/centreon-ha/upgrade-centreon-ha-from-20-04",permalink:"/centreon-documentation/pr-preview/pr-2607/fr/docs/22.10/upgrade/centreon-ha/upgrade-centreon-ha-from-20-04",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-22.10/upgrade/centreon-ha/upgrade-from-20-04.md",tags:[],version:"22.10",lastUpdatedAt:1694533851,formattedLastUpdatedAt:"12 sept. 2023",frontMatter:{id:"upgrade-centreon-ha-from-20-04",title:"Mont\xe9e de version de Centreon HA depuis Centreon 20.04"},sidebar:"version-22.10/docs",previous:{title:"Mont\xe9e de version depuis Centreon 3.4",permalink:"/centreon-documentation/pr-preview/pr-2607/fr/docs/22.10/upgrade/upgrade-from-3-4"},next:{title:"Mont\xe9e de version de Centreon HA depuis Centreon 20.10",permalink:"/centreon-documentation/pr-preview/pr-2607/fr/docs/22.10/upgrade/centreon-ha/upgrade-centreon-ha-from-20-10"}},d={},m=[{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Suspension de la gestion des resources par le cluster",id:"suspension-de-la-gestion-des-resources-par-le-cluster",level:3},{value:"Sauvegarde",id:"sauvegarde",level:3},{value:"Mettre \xe0 jour la cl\xe9 de signature RPM",id:"mettre-\xe0-jour-la-cl\xe9-de-signature-rpm",level:3},{value:"Processus de mise \xe0 jour",id:"processus-de-mise-\xe0-jour",level:2},{value:"Mise \xe0 jour des d\xe9p\xf4ts",id:"mise-\xe0-jour-des-d\xe9p\xf4ts",level:3},{value:"Mise \xe0 jour PHP",id:"mise-\xe0-jour-php",level:3},{value:"Mont\xe9e de version de la solution Centreon",id:"mont\xe9e-de-version-de-la-solution-centreon",level:3},{value:"Mont\xe9e de version du serveur MariaDB",id:"mont\xe9e-de-version-du-serveur-mariadb",level:3},{value:"Activer MariaDB au d\xe9marrage automatique",id:"activer-mariadb-au-d\xe9marrage-automatique",level:4},{value:"Suppression des crons",id:"suppression-des-crons",level:3},{value:"Changez les permissions pour la resource centreon_central_sync",id:"changez-les-permissions-pour-la-resource-centreon_central_sync",level:3},{value:"Ugprade du cluster",id:"ugprade-du-cluster",level:2},{value:"Mode maintenance et sauvegarde",id:"mode-maintenance-et-sauvegarde",level:3},{value:"Supprimer les ressources",id:"supprimer-les-ressources",level:3},{value:"Reconfigurer MariaDB",id:"reconfigurer-mariadb",level:3},{value:"Lancer la r\xe9plication GTID",id:"lancer-la-r\xe9plication-gtid",level:3},{value:"Recr\xe9er les ressources du cluster",id:"recr\xe9er-les-ressources-du-cluster",level:3},{value:"Ressource PHP",id:"ressource-php",level:4},{value:"Ressource RRD broker",id:"ressource-rrd-broker",level:4},{value:"Recr\xe9er le groupe de ressources <em>centreon</em>",id:"recr\xe9er-le-groupe-de-ressources-centreon",level:4},{value:"Recr\xe9er les contraintes",id:"recr\xe9er-les-contraintes",level:4},{value:"Reprise de la gestion des ressources du cluster",id:"reprise-de-la-gestion-des-ressources-du-cluster",level:2},{value:"V\xe9rifier la sant\xe9 du cluster",id:"v\xe9rifier-la-sant\xe9-du-cluster",level:2},{value:"Ressources d\xe9sactiv\xe9es",id:"ressources-d\xe9sactiv\xe9es",level:3},{value:"V\xe9rification de la stabilit\xe9 de la plate-forme",id:"v\xe9rification-de-la-stabilit\xe9-de-la-plate-forme",level:2}],k={toc:m},N="wrapper";function v(e){var{components:t}=e,n=c(e,["components"]);return(0,r.kt)(N,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Ce chapitre d\xe9crit comment mettre \xe0 niveau votre plate-forme Centreon HA de la version 20.04\nvers la version 22.10."),(0,r.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,r.kt)("h3",{id:"suspension-de-la-gestion-des-resources-par-le-cluster"},"Suspension de la gestion des resources par le cluster"),(0,r.kt)("p",null,"Afin d'\xe9viter un basculement du cluster pendant la mise \xe0 jour, il est n\xe9cessaire de surpendre toutes les ressources Centreon, ainsi que MariaDB."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs property set maintenance-mode=true\n")),(0,r.kt)("h3",{id:"sauvegarde"},"Sauvegarde"),(0,r.kt)("p",null,"Avant toute chose, il est pr\xe9f\xe9rable de s\u2019assurer de l\u2019\xe9tat et de la consistance\ndes sauvegardes de l\u2019ensemble des serveurs centraux de votre plate-forme :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Serveur Centreon Central,"),(0,r.kt)("li",{parentName:"ul"},"Serveur de base de donn\xe9es.")),(0,r.kt)("h3",{id:"mettre-\xe0-jour-la-cl\xe9-de-signature-rpm"},"Mettre \xe0 jour la cl\xe9 de signature RPM"),(0,r.kt)("p",null,"Pour des raisons de s\xe9curit\xe9, les cl\xe9s utilis\xe9es pour signer les RPMs Centreon sont chang\xe9es r\xe9guli\xe8rement. Le dernier changement a eu lieu le 14 octobre 2021. Lorsque vous mettez Centreon \xe0 jour depuis une version plus ancienne, vous devez suivre la ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2607/fr/docs/22.10/security/key-rotation#installation-existante"},"proc\xe9dure de changement de cl\xe9"),", afin de supprimer l'ancienne cl\xe9 et d'installer la nouvelle."),(0,r.kt)("h2",{id:"processus-de-mise-\xe0-jour"},"Processus de mise \xe0 jour"),(0,r.kt)("h3",{id:"mise-\xe0-jour-des-d\xe9p\xf4ts"},"Mise \xe0 jour des d\xe9p\xf4ts"),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install -y https://yum.centreon.com/standard/22.10/el7/stable/noarch/RPMS/centreon-release-22.10-1.el7.centos.noarch.rpm\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Attention:")," pour \xe9viter des probl\xe8mes de d\xe9pendances manquantes, r\xe9f\xe9rez-vous \xe0 la documentation des modules additionnels pour mettre \xe0 jour les d\xe9p\xf4ts Centreon Business")),(0,r.kt)("h3",{id:"mise-\xe0-jour-php"},"Mise \xe0 jour PHP"),(0,r.kt)("p",null,"Centreon 22.04 utilise PHP en version 8.1."),(0,r.kt)("p",null,"Vous devez tout d'abord installer les d\xe9p\xf4ts ",(0,r.kt)("strong",{parentName:"p"},"remi")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install -y yum-utils\nyum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nyum install -y https://rpms.remirepo.net/enterprise/remi-release-7.rpm\n")),(0,r.kt)("p",null,"Ensuite, vous devez activer le d\xe9p\xf4t php 8.1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum-config-manager --enable remi-php81\n")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-de-la-solution-centreon"},"Mont\xe9e de version de la solution Centreon"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Assurez-vous que tous les utilisateurs sont d\xe9connect\xe9s avant de commencer\nla proc\xe9dure de mise \xe0 jour.")),(0,r.kt)("p",null,"Videz le cache de yum :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Mettez \xe0 jour l'ensemble des composants :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"HA 2 Nodes",label:"HA 2 Nodes",mdxType:"TabItem"},(0,r.kt)("p",null,"Suppression de l'ancien paquet Centreon-HA :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum remove centreon-ha\n")),(0,r.kt)("p",null,"Mise \xe0 jour des paquets Centreon: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum update centreon\\* \n")),(0,r.kt)("p",null,"Installation des nouveaux paquets Centreon-HA :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-ha-web centreon-ha-common\n")),(0,r.kt)("p",null,"\xc9crasez l'ancien fichier ",(0,r.kt)("em",{parentName:"p"},"centreon_central_sync.pm")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /etc/centreon-ha/centreon_central_sync.pm.rpmsave /etc/centreon-ha/centreon_central_sync.pm\n")),(0,r.kt)("p",null,"\xc9crasez l'ancien fichier ",(0,r.kt)("em",{parentName:"p"},"mysql-resources.sh"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /etc/centreon-ha/mysql-resources.sh.rpmsave /etc/centreon-ha/mysql-resources.sh\n"))),(0,r.kt)(s.Z,{value:"HA 4 Nodes",label:"HA 4 Nodes",mdxType:"TabItem"},(0,r.kt)("p",null,"Sur les serveurs ",(0,r.kt)("strong",{parentName:"p"},"Centraux")," :"),(0,r.kt)("p",null,"Suppression de l'ancien paquet Centreon-HA :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum remove centreon-ha\n")),(0,r.kt)("p",null,"Mise \xe0 jour des paquets Centreon: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum update centreon\\*\n")),(0,r.kt)("p",null,"Installation des nouveaux paquets Centreon-HA :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-ha-web centreon-ha-common\n")),(0,r.kt)("p",null,"\xc9crasez l'ancien fichier ",(0,r.kt)("em",{parentName:"p"},"centreon_central_sync.pm")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /etc/centreon-ha/centreon_central_sync.pm.rpmsave /etc/centreon-ha/centreon_central_sync.pm\n")),(0,r.kt)("p",null,"Sur les serveurs de ",(0,r.kt)("strong",{parentName:"p"},"base de donn\xe9es")," :"),(0,r.kt)("p",null,"Suppression de l'ancien paquet Centreon-HA :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum remove centreon-ha\n")),(0,r.kt)("p",null,"Mise \xe0 jour des paquets Centreon: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum update centreon\\*\n")),(0,r.kt)("p",null,"Installation des nouveaux paquets Centreon-HA :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-ha-common\n")),(0,r.kt)("p",null,"\xc9crasez l'ancien fichier ",(0,r.kt)("em",{parentName:"p"},"mysql-resources.sh"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /etc/centreon-ha/mysql-resources.sh.rpmsave /etc/centreon-ha/mysql-resources.sh\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Acceptez les nouvelles cl\xe9s GPG des d\xe9p\xf4ts si n\xe9cessaire.")),(0,r.kt)("p",null,"Le fuseau horaire par d\xe9faut de PHP 8 doit \xeatre configur\xe9. Executez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo "date.timezone = Europe/Paris" >> /etc/php.d/50-centreon.ini\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Remplacez ",(0,r.kt)("strong",{parentName:"p"},"Europe/Paris")," par votre fuseau horaire. La liste des fuseaux\nhoraires est disponible ",(0,r.kt)("a",{parentName:"p",href:"http://php.net/manual/en/timezones.php"},"ici"),".")),(0,r.kt)("p",null,"Cette section s'applique uniquement si vous avez personnalis\xe9 votre configuration Apache. Lors de la mont\xe9e de version, le fichier de configuration Apache n'est pas mis \xe0 jour automatiquement : le nouveau fichier de configuration amen\xe9 par le rpm ne remplace pas l'ancien. Vous devez reporter les changements manuellement dans votre fichier de configuration personnalis\xe9e."),(0,r.kt)("p",null,"Faites un diff entre l'ancien et le nouveau fichier de configuration Apache :"),(0,r.kt)("p",null,"On the Central Servers:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"diff -u /opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf /opt/rh/httpd24/root/etc/httpd/conf.d/10-centreon.conf.rpmnew\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf")," (post mont\xe9e de version) : ce fichier contient la configuration personnalis\xe9e. Il ne contient pas les nouveaut\xe9s apport\xe9es par la version 21.10, par exemple la cha\xeene ",(0,r.kt)("strong",{parentName:"li"},"authentication")," dans la directive ",(0,r.kt)("strong",{parentName:"li"},"LocationMatch")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf.rpmnew")," (post mont\xe9e de version) : ce fichier est fourni par le rpm; il contient la cha\xeene ",(0,r.kt)("strong",{parentName:"li"},"authentication"),", mais ne contient pas la configuration personnalis\xe9e.")),(0,r.kt)("p",null,"Pour chaque diff\xe9rence entre les fichiers, \xe9valuez si celle-ci doit \xeatre report\xe9e du fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf.rpmnew")," au fichier ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf"),"."),(0,r.kt)("p",null,"Avant de d\xe9marrer la mont\xe9e de version via l'interface web, lancez PHP 8 avec la commande suivante sur les deux Centraux :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl stop rh-php72-php-fpm\nsystemctl start php-fpm\n")),(0,r.kt)("p",null,"Puis rechargez Apache sur le noeud primaire :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl reload httpd24-httpd\n")),(0,r.kt)("h3",{id:"mont\xe9e-de-version-du-serveur-mariadb"},"Mont\xe9e de version du serveur MariaDB"),(0,r.kt)("p",null,"Les composants MariaDB peuvent maintenant \xeatre mis \xe0 jour."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"La mise \xe0 jour MariaDB doit d'abord \xeatre execut\xe9e sur le serveur primaire\npuis sur le serveur secondaire.\nDans le cas d'une HA 4 n\u0153euds, la mise \xe0 jour doit \xeatre fait uniquement sur\nles serveurs de base de donn\xe9es.")),(0,r.kt)("p",null,"Il est n\xe9cessaire de d\xe9sinstaller puis r\xe9installer MariaDB pour changer de version majeure (c'est-\xe0-dire pour passer d'une version 10.3 \xe0 une version 10.5)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Arr\xeatez le service mariadb :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mysqladmin -p shutdown \n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9sinstallez la version actuelle :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-compat MariaDB-common\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez la version 10.5 :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install MariaDB-server-10.5\\* MariaDB-client-10.5\\* MariaDB-shared-10.5\\* MariaDB-compat-10.5\\* MariaDB-common-10.5\\*\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\xc9crasez la configuration mariadbd:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /etc/my.cnf.d/server.cnf.rpmsave /etc/my.cnf.d/server.cnf\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9marrez le service mariadb :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl start mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Lancez le processus de mise \xe0 jour MariaDB :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"}," mysql_upgrade -u <utilisateur_admin_bdd> -p\n")),(0,r.kt)("p",{parentName:"li"}," Exemple : si votre utilisateur_admin_bdd est ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", entrez:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"mysql_upgrade -u root -p\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"R\xe9f\xe9rez vous \xe0 la ",(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/mysql_upgrade/"},"documentation officielle"),"\npour plus d'informations ou si des erreurs apparaissent pendant cette derni\xe8re \xe9tape.")))),(0,r.kt)("h4",{id:"activer-mariadb-au-d\xe9marrage-automatique"},"Activer MariaDB au d\xe9marrage automatique"),(0,r.kt)("p",null,"Ex\xe9cutez la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl enable mariadb\n")),(0,r.kt)("p",null,"Ensuite, pour effectuer la mise \xe0 jour de l'interface Web, veuillez ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2607/fr/docs/22.10/upgrade/upgrade-from-21-10#finalizing-the-upgrade"},"suivre la documentation officielle")," Uniquement sur le ",(0,r.kt)("strong",{parentName:"p"},"n\u0153ud Central Actif"),"."),(0,r.kt)("p",null,'Sur le n\u0153ud central passif, d\xe9placez le r\xe9pertoire "install" pour \xe9viter d\'obtenir l\'\xe9cran "upgrade" dans le WUI en cas de nouvel \xe9change de r\xf4les.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /usr/share/centreon/www/install /var/lib/centreon/installs/install-update-YYYY-MM-DD\nsudo -u apache /usr/share/centreon/bin/console cache:clear\n")),(0,r.kt)("h3",{id:"suppression-des-crons"},"Suppression des crons"),(0,r.kt)("p",null,"Les crons sont remis en place lors de la mise \xe0 jour des RPMs. Supprimer les sur les deux n\u0153uds centraux afin d'\xe9viter les executions concurrentes."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rm -rf /etc/cron.d/centreon\nrm -rf /etc/cron.d/centstorage\nrm -f /etc/cron.d/centreon-ha-mysql\n")),(0,r.kt)("p",null,"Le cron ",(0,r.kt)("strong",{parentName:"p"},"centreon-ha-mysql")," \xe9tant supprim\xe9, v\xe9rifiez que vous avez bien la ligne suivante dans la section ",(0,r.kt)("strong",{parentName:"p"},"server")," du fichier ",(0,r.kt)("strong",{parentName:"p"},"/etc/my.cnf.d/server.cnf")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"expire_logs_days=7\n")),(0,r.kt)("p",null,"Si ce n'est pas le cas, ajoutez-la et red\xe9marrez la ressource ",(0,r.kt)("strong",{parentName:"p"},"ms_mysql")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pcs resource restart ms_mysql\n")),(0,r.kt)("h3",{id:"changez-les-permissions-pour-la-resource-centreon_central_sync"},"Changez les permissions pour la resource centreon_central_sync"),(0,r.kt)("p",null,"La mise \xe0 jour des RPMs \xe0 modifi\xe9 les permissions sur certains fichiers synchronis\xe9s par ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("em",{parentName:"em"},"centreon_central_sync")),". Il est n\xe9cesssaire de les modifier :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'chmod 775 /var/log/centreon-engine/\nmkdir /var/log/centreon-engine/archives\nchown centreon-engine: /var/log/centreon-engine/archives\nchmod 775 /var/log/centreon-engine/archives/\nfind /var/log/centreon-engine/ -type f -exec chmod 664 {} \\;\nfind /usr/share/centreon/www/img/media -type d -exec chmod 775 {} \\;\nfind /usr/share/centreon/www/img/media -type f \\( ! -iname ".keep" ! -iname ".htaccess" \\) -exec chmod 664 {} \\;\n')),(0,r.kt)("h2",{id:"ugprade-du-cluster"},"Ugprade du cluster"),(0,r.kt)("p",null,"Depuis Centreon 22.04, la r\xe9plication de MariaDB est maintenant bas\xe9e sur ",(0,r.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/gtid/"},"GTID"),".\nIl est n\xe9cessaire de d\xe9truire compl\xe8tement le cluster et de le configurer \xe0 nouveau avec\nla derni\xe8re version de Centreon et les m\xe9canismes de r\xe9plication de MariaDB GTID."),(0,r.kt)("h3",{id:"mode-maintenance-et-sauvegarde"},"Mode maintenance et sauvegarde"),(0,r.kt)("p",null,"R\xe9aliser une sauvegarde du cluster en utilisant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs config backup centreon_cluster\npcs config export pcs-commands | sed -e :a -e '/\\\\$/N; s/\\\\\\n//; ta' | sed 's/-f tmp-cib.xml//' | egrep \"create|group\" | egrep -v \"(mysql|php|cbd_rrd)\" > centreon_pcs_command.sh\n")),(0,r.kt)("p",null,"V\xe9rifiez que le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon_cluster.tar.bz2")," existe avant de continuer cette proc\xe9dure."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ls -l centreon_cluster.tar.bz2\n")),(0,r.kt)("p",null,"Vous devriez obtenir un r\xe9sultat comme celui-ci :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"-rw------- 1 root root 2777 May  3 17:49 centreon_cluster.tar.bz2\n")),(0,r.kt)("p",null,"V\xe9rifiez ensuite le fichier centreon_pcs_command.sh, la commande d'exportation peut afficher quelques lignes d'avertissement mais elle n'est pas bloquante."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat centreon_pcs_command.sh\n")),(0,r.kt)("p",null,"Le contenu doit ressembler \xe0 ceci :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"pcs resource create vip ocf:heartbeat:IPaddr2 broadcast=@VIP_BROADCAST_IPADDR@ cidr_netmask=@VIP_CIDR_NETMASK@ flush_routes=true ip=@VIP_IPADDR@ nic=@VIP_IFNAME@ op monitor interval=10s timeout=20s start interval=0s timeout=20s stop interval=0s timeout=20s meta target-role=started\npcs resource create http systemd:httpd24-httpd op monitor interval=5s timeout=20s start interval=0s timeout=40s stop interval=0s timeout=40s meta target-role=started\npcs resource create gorgone systemd:gorgoned op monitor interval=5s timeout=20s start interval=0s timeout=90s stop interval=0s timeout=90s meta target-role=started\npcs resource create centreon_central_sync systemd:centreon-central-sync op monitor interval=5s timeout=20s start interval=0s timeout=90s stop interval=0s timeout=90s meta target-role=started\npcs resource create cbd_central_broker systemd:cbd-sql op monitor interval=5s timeout=30s start interval=0s timeout=90s stop interval=0s timeout=90s meta target-role=started\npcs resource create centengine systemd:centengine op monitor interval=5s timeout=30s start interval=0s timeout=90s stop interval=0s timeout=90s meta multiple-active=stop_start target-role=started\npcs resource create centreontrapd systemd:centreontrapd op monitor interval=5s timeout=20s start interval=0s timeout=30s stop interval=0s timeout=30s meta target-role=started\npcs resource create snmptrapd systemd:snmptrapd op monitor interval=5s timeout=20s start interval=0s timeout=30s stop interval=0s timeout=30s meta target-role=started\npcs resource group add centreon vip http gorgone centreon_central_sync cbd_central_broker centengine centreontrapd snmptrapd\n")),(0,r.kt)("p",null,"Ce fichier sera n\xe9cessaire pour recr\xe9er toutes les ressources de votre cluster."),(0,r.kt)("h3",{id:"supprimer-les-ressources"},"Supprimer les ressources"),(0,r.kt)("p",null,"Ces commandes ne doivent \xeatre ex\xe9cut\xe9es que sur le n\u0153ud central actif :"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"HA 2 Nodes",label:"HA 2 Nodes",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource delete ms_mysql --force\npcs resource delete cbd_rrd --force\npcs resource delete php7 --force\npcs resource delete centreon --force\n"))),(0,r.kt)(s.Z,{value:"HA 4 Nodes",label:"HA 4 Nodes",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource delete ms_mysql --force\npcs resource delete vip_mysql --force\npcs resource delete cbd_rrd --force\npcs resource delete php7 --force\npcs resource delete centreon --force\n")))),(0,r.kt)("h3",{id:"reconfigurer-mariadb"},"Reconfigurer MariaDB"),(0,r.kt)("p",null,"Il est n\xe9cessaire de modifier la configuration de mysql en \xe9ditant ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf.d/server.cnf")," :"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Sur les 2 serveurs centraux dans une HA 2 n\u0153uds\nSur les 2 serveurs de base de donn\xe9es dans une HA 4 noeuds.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[server]\n...\nskip-slave-start\nlog-slave-updates\ngtid_strict_mode=ON\nexpire_logs_days=7\nignore-db-dir=lost+found\n...\n")),(0,r.kt)("h3",{id:"lancer-la-r\xe9plication-gtid"},"Lancer la r\xe9plication GTID"),(0,r.kt)("p",null,"Ex\xe9cutez cette commande ",(0,r.kt)("strong",{parentName:"p"},"sur le n\u0153ud de base de donn\xe9es secondaire:"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mysqladmin -p shutdown\n")),(0,r.kt)("p",null,"Il est important de s'assurer que MariaDB est compl\xe8tement arr\xeat\xe9. Vous allez ex\xe9cuter cette commande et v\xe9rifier qu'elle ne renvoie aucun r\xe9sultat :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ps -ef | grep mariadb[d]\n")),(0,r.kt)("p",null,"Une fois le service arr\xeat\xe9 ",(0,r.kt)("strong",{parentName:"p"},"sur le n\u0153ud de base de donn\xe9es secondaire"),", vous allez ex\xe9cuter le script de synchronisation ",(0,r.kt)("strong",{parentName:"p"},"depuis le n\u0153ud de base de donn\xe9es primaire")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-sync-bigdb.sh\n")),(0,r.kt)("p",null,"La sortie de ce script est tr\xe8s verbeuse et vous ne pouvez pas vous attendre \xe0 tout comprendre, donc pour vous assurer que tout s'est bien pass\xe9, concentrez-vous sur les derni\xe8res\nlignes de la sortie, en v\xe9rifiant qu'elle ressemble \xe0 ceci :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'Umount and Delete LVM snapshot\n  Logical volume "dbbackupdatadir" successfully removed\nStart MySQL Slave\nStart Replication\nId  User    Host    db  Command Time    State   Info    Progress\n[variable number of lines]\n')),(0,r.kt)("p",null,"La chose importante \xe0 v\xe9rifier est que ",(0,r.kt)("inlineCode",{parentName:"p"},"Start MySQL Slave")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"Start Replication")," sont pr\xe9sents et qu'aucune erreur ne les suit."),(0,r.kt)("p",null,"De plus, la sortie de cette commande ne doit afficher que des r\xe9sultats ",(0,r.kt)("inlineCode",{parentName:"p"},"OK")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,r.kt)("p",null,"La sortie attendue est :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Connection Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,r.kt)("h3",{id:"recr\xe9er-les-ressources-du-cluster"},"Recr\xe9er les ressources du cluster"),(0,r.kt)("p",null,"\xc0 ex\xe9cuter ",(0,r.kt)("strong",{parentName:"p"},"seulement sur un n\u0153ud central")," :"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"WARNING:")," la syntaxe de la commande suivante d\xe9pend de la distribution Linux que vous utilisez.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Vous pouvez trouver les variables @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ @MARIADB_REPL_USER@\n@MARIADB_REPL_USER@ dans ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-ha/mysql-resources.sh"),".")),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 7",label:"RHEL 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource create "ms_mysql" \\\n    ocf:heartbeat:mariadb-centreon \\\n    config="/etc/my.cnf.d/server.cnf" \\\n    pid="/var/lib/mysql/mysql.pid" \\\n    datadir="/var/lib/mysql" \\\n    socket="/var/lib/mysql/mysql.sock" \\\n    binary="/usr/bin/mysqld_safe" \\\n    node_list="@CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@" \\\n    replication_user="@MARIADB_REPL_USER@" \\\n    replication_passwd=\'@MARIADB_REPL_PASSWD@\' \\\n    test_user="@MARIADB_REPL_USER@" \\\n    test_passwd="@MARIADB_REPL_PASSWD@" \\\n    test_table=\'centreon.host\'\n'))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource create "ms_mysql" \\\n    ocf:heartbeat:mariadb-centreon \\\n    config="/etc/my.cnf.d/server.cnf" \\\n    pid="/var/lib/mysql/mysql.pid" \\\n    datadir="/var/lib/mysql" \\\n    socket="/var/lib/mysql/mysql.sock" \\\n    binary="/usr/bin/mysqld_safe" \\\n    node_list="@CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@" \\\n    replication_user="@MARIADB_REPL_USER@" \\\n    replication_passwd=\'@MARIADB_REPL_PASSWD@\' \\\n    test_user="@MARIADB_REPL_USER@" \\\n    test_passwd="@MARIADB_REPL_PASSWD@" \\\n    test_table=\'centreon.host\' \\\n    master\n')))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"WARNING:")," la syntaxe de la commande suivante d\xe9pend de la distribution Linux que vous utilisez.")),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"HA 2 Nodes",label:"HA 2 Nodes",mdxType:"TabItem"},(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 7",label:"RHEL 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource master ms_mysql \\\n    master-node-max="1" \\\n    clone_max="2" \\\n    globally-unique="false" \\\n    clone-node-max="1" \\\n    notify="true"\n'))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource meta ms_mysql-master \\\n    master-node-max="1" \\\n    clone_max="2" \\\n    globally-unique="false" \\\n    clone-node-max="1" \\\n    notify="true"\n'))))),(0,r.kt)(s.Z,{value:"HA 4 Nodes",label:"HA 4 Nodes",mdxType:"TabItem"},(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"RHEL 7",label:"RHEL 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource master ms_mysql \\\n    master-node-max="1" \\\n    clone_max="2" \\\n    globally-unique="false" \\\n    clone-node-max="1" \\\n    notify="true"\n')),(0,r.kt)("p",null,"Adresse VIP des serveurs de bases de donn\xe9es"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource create vip_mysql \\\n    ocf:heartbeat:IPaddr2 \\\n    ip="@VIP_SQL_IPADDR@" \\\n    nic="@VIP_SQL_IFNAME@" \\\n    cidr_netmask="@VIP_SQL_CIDR_NETMASK@" \\\n    broadcast="@VIP_SQL_BROADCAST_IPADDR@" \\\n    flush_routes="true" \\\n    meta target-role="stopped" \\\n    op start interval="0s" timeout="20s" \\\n    stop interval="0s" timeout="20s" \\\n    monitor interval="10s" timeout="20s"\n'))),(0,r.kt)(s.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource meta ms_mysql-master \\\n    master-node-max="1" \\\n    clone_max="2" \\\n    globally-unique="false" \\\n    clone-node-max="1" \\\n    notify="true"\n')),(0,r.kt)("p",null,"Adresse VIP des serveurs de bases de donn\xe9es"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource create vip_mysql \\\n    ocf:heartbeat:IPaddr2 \\\n    ip="@VIP_SQL_IPADDR@" \\\n    nic="@VIP_SQL_IFNAME@" \\\n    cidr_netmask="@VIP_SQL_CIDR_NETMASK@" \\\n    broadcast="@VIP_SQL_BROADCAST_IPADDR@" \\\n    flush_routes="true" \\\n    meta target-role="stopped" \\\n    op start interval="0s" timeout="20s" \\\n    stop interval="0s" timeout="20s" \\\n    monitor interval="10s" timeout="20s"\n')))))),(0,r.kt)("h4",{id:"ressource-php"},"Ressource PHP"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource create "php" \\\n    systemd:php-fpm \\\n    meta target-role="started" \\\n    op start interval="0s" timeout="30s" \\\n    stop interval="0s" timeout="30s" \\\n    monitor interval="5s" timeout="30s" \\\n    clone\n')),(0,r.kt)("h4",{id:"ressource-rrd-broker"},"Ressource RRD broker"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs resource create "cbd_rrd" \\\n    systemd:cbd \\\n    meta target-role="started" \\\n    op start interval="0s" timeout="90s" \\\n    stop interval="0s" timeout="90s" \\\n    monitor interval="20s" timeout="30s" \\\n    clone\n')),(0,r.kt)("h4",{id:"recr\xe9er-le-groupe-de-ressources-centreon"},"Recr\xe9er le groupe de ressources ",(0,r.kt)("em",{parentName:"h4"},"centreon")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bash centreon_pcs_command.sh\n")),(0,r.kt)("h4",{id:"recr\xe9er-les-contraintes"},"Recr\xe9er les contraintes"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"HA 2 nodes",label:"HA 2 nodes",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs constraint colocation add master "ms_mysql-master" with "centreon"\npcs constraint order stop centreon then demote ms_mysql-master\n'))),(0,r.kt)(s.Z,{value:"HA 4 nodes",label:"HA 4 nodes",mdxType:"TabItem"},"Afin de fixer le r\xf4le de la base de donn\xe9es primaire avec l'IP virtuelle, d\xe9finissez une contrainte mutuelle :",(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'pcs constraint colocation add "vip_mysql" with master "ms_mysql-master"\npcs constraint colocation add master "ms_mysql-master" with "vip_mysql"\n')),(0,r.kt)("p",null,"Recr\xe9ez ensuite les contraintes qui emp\xeachent les processus Centreon de s'ex\xe9cuter sur les n\u0153uds de base de donn\xe9es et vice-versa :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint location centreon avoids @DATABASE_MASTER_NAME@=INFINITY @DATABASE_SLAVE_NAME@=INFINITY\npcs constraint location ms_mysql-clone avoids @CENTRAL_MASTER_NAME@=INFINITY @CENTRAL_SLAVE_NAME@=INFINITY\npcs constraint location cbd_rrd-clone avoids @DATABASE_MASTER_NAME@=INFINITY @DATABASE_SLAVE_NAME@=INFINITY\npcs constraint location php-clone avoids @DATABASE_MASTER_NAME@=INFINITY @DATABASE_SLAVE_NAME@=INFINITY\n")))),(0,r.kt)("h2",{id:"reprise-de-la-gestion-des-ressources-du-cluster"},"Reprise de la gestion des ressources du cluster"),(0,r.kt)("p",null,"Maintenant que la mise \xe0 jour est termin\xe9e, les ressources peuvent \xeatre g\xe9r\xe9es \xe0 nouveau :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs property set maintenance-mode=false\npcs resource cleanup ms_mysql\n")),(0,r.kt)("h2",{id:"v\xe9rifier-la-sant\xe9-du-cluster"},"V\xe9rifier la sant\xe9 du cluster"),(0,r.kt)("p",null,"Vous pouvez surveiller les ressources du cluster en temps r\xe9el en utilisant la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," :"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"INFO:"),"L'option ",(0,r.kt)("inlineCode",{parentName:"p"},"-fr")," vous permet d'afficher toutes les resources m\xeame si elles sont disable.")),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"HA 2 Nodes",label:"HA 2 Nodes",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_SLAVE_NAME@ (version 1.1.20-5.el7_7.2-3c4c782f70) - partition with quorum\nLast updated: Thu Feb 20 13:14:17 2020\nLast change: Thu Feb 20 09:25:54 2020 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resources configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @CENTRAL_MASTER_NAME@ ]\n     Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):   Started @CENTRAL_MASTER_NAME@\n     http   (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync  (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     centreontrapd  (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):  Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n"))),(0,r.kt)(s.Z,{value:"HA 4 Nodes",label:"HA 4 Nodes",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[...]\n4 nodes configured\n21 resources configured\n\nOnline: [@CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nvip_mysql       (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n")))),(0,r.kt)("h3",{id:"ressources-d\xe9sactiv\xe9es"},"Ressources d\xe9sactiv\xe9es"),(0,r.kt)("p",null,"Lorsque vous faite une ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," et que vous une ressource qui est ",(0,r.kt)("em",{parentName:"p"},"disable")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"...\n Master/Slave Set: ms_mysql-master [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nvip_mysql       (ocf::heartbeat:IPaddr2):       Stopped (disabled)\n...\n")),(0,r.kt)("p",null,"Vous devez faire enable la ressource avec la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource enable @RESSOURCE_NAME@\n")),(0,r.kt)("p",null,"Dans notre cas :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource enable vip_mysql\n")),(0,r.kt)("h2",{id:"v\xe9rification-de-la-stabilit\xe9-de-la-plate-forme"},"V\xe9rification de la stabilit\xe9 de la plate-forme"),(0,r.kt)("p",null,"Vous devez maintenant v\xe9rifier que tout fonctionne bien :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Acc\xe8s aux menus de l'interface utilisateur web."),(0,r.kt)("li",{parentName:"ul"},"G\xe9n\xe9ration de la configuration des pollers + m\xe9thode de rechargement et de red\xe9marrage."),(0,r.kt)("li",{parentName:"ul"},"Planification des contr\xf4les imm\xe9diats (Central + Pollers), des accus\xe9s de r\xe9ception, des temps d'arr\xeat, etc."),(0,r.kt)("li",{parentName:"ul"},"D\xe9placer des ressources ou red\xe9marrer le serveur actif et v\xe9rifier \xe0 nouveau que tout va bien.")))}v.isMDXComponent=!0}}]);