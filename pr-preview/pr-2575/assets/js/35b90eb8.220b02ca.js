"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[49697],{603905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var r=n(667294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=o,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||a;return n?r.createElement(g,i(i({ref:t},p),{},{components:n})):r.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},623378:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>g,frontMatter:()=>l,metadata:()=>c,toc:()=>u});n(667294);var r=n(603905);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const l={id:"update-centreon-ha",title:"Updating Centreon-HA platform"},s=void 0,c={unversionedId:"update/update-centreon-ha",id:"version-21.10/update/update-centreon-ha",title:"Updating Centreon-HA platform",description:"This procedure is intended to be used to perform minor updates of Centreon, when the Engine/Broker compatibility is assured between the old and the new version. No service downtime is necessary in this case, only a short outage of the Web UI login screen.",source:"@site/versioned_docs/version-21.10/update/update-centreon-ha.md",sourceDirName:"update",slug:"/update/update-centreon-ha",permalink:"/centreon-documentation/pr-preview/pr-2575/docs/21.10/update/update-centreon-ha",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-21.10/update/update-centreon-ha.md",tags:[],version:"21.10",lastUpdatedAt:1693498438,formattedLastUpdatedAt:"Aug 31, 2023",frontMatter:{id:"update-centreon-ha",title:"Updating Centreon-HA platform"},sidebar:"version-21.10/docs",previous:{title:"Update a Centreon 21.10 platform",permalink:"/centreon-documentation/pr-preview/pr-2575/docs/21.10/update/update-centreon-platform"},next:{title:"Introduction to upgrade",permalink:"/centreon-documentation/pr-preview/pr-2575/docs/21.10/upgrade/introduction"}},p={},u=[{value:"Suspend cluster resources management",id:"suspend-cluster-resources-management",level:2},{value:"Update process from the WUI",id:"update-process-from-the-wui",level:2},{value:"Centreon-Web update",id:"centreon-web-update",level:3},{value:"Removing cron jobs",id:"removing-cron-jobs",level:3},{value:"Updating Centreon extensions",id:"updating-centreon-extensions",level:3},{value:"Updating the Plugin Packs",id:"updating-the-plugin-packs",level:3},{value:"Updating the pollers",id:"updating-the-pollers",level:3},{value:"Exporting Engine/Broker configuration",id:"exporting-enginebroker-configuration",level:3},{value:"Resuming the cluster resources management",id:"resuming-the-cluster-resources-management",level:2},{value:"Verifying the platform stability",id:"verifying-the-platform-stability",level:2}],d={toc:u},m="wrapper";function g(e){var{components:t}=e,n=i(e,["components"]);return(0,r.kt)(m,a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({},d,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This procedure is intended to be used to perform minor updates of Centreon, when the Engine/Broker compatibility is assured between the old and the new version. No service downtime is necessary in this case, only a short outage of the Web UI login screen."),(0,r.kt)("h2",{id:"suspend-cluster-resources-management"},"Suspend cluster resources management"),(0,r.kt)("p",null,"In order to avoid a failover of the cluster during the update, it is necessary to unmanage all Centreon resources, as well as MariaDB."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource unmanage centreon\npcs resource unmanage ms_mysql\n")),(0,r.kt)("h2",{id:"update-process-from-the-wui"},"Update process from the WUI"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Please, make sure all users logged out from the Centreon web interface\nbefore starting the upgrade procedure.")),(0,r.kt)("h3",{id:"centreon-web-update"},"Centreon-Web update"),(0,r.kt)("p",null,"Update your cluster by running the following command on each node:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum update\n")),(0,r.kt)("p",null,"And then you should be able to finalize the update ",(0,r.kt)("em",{parentName:"p"},"via")," the web UI. You might have to log off your session or to refresh the login page to access the update process."),(0,r.kt)("p",null,'On the slave central node, just move the "install" dir to avoid getting the "update" screen in the WUI in the event of a further exchange of roles.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv /usr/share/centreon/www/install /var/lib/centreon/installs/install-update-YYYY-MM-DD\nsudo -u apache /usr/share/centreon/bin/console cache:clear\n")),(0,r.kt)("h3",{id:"removing-cron-jobs"},"Removing cron jobs"),(0,r.kt)("p",null,"The RPM upgrade puts cron job back in place. Remove them to avoid concurrent executions: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rm /etc/cron.d/centreon\nrm /etc/cron.d/centstorage\nrm /etc/cron.d/centreon-auto-disco\n")),(0,r.kt)("h3",{id:"updating-centreon-extensions"},"Updating Centreon extensions"),(0,r.kt)("p",null,"The Centreon extensions are also to be updated ",(0,r.kt)("em",{parentName:"p"},"via"),' the WUI, from the "Administration > Extensions > Manager" menu by clicking the "Update all" button.'),(0,r.kt)("h3",{id:"updating-the-plugin-packs"},"Updating the Plugin Packs"),(0,r.kt)("p",null,"In order to maintain compatibility between the ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2575/docs/21.10/monitoring/pluginpacks"},"Plugin Packs")," and the installed plugins (that have just been updated by the ",(0,r.kt)("inlineCode",{parentName:"p"},"yum update"),' command on the central server), the plugin packs must be updated in the WUI too from the "Configuration > Plugin Packs" menu.'),(0,r.kt)("h3",{id:"updating-the-pollers"},"Updating the pollers"),(0,r.kt)("p",null,"It is recommended to update the pollers as well, ",(0,r.kt)("strong",{parentName:"p"},"especially if ",(0,r.kt)("inlineCode",{parentName:"strong"},"centreon-engine")," and/or ",(0,r.kt)("inlineCode",{parentName:"strong"},"centreon-broker")," packages have been updated"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum update\n")),(0,r.kt)("h3",{id:"exporting-enginebroker-configuration"},"Exporting Engine/Broker configuration"),(0,r.kt)("p",null,'Generate and export new Engine/Broker configuration files for all pollers (central included) in "Configuration -> Pollers" with these options checked:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate Configuration Files"),(0,r.kt)("li",{parentName:"ul"},"Run monitoring engine debug (-v)"),(0,r.kt)("li",{parentName:"ul"},"Move Export Files")),(0,r.kt)("p",null,"Then restart them ",(0,r.kt)("strong",{parentName:"p"},"one at a time")," from the same menu and make sure to select the ",(0,r.kt)("strong",{parentName:"p"},'"restart" method, not "reload"'),", if the ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-engine")," and/or ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-broker")," packages have been updated."),(0,r.kt)("p",null,"In addition, the ",(0,r.kt)("inlineCode",{parentName:"p"},"cbd-sql")," service must be restarted ",(0,r.kt)("strong",{parentName:"p"},"on the central master server"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"service cbd-sql restart\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cbd")," service must also be restarted on ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2575/docs/21.10/installation/architectures#description"},"Centreon Remote Servers")," as well:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"service cbd restart\n")),(0,r.kt)("p",null,"At this point everything should be working properly."),(0,r.kt)("h2",{id:"resuming-the-cluster-resources-management"},"Resuming the cluster resources management"),(0,r.kt)("p",null,"Now that the update is finished, the resources can be managed again:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource manage centreon\npcs resource manage ms_mysql\n")),(0,r.kt)("h2",{id:"verifying-the-platform-stability"},"Verifying the platform stability"),(0,r.kt)("p",null,"You should now check that eveything works fine:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Access to the web UI menus."),(0,r.kt)("li",{parentName:"ul"},"Poller configuration generation + reload and restart method."),(0,r.kt)("li",{parentName:"ul"},"Schedule immediate check (Central + Pollers) and acknowledge, downtime etc."),(0,r.kt)("li",{parentName:"ul"},"Move resources or reboot master server and check again that everything is fine.")))}g.isMDXComponent=!0}}]);