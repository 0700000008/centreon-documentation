"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[18323],{275665:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/files/Centreon-MBI-QuickGuide-Storage-Sizing_EN-45d0eeb05362efed69cc1cad7e374c7b.xlsx"},413025:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/files/centreon-d5c18b09b64e5c125d1858bb06131311.cnf"},51219:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/files/view_creation-948c02cd93f8867179ec47fd611426bd.sql"},478835:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>p,default:()=>N,frontMatter:()=>u,metadata:()=>d,toc:()=>c});n(667294);var r=n(603905),a=n(451715),l=n(907626);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const u={id:"installation",title:"Installation de Centreon MBI"},p=void 0,d={unversionedId:"reporting/installation",id:"version-21.10/reporting/installation",title:"Installation de Centreon MBI",description:"Architecture",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-21.10/reporting/installation.md",sourceDirName:"reporting",slug:"/reporting/installation",permalink:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/reporting/installation",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-21.10/reporting/installation.md",tags:[],version:"21.10",lastUpdatedAt:1693482550,formattedLastUpdatedAt:"31 ao\xfbt 2023",frontMatter:{id:"installation",title:"Installation de Centreon MBI"},sidebar:"version-21.10/docs",previous:{title:"D\xe9v. de rapport",permalink:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/reporting/report-development"},next:{title:"Mise \xe0 jour de l'extension",permalink:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/reporting/update"}},m={},c=[{value:"Architecture",id:"architecture",level:2},{value:"Un serveur de reporting d\xe9di\xe9",id:"un-serveur-de-reporting-d\xe9di\xe9",level:3},{value:"Tableaux des flux r\xe9seau",id:"tableaux-des-flux-r\xe9seau",level:3},{value:"Packages",id:"packages",level:3},{value:"Pr\xe9-requis",id:"pr\xe9-requis",level:2},{value:"Server Centreon central",id:"server-centreon-central",level:3},{value:"Serveur de reporting",id:"serveur-de-reporting",level:3},{value:"Installer l&#39;extension sur Centreon",id:"installer-lextension-sur-centreon",level:2},{value:"Activer l&#39;extension",id:"activer-lextension",level:3},{value:"Configurer l&#39;extension",id:"configurer-lextension",level:3},{value:"Acc\xe8s \xe0 la base de donn\xe9es Centrale",id:"acc\xe8s-\xe0-la-base-de-donn\xe9es-centrale",level:3},{value:"Cas #1 : La base MariaDB de monitoring est h\xe9b\xe8rg\xe9e sur le m\xeame serveur que le serveur Central Centreon",id:"cas-1--la-base-mariadb-de-monitoring-est-h\xe9b\xe8rg\xe9e-sur-le-m\xeame-serveur-que-le-serveur-central-centreon",level:4},{value:"Cas2 # La base MariaDB de monitoring est h\xe9berg\xe9e sur un serveur d\xe9di\xe9",id:"cas2--la-base-mariadb-de-monitoring-est-h\xe9berg\xe9e-sur-un-serveur-d\xe9di\xe9",level:4},{value:"Donner des droits \xe0 l&#39;utilisateur cbis",id:"donner-des-droits-\xe0-lutilisateur-cbis",level:3},{value:"Installer le serveur de reporting",id:"installer-le-serveur-de-reporting",level:2},{value:"Installer les paquets",id:"installer-les-paquets",level:3},{value:"Proc\xe9dure",id:"proc\xe9dure",level:4},{value:"Configurer le serveur de reporting",id:"configurer-le-serveur-de-reporting",level:3},{value:"Optimisations MariaDB",id:"optimisations-mariadb",level:4},{value:"Installer la configuration",id:"installer-la-configuration",level:4},{value:"ETL : Configuration",id:"etl--configuration",level:3},{value:"ETL: R\xe9tention de donn\xe9es",id:"etl-r\xe9tention-de-donn\xe9es",level:3},{value:"ETL : Execution",id:"etl--execution",level:3},{value:"Reconstruire les statistiques en utilisant les donn\xe9es historiques",id:"reconstruire-les-statistiques-en-utilisant-les-donn\xe9es-historiques",level:4},{value:"Activer l&#39;ex\xe9cution journali\xe8re",id:"activer-lex\xe9cution-journali\xe8re",level:4}],k={toc:c},g="wrapper";function N(e){var{components:t}=e,u=o(e,["components"]);return(0,r.kt)(g,s(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({},k,u),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"architecture"},"Architecture"),(0,r.kt)("p",null,"Ce chapitre pr\xe9sente l'architecture logicielle de l'extension ",(0,r.kt)("strong",{parentName:"p"},"Centreon MBI"),". Il\npermet d'acqu\xe9rir une compr\xe9hension de son int\xe9gration \xe0 la plateforme Centreon."),(0,r.kt)("p",null,"Ce document s'adresse aux administrateurs qui vont installer ou configurer Centreon MBI."),(0,r.kt)("p",null,"Dans ce chapitre, vous trouverez\xa0:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"le diagramme d'architecture logicielle"),(0,r.kt)("li",{parentName:"ul"},"le diagramme d'architecture des RPMs")),(0,r.kt)("h3",{id:"un-serveur-de-reporting-d\xe9di\xe9"},"Un serveur de reporting d\xe9di\xe9"),(0,r.kt)("p",null,"Cette architecture et les pr\xe9-requis pr\xe9sent\xe9s sont valables pour les\nenvironnements suivant:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"tests"),(0,r.kt)("li",{parentName:"ul"},"production"),(0,r.kt)("li",{parentName:"ul"},"pr\xe9-production")),(0,r.kt)("p",null,"Le sch\xe9ma ci-dessous met en avant les principaux composants de Centreon MBI :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(23356).Z,width:"580",height:"363"})),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"La base de monitoring n'est pas n\xe9cessairement sur le m\xeame serveur que le serveur Centreon")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ETL")," : M\xe9canisme d'extraction, calcul et chargement des donn\xe9es\ndans la base de donn\xe9es dedi\xe9e reporting."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"CBIS")," : Ordonnanceur g\xe9rant la g\xe9n\xe9ration et la publication\nautomatique des rapports."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reporting database")," : Base de donn\xe9es MariaDB contenant les donn\xe9es\nde reporting et certaines donn\xe9es extraites de la base de monitoring.")),(0,r.kt)("h3",{id:"tableaux-des-flux-r\xe9seau"},"Tableaux des flux r\xe9seau"),(0,r.kt)("p",null,"Dans le tableau ci-dessous, sont repr\xe9sent\xe9s les diff\xe9rents flux\npr\xe9sents entre le serveur de reporting d\xe9di\xe9, le serveur Centreon et les\nbases de donn\xe9es, par d\xe9faut."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Application")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Source")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Destination")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Port")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Protocol")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ETL/CBIS"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur de reporting"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur de bases de donn\xe9es Centreon"),(0,r.kt)("td",{parentName:"tr",align:null},"3306"),(0,r.kt)("td",{parentName:"tr",align:null},"TCP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SSH"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur de reporting"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur Centreon"),(0,r.kt)("td",{parentName:"tr",align:null},"22"),(0,r.kt)("td",{parentName:"tr",align:null},"TCP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CBIS"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur de reporting"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur Centreon"),(0,r.kt)("td",{parentName:"tr",align:null},"80"),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CBIS"),(0,r.kt)("td",{parentName:"tr",align:null},"Centreon"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur de reporting"),(0,r.kt)("td",{parentName:"tr",align:null},"1234"),(0,r.kt)("td",{parentName:"tr",align:null},"TCP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Widgets"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur central Centreon"),(0,r.kt)("td",{parentName:"tr",align:null},"Serveur de reporting"),(0,r.kt)("td",{parentName:"tr",align:null},"3306"),(0,r.kt)("td",{parentName:"tr",align:null},"TCP")))),(0,r.kt)("p",null,"*",(0,r.kt)("em",{parentName:"p"},"Uniquement n\xe9cessaire pour les rapports Host-Graph-v2 and Hostgroup-Graph-v2")),(0,r.kt)("h3",{id:"packages"},"Packages"),(0,r.kt)("p",null,"L'installation de Centreon MBI est bas\xe9e sur deux paquets RPM\xa0:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Centreon-bi-server\xa0:")," Ce paquet installe l'interface de Centreon MBI sur\nle frontend de Centreon. Ce paquet doit \xeatre install\xe9 sur le serveur web de\nCentreon."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Centreon-bi-reporting-server")," : Ce paquet contient tous les \xe9l\xe9ments\ncomposants le serveur reporting : moteur de g\xe9n\xe9ration de rapports, les\nrapports standards et l'ETL. Il doit \xeatre install\xe9 sur un serveur d\xe9di\xe9\naux processus de reporting.")),(0,r.kt)("p",null,"L'installation du moteur de base de donn\xe9es doit \xeatre faite en m\xeame\ntemps. Nous conseillons fortement d'installer la base MariaDB sur le\nserveur de reporting pour des questions de performances & d'isolation."),(0,r.kt)("h2",{id:"pr\xe9-requis"},"Pr\xe9-requis"),(0,r.kt)("h3",{id:"server-centreon-central"},"Server Centreon central"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Logiciels")),(0,r.kt)("p",null,"Voir les ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/installation/prerequisites#logiciels"},"pr\xe9requis logiciels"),"."),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Centreon Web 21.10"),(0,r.kt)("li",{parentName:"ul"},"V\xe9rifiez que ",(0,r.kt)("inlineCode",{parentName:"li"},"date.timezone")," est correctement configur\xe9e dans le fichier\n",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/php.d/php.ini")," (m\xeame que celui retourn\xe9 par la commande\n",(0,r.kt)("inlineCode",{parentName:"li"},"timedatectl status"),")"),(0,r.kt)("li",{parentName:"ul"},"Evitez l'utilisation des variables ci dessous dans le fichier de\nconfiguration MariaDB ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/my.cnf"),": Elles arr\xeatent l'ex\xe9cution des requ\xeates\nlongues et ceci pourrait arr\xeater l'ex\xe9cution des ETL ainsi que la g\xe9n\xe9ration\ndes rapports.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"wait_timeout"),(0,r.kt)("li",{parentName:"ul"},"interactive_timeout"))))),(0,r.kt)(l.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Centreon Web 21.10"),(0,r.kt)("li",{parentName:"ul"},"V\xe9rifiez que ",(0,r.kt)("inlineCode",{parentName:"li"},"date.timezone")," est correctement configur\xe9e dans le fichier\n",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/opt/rh/rh-php73/php.ini")," (m\xeame que celui retourn\xe9 par la commande\n",(0,r.kt)("inlineCode",{parentName:"li"},"timedatectl status"),")"),(0,r.kt)("li",{parentName:"ul"},"Evitez l'utilisation des variables ci dessous dans le fichier de\nconfiguration MariaDB ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/my.cnf"),": Elles arr\xeatent l'ex\xe9cution des requ\xeates\nlongues et ceci pourrait arr\xeater l'ex\xe9cution des ETL ainsi que la g\xe9n\xe9ration\ndes rapports.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"wait_timeout"),(0,r.kt)("li",{parentName:"ul"},"interactive_timeout")))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Ajout d'utilisateurs ou de groupes")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Utilisateur"),(0,r.kt)("th",{parentName:"tr",align:null},"Groupe"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"centreonBI (nouveau)"),(0,r.kt)("td",{parentName:"tr",align:null},"apache,centreon,centreonBI")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apache (existant)"),(0,r.kt)("td",{parentName:"tr",align:null},"centreonBI")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description des utilisateurs, umask et r\xe9pertoire utilisateur")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Utilisateur"),(0,r.kt)("th",{parentName:"tr",align:null},"umask"),(0,r.kt)("th",{parentName:"tr",align:null},"home"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"centreonBI"),(0,r.kt)("td",{parentName:"tr",align:null},"0002"),(0,r.kt)("td",{parentName:"tr",align:null},"/home/centreonBI")))),(0,r.kt)("h3",{id:"serveur-de-reporting"},"Serveur de reporting"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Mat\xe9riel")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nombre de services supervis\xe9s"),(0,r.kt)("th",{parentName:"tr",align:null},"CPU minimum"),(0,r.kt)("th",{parentName:"tr",align:null},"M\xe9moire Vive"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"< 4 000"),(0,r.kt)("td",{parentName:"tr",align:null},"2 CPU ( 3Ghz )"),(0,r.kt)("td",{parentName:"tr",align:null},"12Go minimum")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"< 20 000"),(0,r.kt)("td",{parentName:"tr",align:null},"4 CPU (3GHz) minimum"),(0,r.kt)("td",{parentName:"tr",align:null},"16 Go minimum")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},">= 20 000 and < 40 000"),(0,r.kt)("td",{parentName:"tr",align:null},"4 CPU (3GHz) minimum"),(0,r.kt)("td",{parentName:"tr",align:null},"24 Go minimum")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},">= 40 000 and < 100 000"),(0,r.kt)("td",{parentName:"tr",align:null},"8 CPU (3GHz) minimum"),(0,r.kt)("td",{parentName:"tr",align:null},"32 Go minimum")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"> 100 000"),(0,r.kt)("td",{parentName:"tr",align:null},"> Contacter Centreon"),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Espace disque")," : Utilisez ",(0,r.kt)("a",{target:"_blank",href:n(275665).Z},"le fichier suivant")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"File system")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"File system"),(0,r.kt)("th",{parentName:"tr",align:null},"Taille"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"/"),(0,r.kt)("td",{parentName:"tr",align:null},"5GB minimum")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"/var (containing MariaDB data)"),(0,r.kt)("td",{parentName:"tr",align:null},"utiliser le r\xe9sultat du fichier de simulation de l'espace disque ci-dessus")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Dossier temporaire de MariaDB"),(0,r.kt)("td",{parentName:"tr",align:null},"Fortement recommand\xe9 de le positionner dans /var")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Volume group*"),(0,r.kt)("td",{parentName:"tr",align:null},"5G minimum d'espace libre sur le ",(0,r.kt)("strong",{parentName:"td"},"Volume groupe")," h\xe9bergeant les ",(0,r.kt)("strong",{parentName:"td"},"donn\xe9es")," MariaDB.")))),(0,r.kt)("p",null,"Pour controler l'espace libre, utiliser la commande suivante en rempla\xe7ant\n",(0,r.kt)("strong",{parentName:"p"},"vg_data")," par le nom du volume groupe:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"vgdisplay vg_data | grep -i free*\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Logiciels")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"OS : CentOS / Redhat 7 ou 8"),(0,r.kt)("li",{parentName:"ul"},"SGBD : MariaDB 10.5"),(0,r.kt)("li",{parentName:"ul"},"Firewall : D\xe9sactiv\xe9"),(0,r.kt)("li",{parentName:"ul"},"SELinux : D\xe9sactiv\xe9")),(0,r.kt)("p",null,"Veillez \xe0 optimiser MariaDB sur votre serveur de reporting. Vous aurez besoin\nd'au moins 12GB de m\xe9moire vive afin d'utiliser le\n",(0,r.kt)("a",{target:"_blank",href:n(413025).Z},"fichier suivant"),".\nVeillez \xe0 cr\xe9er un dossier ",(0,r.kt)("inlineCode",{parentName:"p"},"tmp")," dans ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/lib/mysql/"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"N'utilisez pas ce fichier d'optimisation sur le serveur de supervision.")),(0,r.kt)("p",null,"Ajout d'utilisateurs ou de groupes :"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Utilisateur"),(0,r.kt)("th",{parentName:"tr",align:null},"Groupe"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"centreonBI"),(0,r.kt)("td",{parentName:"tr",align:null},"centreonBI")))),(0,r.kt)("p",null,"Description des utilisateurs, umask et r\xe9pertoire utilisateur :"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Utilisateur"),(0,r.kt)("th",{parentName:"tr",align:null},"umask"),(0,r.kt)("th",{parentName:"tr",align:null},"home"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"centreonBI"),(0,r.kt)("td",{parentName:"tr",align:null},"0002"),(0,r.kt)("td",{parentName:"tr",align:null},"/home/centreonBI")))),(0,r.kt)("h2",{id:"installer-lextension-sur-centreon"},"Installer l'extension sur Centreon"),(0,r.kt)("p",null,"Les actions list\xe9es dans ce chapitre doivent \xeatre lanc\xe9es sur le serveur de supervision Centreon."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez le d\xe9p\xf4t Business, vous pouvez le trouver sur le\n",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/fr/categories/10341239833105-D%C3%A9p%C3%B4ts"},"portail support"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Puis lancez la commande suivante :"))),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-bi-server\n"))),(0,r.kt)(l.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-bi-server\n")))),(0,r.kt)("h3",{id:"activer-lextension"},"Activer l'extension"),(0,r.kt)("p",null,"Le menu ",(0,r.kt)("em",{parentName:"p"},"Administration > Extensions > Manager")," de Centreon permet d'installer\nles diff\xe9rentes extensions d\xe9tect\xe9es. Une carte r\xe9f\xe9rence ",(0,r.kt)("strong",{parentName:"p"},"Centreon MBI"),'.\nCliquer sur le "+" pour installer l\'extension.'),(0,r.kt)("p",null,"Uploader via l'interface la license re\xe7ue correspondant \xe0 Centreon MBI."),(0,r.kt)("h3",{id:"configurer-lextension"},"Configurer l'extension"),(0,r.kt)("p",null,"Renseignez les valeurs suivantes dans les options g\xe9n\xe9rales de Centreon\nMBI, menu ",(0,r.kt)("em",{parentName:"p"},"Rapports > Monitoring Business Intelligence > Options G\xe9n\xe9rales")," :"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Tab"),(0,r.kt)("th",{parentName:"tr",align:null},"Option"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Options de  l'ordonnanceur"),(0,r.kt)("td",{parentName:"tr",align:null},"H\xf4te de CBIS"),(0,r.kt)("td",{parentName:"tr",align:null},"Adresse IP du serveur de reporting")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Options de l'ETL Une base de donn\xe9es MariaDB d\xe9di\xe9e au reporting a \xe9t\xe9  mise en place."),(0,r.kt)("td",{parentName:"tr",align:null},"Oui"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Widgets de reporting*"),(0,r.kt)("td",{parentName:"tr",align:null},"Reporting MariaDB database"),(0,r.kt)("td",{parentName:"tr",align:null},"Adresse IP de la base de reporting (par d\xe9faut = adresse IP du serveur de reporting)")))),(0,r.kt)("p",null,"*"," ",(0,r.kt)("em",{parentName:"p"},"Le test de connexion ne fonctionnera pas encore \xe0 ce moment de l'installation")),(0,r.kt)("h3",{id:"acc\xe8s-\xe0-la-base-de-donn\xe9es-centrale"},"Acc\xe8s \xe0 la base de donn\xe9es Centrale"),(0,r.kt)("h4",{id:"cas-1--la-base-mariadb-de-monitoring-est-h\xe9b\xe8rg\xe9e-sur-le-m\xeame-serveur-que-le-serveur-central-centreon"},"Cas #1 : La base MariaDB de monitoring est h\xe9b\xe8rg\xe9e sur le m\xeame serveur que le serveur Central Centreon"),(0,r.kt)("p",null,"Lancez la commande ci dessous pour autoriser le serveur de reporting \xe0\nse connecter aux bases de donn\xe9es du serveur de supervision."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon/www/modules/centreon-bi-server/tools/centreonMysqlRights.pl --root-password=@ROOTPWD@\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"@ROOTPWD@\xa0:")," Mot de passe root du serveur MariaDB du serveur de supervision.\nSi il n'y a pas de mot de passe root, ne sp\xe9cifiez pas l'option \"root-password\"."),(0,r.kt)("h4",{id:"cas2--la-base-mariadb-de-monitoring-est-h\xe9berg\xe9e-sur-un-serveur-d\xe9di\xe9"},"Cas2 # La base MariaDB de monitoring est h\xe9berg\xe9e sur un serveur d\xe9di\xe9"),(0,r.kt)("p",null,"Connectez vous en SSH sur le serveur de base de donn\xe9es, et lancez les\ncommandes suivantes\xa0:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"mysql> CREATE USER 'centreonbi'@'$BI_ENGINE_IP$' IDENTIFIED BY 'centreonbi';\nmysql> GRANT ALL PRIVILEGES ON centreon.* TO 'centreonbi'@'$BI_ENGINE_IP$';\nmysql> GRANT ALL PRIVILEGES ON centreon_storage.* TO 'centreonbi'@'$BI_ENGINE_IP$';\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"$BI_ENGINE_IP$\xa0:")," Adresse IP du serveur de reporting"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si vous utilisez une r\xe9plication MariaDB pour vos bases de donn\xe9es de\n",(0,r.kt)("strong",{parentName:"p"},"monitoring"),", lors de l'installation de Centreon MBI, des vues sont\ncr\xe9\xe9es. Il faut les exclure de la r\xe9plication en rajoutant la ligne\nsuivante dans le fichier my.cnf du slave"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"replicate-wild-ignore-table=centreon.mod_bi_%v01,centreon.mod_bi_%V01\n")),(0,r.kt)("p",{parentName:"blockquote"},"puis cr\xe9er les vues sur le slave en lan\xe7ant la commande:"),(0,r.kt)("p",{parentName:"blockquote"}," #mysql centreon < ",(0,r.kt)("a",{target:"_blank",href:n(51219).Z},"view_creation.sql"))),(0,r.kt)("p",null,"Allez au chapitre suivant pour continuer l'installation."),(0,r.kt)("h3",{id:"donner-des-droits-\xe0-lutilisateur-cbis"},"Donner des droits \xe0 l'utilisateur cbis"),(0,r.kt)("p",null,"Lorsque vous installez Centreon MBI, un ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/monitoring/basic-objects/contacts"},"utilisateur")," nomm\xe9 ",(0,r.kt)("strong",{parentName:"p"},"cbis")," est cr\xe9\xe9 automatiquement. Il permet au moteur de g\xe9n\xe9ration de rapports d'extraire les donn\xe9es de Centreon (en utilisant les APIs) afin de les ins\xe9rer dans le rapport. Cet utilisateur doit ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/administration/access-control-lists"},"avoir acc\xe8s \xe0 toutes les ressources supervis\xe9es par Centreon")," afin de pouvoir extraire les graphes de performance pour les rapports suivants :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Host-Graph-v2 ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Hostgroup-Graph-v2."))),(0,r.kt)("p",null,"Pour tester la connexion entre le serveur de reporting MBI et l'API Centreon, utilisez la commande suivante pour t\xe9l\xe9charger un graphique. Remplacez les param\xe8tres du graphique et les timestamps, et remplacez XXXXXXXXX par le jeton d'autologin de l'utilisateur ",(0,r.kt)("strong",{parentName:"p"},"cbis"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"curl -XGET 'https://IP_CENTRAL/centreon/include/views/graphs/generateGraphs/generateImage.php?akey=XXXXXXXXX&username=CBIS&hostname=<nom_h\xf4te>&service=<description-service>&start=<date_d\xe9but>end=<date_fin>' --output /tmp/image.png\n")),(0,r.kt)("p",null,"Exemple :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"curl -XGET 'https://10.1.1.1/centreon/include/views/graphs/generateGraphs/generateImage.php?akey=otmw3n1hu03bvt9e0caphuf50ph8sdthcsk8ofdk&username=CBIS&hostname=my-poller&service=Cpu&start=1623016800&end=1623621600' --output /tmp/image.png\n")),(0,r.kt)("p",null,"Le r\xe9sultat devrait ressembler au code ci-dessous, et l'image du graphe d\xe9sir\xe9 doit avoir \xe9t\xe9 t\xe9l\xe9charg\xe9e dans le r\xe9pertoire ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 18311  100 18311    0     0  30569      0 --:--:-- --:--:-- --:--:-- 30569\n")),(0,r.kt)("h2",{id:"installer-le-serveur-de-reporting"},"Installer le serveur de reporting"),(0,r.kt)("h3",{id:"installer-les-paquets"},"Installer les paquets"),(0,r.kt)("p",null,"Ce chapitre aborde l'installation du serveur de reporting."),(0,r.kt)("p",null,"Lors de ce chapitre, vous aurez besoin des informations suivantes,\nveillez \xe0 les conna\xeetre avant de commencer :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"IP/DNS de la base de monitoring"),(0,r.kt)("li",{parentName:"ul"},"IP/DNS de l'interface de Centreon"),(0,r.kt)("li",{parentName:"ul"},"IP/DNS de la base de reporting (localhost fortement recommand\xe9)"),(0,r.kt)("li",{parentName:"ul"},"acc\xe8s (user/password) aux bases de donn\xe9es de monitoring & reporting"),(0,r.kt)("li",{parentName:"ul"},"d\xe9finir puis r\xe9cup\xe9rer le mot de passe ssh de l'utilisateur\ncentreonBI, sur le serveur Central (pour la mise \xe0 disposition des\nrapports g\xe9n\xe9r\xe9s sur l'interface)")),(0,r.kt)("h4",{id:"proc\xe9dure"},"Proc\xe9dure"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez le d\xe9p\xf4t Business, vous pouvez le trouver sur le\n",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/fr/categories/10341239833105-D%C3%A9p%C3%B4ts"},"portail support"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Puis lancez la commande suivante:"))),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"RHEL / CentOS / Oracle Linux 8",label:"RHEL / CentOS / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-bi-reporting-server MariaDB-server MariaDB-client\n")),(0,r.kt)("p",null,"Dans le cas d'une installation bas\xe9e sur une distribution vierge, installez la\ncl\xe9 GPG :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd /etc/pki/rpm-gpg/\nwget https://yum.centreon.com/standard/21.10/el8/stable/RPM-GPG-KEY-CES\n"))),(0,r.kt)(l.Z,{value:"CentOS 7",label:"CentOS 7",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-bi-reporting-server MariaDB-server MariaDB-client\n")),(0,r.kt)("p",null,"Dans le cas d'une installation bas\xe9e sur une distribution vierge, installez la\ncl\xe9 GPG :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd /etc/pki/rpm-gpg/\nwget https://yum.centreon.com/standard/21.10/el7/stable/RPM-GPG-KEY-CES\n")))),(0,r.kt)("p",null,"Activer le service cbis :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable cbis\n")),(0,r.kt)("h3",{id:"configurer-le-serveur-de-reporting"},"Configurer le serveur de reporting"),(0,r.kt)("h4",{id:"optimisations-mariadb"},"Optimisations MariaDB"),(0,r.kt)("p",null,"Assurez vous que ",(0,r.kt)("a",{target:"_blank",href:n(413025).Z},"le fichier")," de configuration\noptimis\xe9 fourni dans les pr\xe9-requis est bien pr\xe9sent dans ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf.d/"),", puis red\xe9marrez\nle service MariaDB :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart mariadb\n")),(0,r.kt)("p",null,"Il est n\xe9cessaire de modifier la limitation ",(0,r.kt)("strong",{parentName:"p"},"LimitNOFILE"),". Changer cette\noption dans ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf")," NE fonctionnera PAS."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'mkdir -p  /etc/systemd/system/mariadb.service.d/\necho -ne "[Service]\\nLimitNOFILE=32000\\n" | tee /etc/systemd/system/mariadb.service.d/limits.conf\nsystemctl daemon-reload\nsystemctl restart mariadb\n')),(0,r.kt)("p",null,"Si le service MariaDB \xe9choue lors du d\xe9marrage, supprimer les fichiers\n",(0,r.kt)("em",{parentName:"p"},"ib_logfile")," (MariaDB doit absolument \xeatre stopp\xe9) puis red\xe9marrer \xe0\nnouveau MariaDB:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rm -f /var/lib/mysql/ib_logfile*\nsystemctl start mariadb\n")),(0,r.kt)("p",null,"Si vous utilisez un fichier de socket sp\xe9cifique pour MariaDB, modifiez le\nfichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/my.cnf")," et dans la section ","[client]",", ajoutez :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"socket=$PATH_TO_SOCKET$\n")),(0,r.kt)("h4",{id:"installer-la-configuration"},"Installer la configuration"),(0,r.kt)("p",null,"V\xe9rifiez que le MariaDB de reporting est bien d\xe9marr\xe9 puis lancez les\ncommandes ci dessous\xa0et r\xe9pondez aux questions:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/config/install.sh\n")),(0,r.kt)("p",null,"Le script effectue l'\xe9change de cl\xe9s ssh entre le serveur de\nsupervision et le serveur de reporting, et configure la r\xe8gle de\npublication sftp standard pour pouvoir publier les rapports sur le\nCentreon Web. Enfin, il active les backup et d\xe9marre le service cbis."),(0,r.kt)("p",null,"Une fois l'installation termin\xe9e, poursuivez au chapitre suivant pour\nconfigurer l'ETL."),(0,r.kt)("h3",{id:"etl--configuration"},"ETL : Configuration"),(0,r.kt)("p",null,"Centreon MBI int\xe8gre un ETL qui permet de\xa0:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Synchroniser les donn\xe9es brutes de la supervision vers le serveur de\nreporting"),(0,r.kt)("li",{parentName:"ul"},"Alimenter les bases de donn\xe9es du serveur de reporting avec les\ndonn\xe9es statistiques"),(0,r.kt)("li",{parentName:"ul"},"Contr\xf4ler la r\xe9tention des donn\xe9es sur le serveur de reporting")),(0,r.kt)("p",null,"Avant de passer aux \xe9tapes suivantes, il est n\xe9cessaire de lire le\nchapitre des ",(0,r.kt)("a",{parentName:"p",href:"#TODO"},"bonnes pratiques")," afin de\nvous assurer que la configuration des objets dans Centreon (groupes,\ncategories...) est conforme aux attentes de Centreon MBI."),(0,r.kt)("p",null,"Dans le menu ",(0,r.kt)("inlineCode",{parentName:"p"},"Rapports > Monitoring Business Intelligence > General\nOptions > Options de l'ETL")," de Centreon, sp\xe9cifiez les options\nsuivantes\xa0:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Option"),(0,r.kt)("th",{parentName:"tr",align:null},"Values"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Options g\xe9n\xe9rales")),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Une base de donn\xe9es MariaDB d\xe9di\xe9e au reporting a \xe9t\xe9 mise en place."),(0,r.kt)("td",{parentName:"tr",align:null},"Oui. Vous devez avoir un serveur de reporting d\xe9di\xe9."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Espace de stockage des fichiers temporaires sur le serveur de reporting *"),(0,r.kt)("td",{parentName:"tr",align:null},"Dossier sur le serveur de reporting dans lequel les dumps de donn\xe9es seront positionn\xe9s"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Type de statistiques \xe0 traiter"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionnez \xab Disponibilit\xe9 uniquement \xbb si vous utilisez uniquement les rapports de disponibilit\xe9.  S\xe9lectionnez \xab Performance et capacit\xe9 uniquement\xbb si vous souhaitez utiliser uniquement les rapports de capacit\xe9 et de performance S\xe9lectionnez \xabTous\xbb afin de calculer les statistiques pour les deux types de rapports."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Activer le stockage des tables temporaires en m\xe9moire (uniquement si la m\xe9moire physique allou\xe9e au serveur de reporting est suffisante)"),(0,r.kt)("td",{parentName:"tr",align:null},"Activ\xe9 uniquement si votre configuration MariaDB et la m\xe9moire physique allou\xe9e au serveur de reporting le permet."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"S\xe9lection du p\xe9rim\xe8tre du reporting")),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Groupes d hotes"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionnez les groupes d\u2019h\xf4tes pour lesquels vous souhaitez conserver les statistiques."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cat\xe9gories d h\xf4tes"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionnez les cat\xe9gories d\u2019h\xf4tes pour lesquels vous souhaitez conserver les statistiques."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cat\xe9gories de services"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionnez les cat\xe9gories de services pour lesquels vous souhaitez conserver les statistiques."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Calcul des donn\xe9es de disponibilit\xe9")),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionner les plages de services pour le calcul des statistiques de disponibilit\xe9"),(0,r.kt)("td",{parentName:"tr",align:null},"Plages horaires (time periods) pour lesquelles les calculs de disponibilti\xe9 des h\xf4tes et des services sont r\xe9alis\xe9es"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Calcul des donn\xe9es de performance et de capacit\xe9")),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Granularit\xe9 des donn\xe9es statistiques \xe0 calculer"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionnez le ou les niveaux de granularit\xe9 pour le calcul des donn\xe9es de performance (1)"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionner les plages de services pour le calcul des statistiques de performance"),(0,r.kt)("td",{parentName:"tr",align:null},"Plages horaires sur les jours de la semaine pris en compte dans le calcul des donn\xe9es de capacit\xe9 et de performance"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Capacity statistic aggregated by month")),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionner la plage de service 24h/24, 7j/7 pour le calcul des statistiques mensuelles de capacit\xe9"),(0,r.kt)("td",{parentName:"tr",align:null},"Selectionnez la plage horaire 24x7."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionner les cat\xe9gories de services li\xe9es aux indicateurs de capacit\xe9"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionnez les cat\xe9gories de services ayant \xe9t\xe9 rattach\xe9s \xe0 des services de type capacit\xe9"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Exclure les m\xe9triques qui ne renvoient pas une indication d utilisation des espaces de stockage"),(0,r.kt)("td",{parentName:"tr",align:null},"Concerne uniquement les m\xe9triques li\xe9es aux services qui renvoient une information de capacit\xe9. S\xe9lectionnez uniquement les m\xe9triques qui donnent une valeur maximale ou une valeur totale de capacit\xe9 et non une valeur d\u2019utilisation. (exemple, la m\xe9trique \u201c size \u201d return\xe9e par le plugins check_centreon_snmp_remote_storage \xbb)"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Param\xe8tres pour le calcul des centiles")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Calculating centile aggregation by"),(0,r.kt)("td",{parentName:"tr",align:null},"Selectionnez la granularit\xe9 des calculs. Le rapport de trafic fourni en standard avec BI 2.1 utilise les donn\xe9es au Mois."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"S\xe9lectionner les cat\xe9gories de services sur lesquelles aggr\xe9ger les donn\xe9es"),(0,r.kt)("td",{parentName:"tr",align:null},"Selectionnez uniquement les cat\xe9gories de services pertinente (Ex: Traffic)"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Premier jour de la semaine"),(0,r.kt)("td",{parentName:"tr",align:null},"Selectionnez le premier jour \xe0 consid\xe9rer pour les statistiques \xe0 la semaine"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cr\xe9er les combinaisons centile-plage horaire qui couvrent vos besoins (Format du centile : 00.0000)"),(0,r.kt)("td",{parentName:"tr",align:null},"Cr\xe9ez des combinaisons centile/plage horaire sur lesquels les statistiques seront effectu\xe9es"),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"(1)")," Les rapports n\xe9cessitant une granularit\xe9 des donn\xe9es \xe0 l'heure\nsont list\xe9s ci-dessous. Si vous ne souhaitez pas utiliser ces rapports,\nd\xe9sactivez le calcul des statistiques \xe0 l'heure:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Hotsgroup-Host-details-1"),(0,r.kt)("li",{parentName:"ul"},"Host-detail-v2"),(0,r.kt)("li",{parentName:"ul"},"Hostgroup-traffic-Average-Usage-By-Interface"),(0,r.kt)("li",{parentName:"ul"},"Hostgroup-traffic-by-Interface-And-Bandwith-Ranges")),(0,r.kt)("h3",{id:"etl-r\xe9tention-de-donn\xe9es"},"ETL: R\xe9tention de donn\xe9es"),(0,r.kt)("p",null,"Le serveur de reporting contient des donn\xe9es de statistiques dans des\ntables sp\xe9cifiques \xe0 Centreon MBI. Ces donn\xe9es sont stock\xe9es dans la\nbase de donn\xe9es ",(0,r.kt)("em",{parentName:"p"},"centreon_storage"),"."),(0,r.kt)("p",null,"L'espace utilis\xe9 par ces tables augmentera de jour en jour; il est\npossible de contr\xf4ler la volum\xe9trie de ces donn\xe9es en configurant des\nr\xe8gles de r\xe9tention."),(0,r.kt)("p",null,"Dans le menu\xa0: ",(0,r.kt)("em",{parentName:"p"},"Reporting > Monitoring Business Intelligence > Options\ng\xe9n\xe9rales > Options de r\xe9tention des donn\xe9es")," la r\xe9tention peut \xeatre\ng\xe9r\xe9e par:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"type de donn\xe9es (disponibilit\xe9 ou performance)"),(0,r.kt)("li",{parentName:"ul"},"granularit\xe9 des donn\xe9es (donn\xe9es brutes de la supervision, donn\xe9es\nagr\xe9g\xe9es par heure, jour ou mois)")),(0,r.kt)("p",null,'Activez la r\xe9tention de donn\xe9es en cochant "Yes" puis param\xe9trez les\ndiff\xe9rents options de configuration.'),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(49687).Z,width:"1352",height:"558"})),(0,r.kt)("p",null,"Pour activer la purge automatique des donn\xe9es, \xe9ditez le cron\n",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-purge")," sur le serveur de reporting puis\nd\xe9-commentez la ligne suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"0 20 * * * root @CENTREON_BI_HOME@/etl/dataRetentionManager.pl >> @CENTREON_BI_LOG@/dataRetentionManager.log 2>&1\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\xc9vitez les p\xe9riodes pendant lesquelles les calculs de statistiques avec\nl'ETL Centreon MBI et la g\xe9n\xe9ration des rapports sont programm\xe9s.")),(0,r.kt)("p",null,"Il est possible d'ex\xe9cuter le cron de mani\xe8re journali\xe8re ou\nhebdomadaire, cela d\xe9pendra de la charge g\xe9n\xe9r\xe9e par la purge des\ndonn\xe9es sur votre serveur de reporting."),(0,r.kt)("p",null,"Red\xe9marrez le service cron :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart crond\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"BONNES PRATIQUES")," : S\xe9lectionnez diff\xe9rentes p\xe9riodes de r\xe9tention en\nfonction de la granularit\xe9 des donn\xe9es statistiques:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Les donn\xe9es agr\xe9g\xe9es par heure sont souvent exploit\xe9es afin\nd'analyser des m\xe9triques sur une p\xe9riode proche. Il n'est pas\nn\xe9cessaire de conserver ces donn\xe9es sur plusieurs mois;"),(0,r.kt)("li",{parentName:"ul"},"Au del\xe0 de 5 ou 6 mois, vous auriez probablement besoin de voir la\ntendance de la disponibilit\xe9 et des statistiques de performances. Il\nserait donc envisageable de conserver au plus 6 mois les donn\xe9es\nagr\xe9g\xe9es par jour et configurer une r\xe9tention des donn\xe9es agr\xe9g\xe9es\nau mois sur plusieurs dizaines de mois.")),(0,r.kt)("p",null,"Passez \xe0 la section suivante pour continuer l'installation."),(0,r.kt)("h3",{id:"etl--execution"},"ETL : Execution"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Avant d'aller plus loin, assurez vous d'avoir positionn\xe9 les\noptimisations MariaDB fournis dans les pr\xe9-requis. Assurez vous \xe9galement\nd'avoir configur\xe9 la r\xe9tention des donn\xe9es et de l'avoir activ\xe9e afin\nde ne r\xe9cup\xe9rer et calculer que les donn\xe9es dont vous avez besoins.")),(0,r.kt)("h4",{id:"reconstruire-les-statistiques-en-utilisant-les-donn\xe9es-historiques"},"Reconstruire les statistiques en utilisant les donn\xe9es historiques"),(0,r.kt)("p",null,"La commande qui suit, \xe0 ex\xe9cuter sur le serveur de ",(0,r.kt)("em",{parentName:"p"},"REPORTING"),", aura\npour effet de :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Supprimer les donn\xe9es existantes sur la base de reporting"),(0,r.kt)("li",{parentName:"ul"},"Importer les donn\xe9es brutes \xe0 partir de la base de donn\xe9es de\nsupervision, en utilisant les param\xe8tres de retention"),(0,r.kt)("li",{parentName:"ul"},"Alimenter les tables qui contiennent les informations de\ndisponibilit\xe9 des \xe9quipements et des services"),(0,r.kt)("li",{parentName:"ul"},"Alimenter les tables qui contiennent les informations de performance\net de capacit\xe9 des \xe9quipements et des services")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/bin/centreonBIETL -r\n")),(0,r.kt)("h4",{id:"activer-lex\xe9cution-journali\xe8re"},"Activer l'ex\xe9cution journali\xe8re"),(0,r.kt)("p",null,"Une fois que la reconstruction des donn\xe9es est termin\xe9e, il faut activer\nl'ex\xe9cution journali\xe8re du script. Pour cela, sur le serveur de\nreporting, \xe9ditez le fichier \xab\xa0/etc/cron.d/centreon-bi-engine\xa0\xbb\xa0et\nd\xe9-commentez la ligne suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"30 4 * * * root /usr/share/centreon-bi/bin/centreonBIETL -d >> /var/log/centreon-bi/centreonBIETL.log 2>&1\n")),(0,r.kt)("p",null,"Red\xe9marrez le service cron sur le serveur de reporting\xa0:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart crond\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Verifiez que le batch ",(0,r.kt)("em",{parentName:"p"},"centreonBIETL")," commence une fois que le batch\n",(0,r.kt)("em",{parentName:"p"},"eventReportBuilder")," est termin\xe9 sur le serveur de monitoring (v\xe9rifiez\nles heures dans le cron ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon"),").")),(0,r.kt)("p",null,"La configuration de votre installation de Centreon MBI est termin\xe9e, consultez le ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/pr-2575/fr/docs/21.10/getting-started/analyze-resources-availability"},"tutorial")))}N.isMDXComponent=!0},23356:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/architecture-57c0d086ac05ff41f37ef131fb04d7de.png"},49687:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/bi_retention-630acb0acba7833bfa2fe8ba8bd7ecaf.png"}}]);